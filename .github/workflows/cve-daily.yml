#
# THIS FILE IS GENERATED, PLEASE DO NOT EDIT.
#

name: 'Daily CVE tests'
on:
  schedule:
  - cron: '0 23 * * 1-5'
  workflow_dispatch:

# Always run a single job at a time.
# Note: Concurrency is currently in beta and subject to change.
# https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#concurrency
concurrency:
  group: cve-daily

jobs:
  skip_tests_repos:
    name: Skip tests repos
    runs-on: ubuntu-latest
    if: ${{ true || github.repository == 'deckhouse/deckhouse' }}
    steps:
    - name: Do nothing
      run: echo "Empty action to fulfil Github requirements."

  fetch_tags_for_test:
    name: Fetch release channel tags for test
    runs-on: ubuntu-latest
    needs:
      - skip_tests_repos
    steps:
      - name: Fetch tags and map to release channels
        id: fetch_tags
        run: echo '::set-output name=tag_matrix::["v1.38.0","v1.37.6"]'
    outputs:
      tag_matrix: ${{ steps.fetch_tags.outputs.tag_matrix }}

  test_job_with_matrix_strategy:
    name: test job
    runs-on: ubuntu-latest
    needs: fetch_tags_for_test
    strategy:
      matrix:
        tag: ${{ fromJson(needs.fetch_tags_for_test.outputs.tag_matrix) }}
    steps:
      - run: |
          echo "Testing matrix strategy:"
          echo ${{ matrix.tag }}
