---
apiVersion: deckhouse.io/v1
kind: NodeGroup
metadata:
  name: system
spec:
  nodeType: Static
  disruptions:
    approvalMode: Manual
  nodeTemplate:
    labels:
      node-role.deckhouse.io/system: ""
    taints:
    - effect: NoExecute
      key: dedicated.deckhouse.io
      value: system


---
apiVersion: deckhouse.io/v1alpha1
kind: SSHCredentials
metadata:
  name: caps-id
spec:
  privateSSHKey: '${b64_SSH_KEY}'
  user: '${WORKER_USER}'
---
apiVersion: deckhouse.io/v1alpha1
kind: StaticInstance
metadata:
  name: static
spec:
  address: '${WORKER_IP}'
  credentialsRef:
    kind: SSHCredentials
    name: caps-id
---
apiVersion: deckhouse.io/v1
kind: NodeGroup
metadata:
  name: worker
spec:
  nodeType: Static
  staticInstances:
    count: 1
  disruptions:
    approvalMode: Manual
  nodeTemplate:
    labels:
      dedicated.worker: ""
    taints:
    - effect: NoExecute
      key: dedicated
      value: worker
---
apiVersion: deckhouse.io/v1alpha2
kind: Project
metadata:
  name: test-project-1
spec:
  description: Test project
  projectTemplateName: default
  parameters:
    resourceQuota:
      requests:
        cpu: 5
        memory: 5Gi
        storage: 1Gi
      limits:
        cpu: 5
        memory: 5Gi
    administrators:
    - subject: User
      name: admin1
---
apiVersion: deckhouse.io/v1alpha2
kind: Project
metadata:
  name: test-project-2
spec:
  description: Test project
  projectTemplateName: secure
  parameters:
    resourceQuota:
      requests:
        cpu: 5
        memory: 5Gi
        storage: 1Gi
      limits:
        cpu: 5
        memory: 5Gi
    administrators:
    - subject: User
      name: admin2
    allowedGIDs:
      max: 3000
      min: 2000
    allowedUIDs:
      max: 4000
      min: 3000
---
apiVersion: deckhouse.io/v1alpha2
kind: Project
metadata:
  name: test-project-3
spec:
  description: Test project
  projectTemplateName: secure-with-dedicated-nodes
  parameters:
    resourceQuota:
      requests:
        cpu: 5
        memory: 5Gi
        storage: 1Gi
      limits:
        cpu: 5
        memory: 5Gi
    administrators:
    - subject: User
      name: admin3
    allowedGIDs:
      max: 3000
      min: 2000
    allowedUIDs:
      max: 4000
      min: 3000