.Cleanup registry template:
  stage: cleanup_registry
  before_script:
  - export WERF_STAGES_STORAGE=${WERF_STAGES_REPO_BASE}/stages-deckhouse
  - type multiwerf && source <(multiwerf use 1.1 early-access)
  - type werf && source <(werf ci-env gitlab --tagging-strategy tag-or-branch --verbose)
  - docker login -u nobody -p ${REGISTRY_CLEANER_TOKEN} ${CI_REGISTRY_IMAGE}
  script:
  - werf cleanup --without-kube --git-history-based-cleanup-v1.2=true
  only:
    variables:
    - $CLEANUP_SCHEDULE

.Cleanup modules registry template:
  stage: cleanup_registry
  before_script:
  - export WERF_STAGES_STORAGE=${WERF_STAGES_REPO_BASE}/stages-modules-images
  script:
  - ./modules_images_werf cleanup --git-history-based-cleanup-v1.2=true
  only:
    variables:
    - $CLEANUP_SCHEDULE

.Cleanup modules images template:
  stage: cleanup_builder
  script:
  - docker ps --filter status=exited -q | xargs --no-run-if-empty docker rm -v
  - docker images -f dangling=true -q | xargs --no-run-if-empty docker image rm
  only:
    variables:
    - $CLEANUP_SCHEDULE
