{{- if .Values.cloudProviderVcd.internal.affinityRules }}
{{ $prefix := .Values.global.clusterConfiguration.cloud.prefix | required "global.clusterConfiguration.cloud.prefix is required" }}
{{- range .Values.cloudProviderVcd.internal.affinityRules }}
---
apiVersion: deckhouse.io/v1alpha1
kind: VCDAffinityRule
metadata:
  name: {{ printf "%s-%s" $prefix .nodeGroupName | trunc 63 | trimSuffix "-" }}
  {{- include "helm_lib_module_labels" (list $ . (dict "app" "infra-controller-manager")) | nindent 2 }}
spec:
  enabled: "true"
  polarity: {{ .polarity | toString | quote }}
  mandatory: {{ .required | toString | quote }}
  nodeLabelSelector:
    node.deckhouse.io/group: {{ .nodeGroupName | toString | quote }}
{{- end }}
{{- end }}
