spec:
  versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          description: |-
            Интерфейс для настройки отказоустойчивого egress-шлюза на основе группы узлов.

            Настроенные egress-шлюзы можно использовать в политиках исходящего трафика EgressGatewayPolicy.
          properties:
            spec:
              properties:
                nodeSelector:
                  description: |-
                    Селектор для группы узлов, которые будут осуществлять передачу сетевых запросов на внешние сервисы. Среди данных узлов будут выявлены пригодные к работе и один из них будет назначен активным. Признаки пригодного узла:
                    * Узел в состоянии Ready.
                    * Узел не находится в состоянии технического обслуживания (cordon).
                    * cilium-agent на узле в состоянии Ready.

                    Разные EgressGateway могут использовать для работы общие узлы, при этом активные узлы будут выбираться независимо, тем самым распределяя нагрузку между ними.
                sourceIP:
                  properties:
                    mode:
                      description: |-
                        Метод определения исходящего IP-адреса, который будет назначен на исходящие запросы через данный шлюз.

                        Возможны следующие варианты:
                        * `PrimaryIPFromEgressGatewayNodeInterface` — в качестве IP-адреса будет использоваться primary IP-адрес на _публичном_ сетевом интерфейсе узла.

                          Особенности:
                          * При выходе из строя активного узла и назначении нового, IP-адрес отправителя в сетевых пакетах поменяется.
                          * Предварительно необходимо настроить сетевую подсистему на всех egress-узлах:
                            * у _публичных_ интерфейсов должно быть одинаковое имя (например, eth1),
                            * должны быть настроены все необходимые маршруты для доступа на все внешние публичные сервисы.
                        * `VirtualIPAddress` — явное указание исходящего IP-адреса.

                          Особенности:
                          * При выходе из строя активного узла, IP-адрес отправителя в сетевых пакетах не поменяется.
                          * Предварительно необходимо настроить сетевую подсистему на всех egress-узлах:
                            * должны быть настроены все необходимые маршруты для доступа на все внешние публичные сервисы,
                            * _публичный_ интерфейс должен быть подготовлен к автоматической настройке _виртуального_ IP в качестве secondary IP-адреса (при назначении egress-узла в качестве активного, адрес не будет отображаться в списке IP на _публичном_ интерфейсе, но при этом, узел будет эмулировать его наличие с помощью ARP-ответов).
                    virtualIPAddress:
                      properties:
                        ip:
                          description: |-
                            _Виртуальный_ IP-адрес, который будет назначен на исходящие запросы через egress-шлюз.
                    primaryIPFromEgressGatewayNodeInterface:
                      properties:
                        interfaceName:
                          description: Имя интерфейса на egress-узлах, через который осуществляется доступ к внешним сервисам.
            status:
              properties:
                readyNodes:
                  description: Количество узлов, готовых осуществлять функции egress-шлюза.
                activeNodeName:
                  description: Имя активного в данный момент узла.
