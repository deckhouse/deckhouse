type: object
x-examples:
  - mode: Direct
  - mode: Proxy
    proxy:
      ca: ""
      host: dev-registry.deckhouse.io
      password: "password"
      path: /sys/deckhouse-oss
      scheme: http
      user: "user"
  - mode: Detached
    detached:
      storageMode: Fs
properties:
  imagesOverride:
    type: object
    default: {}
    description: |
      Images override
    properties:
      registryManager:
        type: string
        description: |
          Registry manager img full path
        x-example:
          - dev-registry.deckhouse.io/registryManager:latest
      mirrorer:
        type: string
        description: |
          Mirroper img full path
        x-example:
          - dev-registry.deckhouse.io/mirrorer:latest
  enableRegistryManager:
    type: boolean
    description: |
      Registry manager enable flag
    default: false
  mode:
    type: string
    description: |
      Registry mode
    enum: [Direct, Proxy, Detached]
    x-doc-default: Direct
    default: Direct
  detached:
    type: object
    x-example:
      - storageMode: Fs
    description: |
      Detached mode properties.
    properties:
      storageMode: &storageMode
        enum: [S3, Fs]
        description: |
          The type of data storage for the system registry module.
        x-example:
          - Fs
        x-doc-default: Fs
        default: Fs
  proxy:
    type: object
    x-example:
      - ca: ""
        host: dev-registry.deckhouse.io
        password: "password"
        path: /sys/deckhouse-oss
        scheme: http
        user: "user"
      - ca: "<CA>"
        host: dev-registry.deckhouse.io
        password: "password"
        path: /sys/deckhouse-oss
        scheme: https
        user: "user"
    description: |
      Proxy mode properties.
    properties:
      host:
        type: string
        description: |
          Host of upstream registry
        x-example:
          - dev-registry.deckhouse.io
      scheme:
        type: string
        description: |
          Registry access scheme (http or https).
        x-example:
          - https
          - http
      ca:
        type: string
        description: |
          CA of upstream registry
        default: ""
        x-example:
          - ""
      path:
        type: string
        description: |
          Path of upstream registry
        x-example:
          - sys/deckhouse-oss
      user:
        type: string
        description: |
          User of upstream registry
        x-example:
          - license-token
      password:
        type: string
        description: |
          Password of upstream registry
        x-example:
          - "123456"
      ttl:
        type: string
        pattern: '(^(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?(?:(\d+)ms)?(?:(\d+)(Âµs|us))?(?:(\d+)ns)?$)|(^(0)$)'
        description: |
          TTL specifies the expiration time for cached content, after which it will be automatically cleaned up.
          Default: If not set, the TTL defaults to 7 days (168 hours).
          Persistent Cache: If set to 0, the cache will never expire.
        x-example:
          - "168h"
          - "168h10m"
          - "168h10m5s"
        default: 168h
      storageMode:
        <<: *storageMode
oneOf:
  - required: [mode]
    properties:
      mode:
        enum: [Direct]
    not:
      required: [proxy, detached]
  - required: [mode]
    properties:
      mode:
        enum: [Proxy]
      proxy: {}
    not:
      required: [detached]
  - required: [mode]
    properties:
      mode:
        enum: [Detached]
      detached: {}
    not:
      required: [proxy]
