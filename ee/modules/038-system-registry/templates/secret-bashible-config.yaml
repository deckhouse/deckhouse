---
{{- $state := $.Values.systemRegistry.internal.state | default dict }}
{{- $version := $state.bashible_version | default "unknown" }}
{{- $config := $.Values.systemRegistry.internal.bashible | default dict }}
# Merge version to common config
# So far, this approach is being used. Since the version is created independently
{{- $configWithVersion := mergeOverwrite (deepCopy $config) (dict "version" $version) }}

{{- with .Values.systemRegistry.internal.bashible }}
apiVersion: v1
kind: Secret
metadata:
  name: registry-bashible-config
  namespace: d8-system
  {{- include "helm_lib_module_labels" (list $ (dict "app" "registry" "name" "registry-bashible-config")) | nindent 2 }}
data:
  config: {{ $configWithVersion | toYaml | b64enc }}
{{- end }}