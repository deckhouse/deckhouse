---
apiVersion: v1
kind: Secret
metadata:
  name: registry-state
  namespace: d8-system
  annotations:
    version: "1"
  labels:
    app.kubernetes.io/managed-by: system-registry
    heritage: deckhouse
    module: system-registry
    type: system-registry-state
type: system-registry/state
data:
  {{- with .Values.systemRegistry.internal.state }}
  state: {{ . | toYaml | b64enc }}
  staticpod_version: {{ .staticpod_version | b64enc  }}
  bashible_version: {{ .bashible_version | b64enc }}
  users_enabled: {{ .users.enabled | toYaml | b64enc }}
  users: {{ .users.users | join ", " | b64enc }}
  {{- if .messages }}
  messages: {{ .messages | toYaml | b64enc }}
  {{- end }}
  {{- end }}
  {{- with .Values.systemRegistry.internal.pki }}
  pki_mode: {{ .mode | b64enc }}
  {{- end }}
