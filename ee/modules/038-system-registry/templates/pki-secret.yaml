{{- with .Values.systemRegistry.internal.pki }}
{{- if .ca }}
---
apiVersion: v1
kind: Secret
metadata:
  name: registry-pki-ca
  namespace: d8-system
  labels:
    app.kubernetes.io/managed-by: registry
    heritage: deckhouse
    module: registry
    type: registry-pki
type: registry/pki
data:
  tls.crt: {{ .ca.cert | b64enc }}
  tls.key: {{ .ca.key | b64enc }}

{{- if .token }}
---
apiVersion: v1
kind: Secret
metadata:
  name: registry-pki-token
  namespace: d8-system
  labels:
    app.kubernetes.io/managed-by: registry
    heritage: deckhouse
    module: registry
    type: registry-pki
type: registry/pki
data:
  ca.crt: {{ .ca.cert | b64enc }}
  tls.crt: {{ .token.cert | b64enc }}
  tls.key: {{ .token.key | b64enc }}

{{- end }}

{{- if .proxy }}
---
apiVersion: v1
kind: Secret
metadata:
  name: registry-pki-proxy
  namespace: d8-system
  labels:
    app.kubernetes.io/managed-by: registry
    heritage: deckhouse
    module: registry
    type: registry-pki
type: registry/pki
data:
  ca.crt: {{ .ca.cert | b64enc }}
  tls.crt: {{ .proxy.cert | b64enc }}
  tls.key: {{ .proxy.key | b64enc }}

{{- end }}

{{- end }}
{{- end }}
