{{- with .Values.systemRegistry.internal.orchestrator -}}
{{- $hash := .hash -}}
{{- with (.state).node_services -}}

{{- range $name, $node := .nodes -}}

---
apiVersion: v1
kind: Secret
metadata:
  name: registry-node-config-{{ $name }}
  namespace: d8-system
  {{- include "helm_lib_module_labels" (list $ (dict "app" "registry" "type" "registry-node-services-config" )) | nindent 2 }}
  annotations:
    registry.deckhouse.io/config-hash: {{ $hash | quote }}
type: registry/node-services-config
data:
  config: {{ $node.config | toYaml | b64enc }}
  version: {{ $node.version | b64enc }}

{{ end }}

{{- end }}
{{- end }}
