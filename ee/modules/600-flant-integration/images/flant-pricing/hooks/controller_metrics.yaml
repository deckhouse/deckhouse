# Copyright 2023 Flant JSC
# Licensed under the Deckhouse Platform Enterprise Edition (EE) license. See https://github.com/deckhouse/deckhouse/blob/main/ee/LICENSE
#
# This is a config for controller_metrics.py hook.

.config: &config
  group: main
  executeHookOnEvent: []
  executeHookOnSynchronization: false
  keepFullObjectsInMemory: false
  jqFilter: |
    {
      "controller_name": .metadata.name,
      "controller_namespace": .metadata.namespace,
      "controller_kind": .kind,
      "controller_module": .metadata.labels.module,
    }
  labelSelector:
    matchLabels:
      heritage: "deckhouse"

configVersion: v1
kubernetes:
  - name: deploy
    queue: /controller_metrics_deploy
    apiVersion: apps/v1
    kind: Deployment
    <<: *config
  - name: ds
    queue: /controller_metrics_ds
    apiVersion: apps/v1
    kind: DaemonSet
    <<: *config
  - name: sts
    queue: /controller_metrics_sts
    apiVersion: apps/v1
    kind: StatefulSet
    <<: *config

schedule:
  - name: "d8_controllers_schedule"
    crontab: "*/5 * * * *"
    group: "main"