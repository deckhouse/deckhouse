{{- define "huaweicloud_cloud_config" }}
{{- $internal := .Values.cloudProviderHuaweicloud.internal }}
[Global]
auth-url = {{ $internal.connection.authURL | quote }}
domain-name = {{ $internal.connection.domainName | quote }}
region = {{ $internal.connection.region | quote }}
access-key = {{ $internal.connection.accessKey | quote }}
secret-key = {{ $internal.connection.secretKey | quote }}
  {{- if $internal.connection.caCert }}
ca-file = /etc/config/ca.crt
  {{- end }}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: cloud-controller-manager
  namespace: d8-cloud-provider-huaweicloud
  {{- include "helm_lib_module_labels" (list . (dict "app" "cloud-controller-manager")) | nindent 2 }}
type: Opaque
data:
  cloud-config: {{ include "huaweicloud_cloud_config" . | b64enc | quote }}
{{- if hasKey .Values.cloudProviderHuaweicloud.internal.connection "caCert" }}
  ca.crt: {{ .Values.cloudProviderHuaweicloud.internal.connection.caCert | b64enc | quote }}
{{- end }}
