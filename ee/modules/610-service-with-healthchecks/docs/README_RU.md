---
title: "Модуль service-with-healthchecks"
description: "Readiness-пробы с модулем service-with-healthchecks в Deckhouse Kubernetes Platform"
---

В Kubernetes трафик направляется только на доступные поды, что достигается с помощью ресурсов типа `Service` и `EndpointSlices` — это обеспечивает высокую доступность и надежность приложения, так как только  готовые к обработке запросов поды принимают трафик.

Определение доступности пода в Kubernetes осуществляется с помощью проверки, известной как readiness-проба. Эта проба представляет собой механизм, который позволяет Kubernetes определить, готов ли под принимать трафик.

### Что такое readiness-проба?

- **Цель**: Основная цель readiness-пробы — удостовериться, что приложение внутри пода готово к обслуживанию запросов. Если проба не проходит, Kubernetes не будет направлять трафик на данный под, что помогает избежать ошибок и обеспечивает более стабильную работу приложения.

- **Настройка**: readiness-проба настраивается через спецификацию пода. Она может быть реализована в виде HTTP-запроса, TCP-соединения или проверки командной строки (exec). Например, HTTP-проба отправляет запрос к определенному URL, и если ответ успешен (обычно код 200), под считается «готовым».

- **Поведение**: Если readiness-проба не проходит, под будет помечен как «не готовый», и все запросы к сервису будут перенаправлены на другие, доступные поды. Как только под успешно пройдет проверку, он снова будет доступен для трафика.

- **Важность**: Использование readiness-проб критично для поддержания высокой доступности и оптимального распределения нагрузки между подами. Это особенно важно в распределенных системах, где состояние приложений может меняться динамически.

Таким образом, readiness-пробы играют ключевую роль в управлении трафиком в Kubernetes — запросы обрабатываются только доступными подами.

Существуют варианты, когда поды содержат несколько процессов, каждый из которых может обрабатывать трафик независимо, подобно виртуальным машинам. В таких ситуациях одной readiness-пробы недостаточно для определения доступности всех процессов.

Модуль `service-with-healthchecks` предоставляет возможность независимо проверять доступность более чем одного процесса и, исходя из результатов нового набора проб, направлять трафик на соответствующие экземпляры. Это может быть полезным, например, для сложного многоконтейнерного приложения в Kubernetes, где обычно определяется только «общий» `health-check` для нескольких контейнеров в поде.

Настроить новый способ балансировки можно при помощи ресурса [ServiceWithHealthchecks](cr.html#servicewithhealthchecks):
- его спецификация идентична `Service` с добавлением раздела `healthchecks`, который содержит набор новых проверок.
- при создании данного ресурса, создаются дочерние `Service` (без selector) и соответствующие `EndpointSlices`.
- проверку доступности целевых процессов выполняют агенты, развернутые на каждом узле.
