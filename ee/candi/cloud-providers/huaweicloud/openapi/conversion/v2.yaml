version: 2
conversions:
  - |
    if (.spec.additionalNetworks? | type) == "string"
    then .spec.additionalNetworks = [ .spec.additionalNetworks ]
    else . end

  - |
    if (.spec.subnets? // null) != null
       and (.spec.subnets | type) == "array"
       and (.spec.subnets | length) > 0
    then
      .spec =
        (
          .spec
          | ( if (.mainNetwork? // "") | tostring | length == 0
              then . + { mainNetwork: (.subnets[0]) }
              else .
              end )
          | ( .additionalNetworks =
                (
                  (
                    ( .additionalNetworks? // [] )
                    | (if (type == "string") then [.] else . end)
                  )
                  + ( .subnets[1:] // [] )
                )
                | map(tostring)
                | unique
            )
          | del(.subnets)
        )
    else . end