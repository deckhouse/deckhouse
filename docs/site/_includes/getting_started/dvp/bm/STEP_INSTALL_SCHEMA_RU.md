В данном руководстве представлены примеры шагов по установке Deckhouse Virtualization Platform. Руководство описывает минимальную конфигурацию платформы, которая включает в себя один master-узел, один worker-узел и внешний NFS-сервер для хранения дисков виртуальных машин.

<div style="text-align: center;">
  <img
    src="/images/virtualization-platform/dvp-architecture-gs.ru.png"
    alt="Архитектура Deckhouse Virtualization Platform для быстрого старта"
    style="display:block; margin:24px auto; max-width:100%; height:auto;"
  />
</div>

{% alert level="info" %}
Такой конфигурации достаточно для ознакомительных целей, но для production-окружений она не подходит. Ознакомьтесь с [рекомендациями по подготовке к production](/products/virtualization-platform/guides/production.html)
и [рекомендуемыми архитектурными рещениями](/products/virtualization-platform/documentation/about/architecture-options.html). Эти рекомендации помогут правильно выбрать типы и количество узлов кластера в зависимости от ваших требований к эксплуатации.

Выбрав желаемую архитектуру, обратитесь к разделу [«Установка платформы»](/products/virtualization-platform/documentation/admin/install/steps/prepare.html) для получения подробных инструкций по установке платформы в production-окружении.
{% endalert %}

## Требования к аппаратному и программному обеспечению

Для установки Deckhouse Virtualization Platform необходима корректная настройка следующих компонентов:

<ol>

  <li><p><strong>Персональный компьютер</strong> — компьютер, с которого будет производиться установка. Он нужен только для запуска инсталлятора и не будет частью кластера.</p>

  {% offtopic title="Требования..." %}
  - ОС: Windows 10+, macOS 10.15+, Linux (Ubuntu 18.04+, Fedora 35+);
  - Установленный Docker Engine или Docker Desktop (инструкции [для Ubuntu](https://docs.docker.com/engine/install/ubuntu/), [macOS](https://docs.docker.com/desktop/mac/install/), [Windows](https://docs.docker.com/desktop/windows/install/));
  - HTTPS-доступ к хранилищу образов контейнеров `registry.deckhouse.ru`;
  - SSH-доступ по ключу к **master-узлу**, **worker-узлу** и **серверу NFS** будущего кластера.
    {% endofftopic %}
  </li>

  <li><p><strong>master-узел</strong> — управляющий узел кластера, на котором запускаются системные компоненты Deckhouse и Kubernetes control plane. Master-узел отвечает за управление кластером, оркестрацию подов и координацию работы всех узлов.</p>

  {% offtopic title="Требования..." %}
  {% alert level="warning" %}
  На следующем шаге данного руководства в качестве container runtime по умолчанию на узлах кластера указан `ContainerdV2`.
  Чтобы использовать `ContainerdV2` в качестве container runtime на узлах кластера, они должны соответствовать следующим требованиям:

  - поддержка `CgroupsV2`;
  - systemd версии `244`;
  - поддержка модуля ядра `erofs`.
  
  Некоторые дистрибутивы (например, Astra Linux 1.7.4) не соответствуют этим требованиям, и ОС на узлах необходимо привести в соответствие требованиям перед установкой Deckhouse Kubernetes Platform. Подробнее — [в документации](/products/kubernetes-platform/documentation/v1/reference/api/cr.html#clusterconfiguration-defaultcri).
  {% endalert %}
  
  - **Процессор**:
    - архитектура x86_64;
    - поддержка инструкций Intel-VT (VMX) или AMD-V (SVM).
  - **BIOS/UEFI**:
    - включена поддержка аппаратной виртуализации в настройках BIOS/UEFI.
  - **Ресурсы** для конфигурации из одного master-узла и одного worker-узла:
    - не менее 6 vCPU;
    - не менее 6 ГБ оперативной памяти;
    - не менее 60 ГБ дискового пространства на быстром диске (400+ IOPS).
  - **Операционная система**:
    - [поддерживаемые ОС](/products/kubernetes-platform/documentation/v1/supported_versions.html);
    - ядро Linux версии `5.8` или новее.
  - **Программное обеспечение**:
    - установленные пакеты `cloud-init` и `cloud-utils` (названия могут различаться в зависимости от дистрибутива);
    - на узле не должно быть установлено пакетов container runtime, например containerd или Docker.
  - **Сеть**:
    - HTTPS-доступ к `registry.deckhouse.ru` и репозиториям пакетов ОС;
    - SSH-доступ от персонального компьютера для установки по порту `22/TCP`;
    - **уникальный hostname** в пределах серверов (виртуальных машин) кластера.

  {% alert level="warning" %}
  Обеспечение стабильной работы механизмов живой миграции требует использования идентичной версии ядра Linux на всех узлах кластера.

  Это связано с тем, что различия в версиях ядра могут привести к несовместимости интерфейсов, системных вызовов и особенностей работы с ресурсами, что может нарушить процесс миграции виртуальных машин.
  {% endalert %}
  {% endofftopic %}
  </li>

  <li><p><strong>worker-узел</strong> — рабочий узел кластера, предназначенный для запуска рабочих нагрузок и виртуальных машин. На worker-узлах выполняются пользовательские приложения и виртуальные машины, созданные в платформе виртуализации.</p>

  {% offtopic title="Требования..." %}
  <p>Требования к **worker-узлу** аналогичны, но также зависят от характера запускаемой на узлах нагрузки.</p>
  {% endofftopic %}
  </li>

  <li><p><strong>Сервер NFS</strong> — внешний сервер сетевого файлового хранилища, используемый для хранения дисков виртуальных машин и данных компонентов кластера (метрики, логи и т.д.). NFS-сервер обеспечивает централизованное хранилище, доступное со всех узлов кластера.</p>
    {% offtopic title="Требования..." %}
  - **Системные требования**:
    - [поддерживаемая ОС](/products/kubernetes-platform/documentation/v1/supported_versions.html) с возможностью установки NFS-сервера;
    - достаточный объём дискового пространства под диски виртуальных машин.
  - **Требования по доступам и сети**:
    - сетевой доступ по протоколу NFS (рекомендуется NFSv4.1) с master- и worker-узлов;
    - экспорт каталога для DVP с опцией `no_root_squash`;
    - SSH-доступ от **персонального компьютера** (см. п.1) по ключу для администрирования NFS-сервера.
  {% endofftopic %}
  </li>

</ol>

## Поддерживаемые гостевые ОС

Deckhouse Virtualization Platform поддерживает операционные системы, работающие на архитектурах `x86` и `x86-64`, в качестве гостевых ОС. Для корректной работы в режиме паравиртуализации необходимо установить драйверы `VirtIO`, обеспечивающие эффективное взаимодействие между виртуальной машиной и гипервизором.

Успешный запуск операционной системы определяется следующими критериями:

- корректная установка и загрузка ОС;
- бесперебойная работа основных компонентов, таких как сеть и хранилище;
- отсутствие сбоев или ошибок в процессе работы.

Для операционных систем семейства Linux рекомендуется использовать образы гостевых ОС с поддержкой `cloud-init`, что позволяет выполнять инициализацию виртуальных машин после их создания.

Для операционных систем семейства Windows платформа поддерживает инициализацию с помощью [autounattend](https://learn.microsoft.com/ru-ru/windows-hardware/manufacture/desktop/windows-setup-automation-overview) установки.
