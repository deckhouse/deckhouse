{% assign topnav = site.data[page.topnav].topnav[page.lang] %}

<div class="header-container">
  <header class="header {%- if page.lang == 'ru' %} header_float{%- endif %}">
    <div class="header__content container">
      <div class="header__left-box">
        <ul id="top-header-nav" class="nav header__nav">
          <li class="header__navigation-item current-menu-parent menu-item-has-children
            {%- if page.mode == 'ssi' and site.mode != 'module' and item_url_parts[1] == 'documentation' %} header__navigation-item_active{% endif %}
            {%- if page.mode != 'ssi' and is_getting_started_item and item.url == '/gs/' %} header__navigation-item_active{% endif %}"
          >
          {%- unless site.mode == "module" %}
            {%- if page.lang == "ru" %}
              <a href="#">Продукты</a>
              <div class="sub-menu-container">
              <ul class="sub-menu sub-menu_products">
                <li>
                  <a href="/products/kubernetes-platform/">
                    <svg class="products__icon">
                      <use xlink:href="/images/sprite.svg#kubernetes-platform-icon"></use>
                    </svg>
                    <span>Kubernetes Platform</span>
                    <p>Создание идентичных Kubernetes-кластеров и&nbsp;управление ими</p>
                  </a>
                </li>
                <li>
                  <a href="/products/virtualization-platform/">
                    <svg class="products__icon">
                      <use xlink:href="/images/sprite.svg#virtualization-platform-icon"></use>
                    </svg>
                    <span>Virtualization Platform</span>
                    <p>Управление виртуальными машинами</p>
                  </a>
                </li>
                <li>
                  <a href="/products/observability-platform/">
                    <svg class="products__icon">
                      <use xlink:href="/images/sprite.svg#observability-platform-icon"></use>
                    </svg>
                    <span>Observability Platform</span>
                    <p>Мониторинг и&nbsp;журналирование инфраструктуры и&nbsp;приложений</p>
                  </a>
                </li>
                <li>
                  <a href="/products/commander/">
                    <svg class="products__icon">
                      <use xlink:href="/images/sprite.svg#commander-icon"></use>
                    </svg>
                    <span>Commander</span>
                    <p>Центр управления парком кластеров</p>
                  </a>
                </li>
                <li>
                  <a href="/products/stronghold/">
                    <svg class="products__icon">
                      <use xlink:href="/images/sprite.svg#stronghold-icon"></use>
                    </svg>
                    <span>Stronghold</span>
                    <p>Безопасное управление жизненным циклом секретов</p>
                  </a>
                </li>
                <li>
                  <a href="/products/delivery/">
                    <svg class="products__icon">
                      <use xlink:href="/images/sprite.svg#delivery-icon"></use>
                    </svg>
                    <span>Delivery</span>
                    <p>Сборка и&nbsp;доставка контейнеризованного ПО</p>
                  </a>
                </li>
              </ul>
            </div>
            {%- else %}
              <a href="#">Products</a>
              <div class="sub-menu-container">
                <ul class="sub-menu sub-menu_products">
                  <li>
                    <a href="/products/kubernetes-platform/">
                      <svg class="products__icon">
                        <use xlink:href="/images/sprite.svg#kubernetes-platform-icon"></use>
                      </svg>
                      <span>Kubernetes Platform</span>
                      <p>Creating identical Kubernetes clusters and&nbsp;managing them</p>
                    </a>
                  </li>
                  <li>
                    <a href="/products/virtualization-platform/">
                      <svg class="products__icon">
                        <use xlink:href="/images/sprite.svg#virtualization-platform-icon"></use>
                      </svg>
                      <span>Virtualization Platform</span>
                      <p>Managing virtual machines</p>
                    </a>
                  </li>
                  <li>
                    <a href="/products/observability-platform/">
                      <svg class="products__icon">
                        <use xlink:href="/images/sprite.svg#observability-platform-icon"></use>
                      </svg>
                      <span>Observability Platform</span>
                      <p>Infrastructure and&nbsp;application monitoring and&nbsp;logging</p>
                    </a>
                  </li>
                  <li>
                    <a href="/products/commander/">
                      <svg class="products__icon">
                        <use xlink:href="/images/sprite.svg#commander-icon"></use>
                      </svg>
                      <span>Commander</span>
                      <p>Cluster control center</p>
                    </a>
                  </li>
                  <li>
                    <a href="/products/stronghold/">
                      <svg class="products__icon">
                        <use xlink:href="/images/sprite.svg#stronghold-icon"></use>
                      </svg>
                      <span>Stronghold</span>
                      <p>Securely managing lifecycle of secrets</p>
                    </a>
                  </li>
                  <li>
                    <a href="/products/delivery/">
                      <svg class="products__icon">
                        <use xlink:href="/images/sprite.svg#delivery-icon"></use>
                      </svg>
                      <span>Delivery</span>
                      <p>Building and&nbsp;delivering containerized software</p>
                    </a>
                  </li>
                </ul>
              </div>
            {%- endif %}
          </li>
          {%- endunless %}
          {% for entry in topnav %}
            {% for item in entry.items %}
              {%- if site.mode == 'module' and item.ee_only and site.d8Revision != 'EE' %}{% continue %}{% endif %}
              {%- if item.title == site.data.i18n.common.products[page.lang] %}{% continue %}{% endif %}
              {%- assign item_url_parts = item.url | split: '/' -%}
              {%- assign is_getting_started_item = page_url_without_lang | startswith: '/gs/' -%}
              <li class="header__navigation-item
                {%- if page.mode == 'ssi' and site.mode != 'module' and item_url_parts[1] == 'documentation' %} header__navigation-item_active{% endif %}
                {%- if page.mode != 'ssi' and is_getting_started_item and item.url == '/gs/' %} header__navigation-item_active{% endif %}
                {%- if item.url.size>1 and page.url == item.url %} header__navigation-item_active{% endif %}
                {%- if page_url_without_lang == item.url %} header__navigation-item_active{% endif %}
                {%- if item.items %} current-menu-parent menu-item-has-children{% endif %}
                {%- if item.url.size<2 and page.url.size<2 %} header__navigation-item_active{% endif %}"
                {%- if item.items %} data-proofer-ignore{% endif %}
              >
                <a {% if item.url %}href="{% if site.mode == 'module' %}/{{ page.lang }}/platform{% endif %}{{ item.url }}"{% else %}href="#"{% endif %}{% if item.target.size > 0 %} target="{{ item.target }}"{% endif %}>{{- item.title -}}</a>

                {% if item.items %}
                  <div class="sub-menu-container">
                    <ul class="sub-menu">
                      {% for subitem in item.items %}
                        {%- assign item_url_parts = subitem.url | split: '/' -%}
                        <li data-proofer-ignore>
                          <a
                            {%- if subitem.external_url %}
                              href="{{ subitem.external_url }}"
                            {%- elsif subitem.url %}
                              href="{% if site.mode == 'module' %}/{{ page.lang }}/platform{% endif %}{{ subitem.url }}"
                            {%- else %}
                              href="#"
                            {% endif %}
                            {%- if subitem.target.size > 0 %} target="{{ subitem.target }}"{% endif %}
                            >
                              {{ subitem.title }}
                            </a>
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                {% endif %}
              </li>
            {% endfor %}
          {% endfor %}
        </ul>
      </div>
      <div class="header__right-box">
      </div>
    </div>
  </header>
</div>
{%- unless site.mode == "module" %}
{%- if page.lang == "ru" %}
  {%- assign l2MenuData = site.data.topnav-l2-products[page.lang] %}
  {%- if l2MenuData %}
    {%- assign productCode = page.product_code | default: "kubernetes-platform" %}
    {%- assign _conditionProductURL = "/products/" | append: productCode | append: "/" %}
    {%- assign productMenuData = l2MenuData | where: "url", _conditionProductURL | first %}
    {%- assign productLogoURL = "/images/sprite.svg#" | append: productCode | append: "-icon" %}
    {%- assign productName = productMenuData.title %}
    <div class="header header__product-menu">
      <div class="container">
        <div class="header__product-menu-logo">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
             <use xlink:href="{{ productLogoURL }}"></use>
          </svg>
          <span>{{ productName }}</span>
        </div>
    {%- if page.lang == 'ru' %}
        <ul class="nav">
          {%- for item in productMenuData.items %}
            {%- if item.rel == "doc" %}{% assign itemClass='class="active"' %}{% else %}{% assign itemClass='' %}{% endif %}
            <li {{ itemClass }}><a href="{{ item.url }}"{% if item.target.size > 0 %} target="{{ item.target }}"{% endif %}>{{ item.title }}</a></li>
          {%- endfor %}
        </ul>
    {%- endif %}
      </div>
    </div>
  {%- endif %}
{%- endif %}
{%- endunless %}
