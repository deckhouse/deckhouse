{{- define "module-requirements" }}
{{- $module := .module }}
{{- $channel := .channel }}

{{- $requirements := dict }}
{{- $moduleData := index (index site.Data.modules $module) $channel }}
{{- $moduleMetadata := index $moduleData "module" }}
{{- if and $moduleMetadata $moduleMetadata.requirements }}
  {{- $requirements = $moduleMetadata.requirements }}
{{- end }}

{{- if gt (len $requirements) 0 }}
<h2>{{ T "requirements_title" }}</h2>
  {{- if isset $requirements "kubernetes" }}
    {{- $formattedVersion := partial "format-version-requirement" $requirements.kubernetes }}
    <p>{{- T "requirements_kubernetes_title" }}: {{ $formattedVersion }}.</p>
  {{- end }}

  {{- if isset $requirements "deckhouse" }}
    {{- $formattedVersion := partial "format-version-requirement" $requirements.deckhouse }}
    <p>{{- T "requirements_deckhouse_title" }}: {{ $formattedVersion }}.</p>
  {{- end }}

  {{- if isset $requirements "modules" }}
  <p>{{- T "requirements_modules_title" }}:
    <ul>
      {{- range $key, $value := $requirements.modules }}
        {{- if eq $value ">= 0.0.0" }}
          {{- $value = printf "%s." (T "requirements_modules_any_version") -}}
        {{- else -}}
          {{- $formattedValue := partial "format-version-requirement" $value }}
          {{- $value = printf "%s." $formattedValue -}}
        {{- end }}
        <li class="module-requirements__item">
          <code>{{ $key }}</code>: {{ $value }}
        </li>
      {{- end }}
    </ul>
  </p>
  {{- end }}

{{- end }}

{{- end }}
