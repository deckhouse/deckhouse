{{ $defaultChannel := "alpha" }}
{{ define "subpages" }}
{{ $_pathElements := index ( findRESubmatch  `^([a-zA-Z0-9-]+)/([a-zA-Z0-9-]+)/*$` page.File.Dir 1 ) 0 }}
{{ $currentModule := index $_pathElements 1 }}
{{ $currentChannel := index $_pathElements 2 | default "alpha" }}

  <ul class="sidebar__submenu">
  {{ range .Pages }}
  {{ $_pathElements := index ( findRESubmatch  `^([a-zA-Z0-9-]+)/([a-zA-Z0-9-]+)/*$` .File.Dir 1 ) 0 }}
  {{ $module := index $_pathElements 1 }}
  {{ $channel := index $_pathElements 2 }}
  {{ if ne $currentChannel $channel }}{{ continue }}{{ end }}
       <li class="sidebar__submenu-item {{ if or (.IsAncestor page) (eq . page) }}active{{ end }}">
          <a href="{{ if .IsPage }}{{ replaceRE "/readme.html$" "/" .RelPermalink }}{{ else }}#{{ end }}">
          {{- if in .Site.Data.helpers.knownPageNames .File.TranslationBaseName }}
            {{- humanize ( T (printf "moduleLinkTitle%s" .File.TranslationBaseName) ) }}
          {{- else if .LinkTitle }}
            {{- .LinkTitle }}
          {{- else if .Title }}
            {{- .Title }}
          {{- end }}
          </a>
          {{ if or (.IsAncestor page) (eq . page) }}
              {{ template "subpages" . }}
          {{ end }}
      </li>
  {{ end }}
  </ul>
{{ end }}

{{ $context := .GetPage "/" }}
  <div class="sidebar__wrapper-inner">
    <nav class="sidebar__container">

      <ul class="sidebar" id="mysidebar">
        {{ range .Site.Sections }}
            <li class="sidebar__item sidebar__item_parent {{ if or (.IsAncestor page) (eq . page) }}active{{ end }}">
                <a href='
                  {{- if or (.IsAncestor page) (eq . page) }}
                    {{- if .IsPage }}{{ .RelPermalink }}{{ else }}#{{ end }}
                  {{- else }}
                    {{- printf "/modules/%s/%s/" (path.BaseName .Permalink) $defaultChannel }}
                  {{- end }}'>{{ .SectionsPath }}</a>
                  {{ template "subpages" . }}
            </li>
        {{ end }}
      </ul>
    </nav>
  </div>
