version: "3.9"

services:
  router:
    image: $WERF_WEB_ROUTER_DOCKER_IMAGE_NAME
    command: "/app/server"
    environment:
      VROUTER_DEFAULT_GROUP: "v1"
      VROUTER_DEFAULT_CHANNEL: "latest"
      VROUTER_DEFAULT_CHANNEL_FOR_DEFAULT_GROUP: "latest"
      VROUTER_SHOW_LATEST_CHANNEL: "true"
      VROUTER_URL_VALIDATION: "false"
      VROUTER_LISTEN_PORT: "8080"
      VROUTER_LOG_LEVEL: "debug"
      VROUTER_PATH_STATIC: "/app/root"
      VROUTER_PATH_CHANNELS_FILE: "/app/root/en/includes/release-channels/channels.yaml"
      VROUTER_I18N_TYPE: "separate-domain"
      VROUTER_LOCATION_VERSIONS: "/products/kubernetes-platform/documentation"
      VROUTER_DOMAIN_MAP: "eyJlbiIgOiAibG9jYWxob3N0IiwgInJ1IiA6ICJydS5sb2NhbGhvc3QifQo="
    networks:
      - deckhouse
    volumes:
      - ".helm/channels.yaml:/app/root/en/includes/release-channels/channels.yaml:ro"
      - ".helm/channels.yaml:/app/root/ru/includes/release-channels/channels.yaml:ro"
    working_dir: "/app"
  frontend:
    image: $WERF_WEB_FRONTEND_DOCKER_IMAGE_NAME
    command: ["/entrypoint.sh"]
    volumes:
      - ".werf/nginx-local.conf:/etc/nginx/nginx.conf:ro"
      - ".werf/entrypoint-local.sh:/entrypoint.sh:ro"
      - ".helm/channels.yaml:/app/channels.yaml:ro"
      - "./backends/docs-builder-template/public/en/modules:/app/modules-from-source/en/modules:ro"
      - "./backends/docs-builder-template/public/ru/modules:/app/modules-from-source/ru/modules:ro"
      - "channels-conf:/app/channels-data"
    ports:
      - "80:80"
    networks:
      - deckhouse

networks:
  deckhouse:
    name: deckhouse
    external: true

volumes:
  channels-conf:
