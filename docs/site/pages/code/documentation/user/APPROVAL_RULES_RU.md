---
title: "Правила апрувов запросов на слияние"
menuTitle: Правила апрувов запросов на слияние
force_searchable: true
description: Настройка правил апрувов
permalink: ru/code/documentation/user/approval-rules.html
lang: ru
weight: 50
---

Эта функция позволяет определить, сколько апрувов необходимо получить, чтобы смерджить запрос на слияние.
Правила апрува дополняет механизм [CODEOWNERS](/products/code/documentation/user/code-owners.html) на странице запроса на слияние.

Правила можно определить на уровне:

- Группы (доступно для роли Maintainer)
- Проекта (доступно для роли Maintainer)
- Запроса на слияние (доступно для роли Developer)

![Таблица правил апрува](/images/code/approval_rules_ru.png)

### Описание столбцов

- **Правило** — содержит название правила и признак наследования. Запись «Требуется группой Gitlab Org» означает, что правило создано в группе *Gitlab Org*.
- **Аппруверы** — содержит список пользователей и групп, чьи апрувы учитываются при проверке выполнения правила.
- **Требуемое количество апрувов** — количество апрувов, которое необходимо получить от пользователей или участников групп, указанных в аппруверах. Значение «Любой подходящий пользователь» означает, что будет засчитан апрув от любого пользователя, который имеет право его выполнить.
- **Целевая ветка** — правило применяется только если запрос на слияние направлен в указанную ветку. В качестве названия ветки можно использовать wildcard (`*`).

---

### Наследование правил

Правила апрува наследуются каскадно: **группа → подгруппа → проект → запрос на слияние**.

- При создании подгрупп, проектов и запросов на слияние правила родительской сущности добавляются в новую сущность в виде ссылки. В таблице правил рядом с названием отображается, где правило было создано.

- Если изменить родительское правило, изменения распространяются на дочерние уровни. Например, если в проекте есть правило, унаследованное от группы, изменение количества требуемых апрувов на уровне группы обновит правило и в проекте.

- Если изменить унаследованное правило в дочерней сущности, вместо ссылки на родительское правило будет создана его копия. Например, если в проекте отредактировать правило, унаследованное от группы, ссылка на правило группы будет удалена, и в проекте появится собственное правило. Далее оно уже не будет обновляться при изменении исходного правила в группе.

- При создании новых правил на уровне группы или проекта они автоматически добавляются во все существующие нижестоящие подгруппы и проекты.  
В существующие запросы на слияние правила автоматически не добавляются.

---

### Правила для группы

Правила, созданные на уровне группы, автоматически добавляются в новые проекты и подгруппы как унаследованные.

Управлять правилами группы могут участники группы с ролью **Maintainer**.  
Для перехода к настройкам правил на странице группы выберите:  
**Настройки → Запросы на слияние**.  

В разделе *Правила апрува* отображается список правил, настроенных на уровне группы.

#### Создание правила в группе

При нажатии кнопки **«Добавить правило апрува»** можно создать новое правило, указав:

- Название правила
- Целевую ветку (доступны пресеты «Все ветки», «Все защищенные ветки», «Ввести название ветки», либо wildcard `*`)
- Требуемое количество апрувов
- Аппруверов — участников группы или группы на инстансе

---

### Правила для проекта

Правила, созданные на уровне проекта, автоматически добавляются в новые запросы на слияние как унаследованные.

Управлять правилами проекта могут участники проекта с ролью **Maintainer**.  
Для перехода к настройкам выберите:  
**Настройки → Запросы на слияние** → *Правила апрува*.

#### Создание правила в проекте

При создании нового правила можно указать:

- Название правила
- Целевую ветку (можно выбрать пресет, указать название ветки или regex; также можно выбрать защищённую ветку проекта)
- Требуемое количество апрувов
- Аппруверов — прямых или унаследованных участников проекта, а также группы, приглашённые в проект с ролью **Reporter** или выше

---

### Правила для запроса на слияние

Правилами запроса на слияние могут управлять пользователи с ролью **Developer**.

Чтобы перейти к настройкам правил, на странице создания или редактирования MR необходимо раскрыть секцию **«Правила апрува»**.

![Таблица правил апрува](/images/code/approval_rules_mr.png)

На странице MR доступна кнопка **«Сбросить к настройкам проекта по умолчанию»** — она удаляет текущие правила и заново добавляет все правила проекта которые применимыц для целевой ветки MR.

#### Создание правила в MR

При создании правила можно указать:

- Название правила
- Требуемое количество апрувов
- Аппруверов — прямых или унаследованных участников проекта, а также группы с ролью **Reporter** или выше

---

### Настройки апрувов

![Настройки апрувов](/images/code/approval_rules_settings_ru.png)

На уровне проекта или группы можно настроить дополнительные параметры:

- **Запретить апрув автору запроса на слияние** — автор MR не может делать апрув.
- **Запретить апрув пользователю, который добавил коммиты** — коммиттеры не могут делать апрувы.
- **Запретить редактирование правил в наследуемых сущностях** — при включении:
  - правила копируются в дочерние сущности и становятся недоступны для редактирования или удаления;
  - нижестоящие группы и проекты могут создавать только собственные правила;
  - в существующие MR правила автоматически не добавляются;
  - текущие настройки апрувов также распространяются во все дочерние сущности.
- **При добавлении коммита** — определяет, должны ли сбрасываться существующие апрувы при появлении нового коммита.

---

### Кто может делать апрувы

Если настройки апрувов это не запрещают, апрувы могут делать:

- мемберы проекта с ролью **Developer** и выше,
- автор запроса на слияние (если это не запрещено),
- назначенный ответственный за MR.
