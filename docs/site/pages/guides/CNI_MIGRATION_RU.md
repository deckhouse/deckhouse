---
title: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ CNI –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
permalink: ru/guides/cni-migration.html
description: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é (–º–∏–≥—Ä–∞—Ü–∏–∏) CNI –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ Deckhouse.
lang: ru
layout: sidebar-guides
---

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—É —Å–º–µ–Ω—ã —Å–µ—Ç–µ–≤–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ (CNI) –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ Deckhouse Kubernetes Platform. **–î–∞–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–∏–º–∞ –¥–ª—è DKP –≤–µ—Ä—Å–∏–∏ 1.76 –∏ –≤—ã—à–µ.** –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ DKP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å Flannel –Ω–∞ Cilium) —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ—Å—Ç–æ–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞.

{% alert level="danger" %}

* –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –ª—é–±–æ–π (—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π) CNI.
* –í –ø—Ä–æ—Ü–µ—Å—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω –º–æ–¥—É–ª—å —Ü–µ–ª–µ–≤–æ–≥–æ CNI (`ModuleConfig.spec.enabled: true`), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.

{% endalert %}

{% alert level="warning" %}

* –í –ø—Ä–æ—Ü–µ—Å—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø–æ–¥–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö —Å–µ—Ç—å (–≤ PodNetwork), —Å–æ–∑–¥–∞–Ω–Ω—É—é —Ç–µ–∫—É—â–∏–º CNI. –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤. –° —Ü–µ–ª—å—é –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∏—Å–∫–æ–≤ –ø–æ—Ç–µ—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Ä–∞–±–æ—Ç—ã –≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –æ–∫–Ω–æ.
* –ü–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º (CI/CD, GitOps, ArgoCD –∏ —Ç.–¥.), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—ã—Ç–∞—Ç—å—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ –ø–æ–¥—ã —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏). –¢–∞–∫–∂–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º –Ω–µ –≤–∫–ª—é—á–∏—Ç —Å—Ç–∞—Ä—ã–π –º–æ–¥—É–ª—å CNI.

{% endalert %}

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–µ–∂–∏–º—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è CNI:

|                  | simple-bridge | flannel (hostgw) | flannel (vxlan) | cilium (native) | cilium (vxlan) |
| ---------------- | :-----------: | :--------------: | :-------------: | :-------------: | :------------: |
| simple-bridge    |      üü´       |        üü©        |       üü©        |       üü©        |       üü©       |
| flannel (hostgw) |      üü©       |        üü´        |       üü®        |       üü©        |       üü©       |
| flannel (vxlan)  |      üü©       |        üü®        |       üü´        |       üü©        |       üü©       |
| cilium (native)  |      üü©       |        üü©        |       üü©        |       üü´        |       üü®       |
| cilium (vxlan)   |      üü©       |        üü©        |       üü©        |       üü®        |       üü´       |

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ CNI –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ DKP –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏.

## –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–º–∞–Ω–¥ d8 cni-migration —É—Ç–∏–ª–∏—Ç—ã d8 (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)

–£—Ç–∏–ª–∏—Ç–∞ [d8](/products/kubernetes-platform/documentation/v1/cli/d8/reference/) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥—Ä—É–ø–ø—É –∫–æ–º–∞–Ω–¥ `d8 cni-migration` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º –º–∏–≥—Ä–∞—Ü–∏–∏.

### –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

–î–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `switch`, —É–∫–∞–∑–∞–≤ —Ü–µ–ª–µ–≤–æ–π CNI (–Ω–∞–ø—Ä–∏–º–µ—Ä, `cilium`, `flannel` –∏–ª–∏ `simple-bridge`):

```bash
d8 cni-migration switch --to-cni cilium
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ä–µ—Å—É—Ä—Å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏. DKP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –ú–µ–Ω–µ–¥–∂–µ—Ä (Manager) –∏ –ê–≥–µ–Ω—Ç—ã (Agents) –≤ –Ω–µ–π–º—Å–ø–µ–π—Å–µ `d8-system`.

### –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

–ß—Ç–æ–±—ã —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ö–æ–¥–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
d8 cni-migration watch
```

–í—ã —É–≤–∏–¥–∏—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

* **–¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞** ‚Äî —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `CleaningNodes` –∏–ª–∏ `RestartingPods`).
* **–ü—Ä–æ–≥—Ä–µ—Å—Å** ‚Äî —Å–ø–∏—Å–æ–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ –∏ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –æ–∂–∏–¥–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.
* **–û—à–∏–±–∫–∏** ‚Äî –µ—Å–ª–∏ –Ω–∞ –∫–∞–∫–æ–º-—Ç–æ —É–∑–ª–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞, –æ–Ω–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ `Failed Nodes`.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∑—ã –ø—Ä–æ—Ü–µ—Å—Å–∞:

1. **Preparing** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–æ–≤).
2. **WaitingForAgents** ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö.
3. **EnablingTargetCNI** ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ CNI –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Deckhouse.
4. **DisablingCurrentCNI** ‚Äî –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è —Ç–µ–∫—É—â–µ–≥–æ CNI.
5. **CleaningNodes** ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ–∫—É—â–µ–≥–æ CNI –∞–≥–µ–Ω—Ç–∞–º–∏ –Ω–∞ —É–∑–ª–∞—Ö.
6. **WaitingTargetCNI** ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ–¥–æ–≤ –Ω–æ–≤–æ–≥–æ CNI (DaemonSet).
7. **RestartingPods** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥–æ–≤ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏—Ö –Ω–∞ –Ω–æ–≤—É—é —Å–µ—Ç—å.
8. **Completed** ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–π–¥–µ—Ç –≤ `Succeeded`, —É–¥–∞–ª–∏—Ç–µ —Ä–µ—Å—É—Ä—Å—ã –º–∏–≥—Ä–∞—Ü–∏–∏ (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ –∞–≥–µ–Ω—Ç—ã), —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è–ª–∏ —Ä–µ—Å—É—Ä—Å—ã –∫–ª–∞—Å—Ç–µ—Ä–∞. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
d8 cni-migration cleanup
```

## –°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ d8 k (—Ä—É—á–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)

–£–ø—Ä–∞–≤–ª—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–µ–π –º–æ–∂–Ω–æ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Kubernetes API.

### –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å [CNIMigration](/products/kubernetes-platform/documentation/v1/reference/api/cr.html#cnimigration) (–≤ –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∞–Ω–∏—Ñ–µ—Å—Ç `cni-migration.yaml`) —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ü–µ–ª–µ–≤–æ–≥–æ CNI:

```yaml
---
apiVersion: network.deckhouse.io/v1alpha1
kind: CNIMigration
metadata:
  name: migration-to-cilium
spec:
  targetCNI: cilium
```

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:

```bash
d8 k create -f cni-migration.yaml
```

### –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å —Ä–µ—Å—É—Ä—Å–∞ CNIMigration:

```bash
d8 k get cnimigration migration-to-cilium -o yaml -w
# –∏–ª–∏
watch -n 1 "d8 k get cnimigration migration-to-cilium -o yaml"
```

–û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª—è:

* `status.phase` ‚Äî —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø.
* `status.conditions` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.
* `status.failedSummary` ‚Äî —Å–ø–∏—Å–æ–∫ —É–∑–ª–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏.

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å:

```bash
d8 k get cninodemigrations
d8 k get cninodemigration NODE_NAME -o yaml
```

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
d8 k -n d8-system get pods -o wide | grep cni-migration
d8 k -n d8-system logs cni-migration-manager-HASH
d8 k -n d8-system logs cni-migration-agent-HASH
```

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–≤ —Å—Ç–∞—Ç—É—Å–µ —Ä–µ—Å—É—Ä—Å–∞ CNIMigration –ø–æ—è–≤–∏—Ç—Å—è —É—Å–ª–æ–≤–∏–µ `Type: Succeeded, Status: True`) —É–¥–∞–ª–∏—Ç–µ —Ä–µ—Å—É—Ä—Å:

```bash
d8 k delete cnimigration migration-to-cilium
```

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –¥–∞—Å—Ç DKP —Å–∏–≥–Ω–∞–ª —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.

{% offtopic title="–£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è CNI c Flannel –Ω–∞ Cilium..." %}

1. –í—ã–∫–ª—é—á–∏—Ç–µ [–º–æ–¥—É–ª—å `kube-proxy`](/modules/kube-proxy/):

   ```shell
   d8 k apply -f - << EOF
   apiVersion: deckhouse.io/v1alpha1
   kind: ModuleConfig
   metadata:
     name: kube-proxy
   spec:
     enabled: false
   EOF
   ```

1. –í–∫–ª—é—á–∏—Ç–µ [–º–æ–¥—É–ª—å `cni-cilium`](/modules/cni-cilium/):

   ```shell
   d8 k create -f - << EOF
   apiVersion: deckhouse.io/v1alpha1
   kind: ModuleConfig
   metadata:
     name: cni-cilium
   spec:
     version: 1
     enabled: true
     settings:
     tunnelMode: VXLAN
   EOF
   ```

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∞–≥–µ–Ω—Ç—ã Cilium –ø–µ—Ä–µ—à–ª–∏ –≤ —Å—Ç–∞—Ç—É—Å `Running`:

   ```shell
   d8 k get po -n d8-cni-cilium
   ```

   –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

   ```console
   NAME                      READY STATUS  RESTARTS    AGE
   agent-5zzfv               2/2   Running 5 (23m ago) 26m
   agent-gqb2b               2/2   Running 5 (23m ago) 26m
   agent-wtv4p               2/2   Running 5 (23m ago) 26m
   operator-856d69fd49-mlglv 2/2   Running 0           26m
   safe-agent-updater-26qpk  3/3   Running 0           26m
   safe-agent-updater-qlbrh  3/3   Running 0           26m
   safe-agent-updater-wjjr5  3/3   Running 0           26m
   ```

1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ master-—É–∑–ª—ã.

1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞.

   > –ï—Å–ª–∏ –∞–≥–µ–Ω—Ç—ã Cilium –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ —Å—Ç–∞—Ç—É—Å `Running`, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —É–∑–ª—ã.

1. –í—ã–∫–ª—é—á–∏—Ç–µ [–º–æ–¥—É–ª—å `cni-flannel`](/modules/cni-flannel/):

   ```shell
   d8 k apply -f - << EOF
   apiVersion: deckhouse.io/v1alpha1
   kind: ModuleConfig
   metadata:
     name: cni-flannel
   spec:
     enabled: false
   EOF
   ```

1. –í–∫–ª—é—á–∏—Ç–µ [–º–æ–¥—É–ª—å `node-local-dns`](/modules/node-local-dns/):

   ```shell
   d8 k apply -f - << EOF
   apiVersion: deckhouse.io/v1alpha1
   kind: ModuleConfig
   metadata:
     name: node-local-dns
   spec:
     enabled: true
   EOF
   ```

   –ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª—è –¥–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤ Cilium –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `Running`.

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ CNI —Å Flannel –Ω–∞ Cilium –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ.

–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–º, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ CNI —Å Flannel –Ω–∞ Cilium –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—á–µ—Ä–µ–¥—å Deckhouse.

   * –í —Å–ª—É—á–∞–µ –æ–¥–Ω–æ–≥–æ master-—É–∑–ª–∞:

     ```shell
     d8 system queue list
     ```

   * –í —Å–ª—É—á–∞–µ –º—É–ª—å—Ç–∏–º–∞—Å—Ç–µ—Ä–Ω–æ–π –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏:

     ```shell
     d8 system queue list
     ```

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≥–µ–Ω—Ç—ã Cilium. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Running`:

   ```shell
   d8 k get po -n d8-cni-cilium
   ```

   –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

   ```console
   NAME        READY STATUS  RESTARTS    AGE
   agent-5zzfv 2/2   Running 5 (23m ago) 26m
   agent-gqb2b 2/2   Running 5 (23m ago) 26m
   agent-wtv4p 2/2   Running 5 (23m ago) 26m
   ```

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥—É–ª—å `cni-flannel` –≤—ã–∫–ª—é—á–µ–Ω:

   ```shell
   d8 k get modules | grep flannel
   ```

   –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

   ```console
   cni-flannel                         35     Disabled    Embedded
   ```

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥—É–ª—å `node-local-dns` –≤–∫–ª—é—á–µ–Ω:

   ```shell
   d8 k get modules | grep node-local-dns
   ```

   –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

   ```console
   node-local-dns                      350    Enabled     Embedded     Ready
   ```

{% endofftopic %}

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

{% alert %}

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è CNI –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –ø–æ–¥–æ–≤ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ CNI –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.

{% endalert %}

### –ê–≥–µ–Ω—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —É–∑–ª–µ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å DaemonSet `cni-migration-agent` –≤ –Ω–µ–π–º—Å–ø–µ–π—Å–µ `d8-system`. –í–æ–∑–º–æ–∂–Ω–æ, –Ω–∞ —É–∑–ª–µ –µ—Å—Ç—å taints, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–∫—Ä—ã—Ç—ã tolerations –∞–≥–µ–Ω—Ç–∞.

### –£–∑–µ–ª –∑–∞—Å—Ç—Ä—è–ª –≤ —Ñ–∞–∑–µ CleaningNodes

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ–¥–∞ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —É–∑–ª–µ:

```bash
d8 k -n d8-system logs cni-migration-agent-HASH
```

–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ CNI –∏–∑-–∑–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞, –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤.

### –ü–æ–¥—ã —Ü–µ–ª–µ–≤–æ–≥–æ CNI –Ω–µ —Å—Ç–∞—Ä—Ç—É—é—Ç

–ï—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–π CNI (–Ω–∞–ø—Ä–∏–º–µ—Ä, Cilium) –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `Init:0/1`, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –µ–≥–æ init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `cni-migration-init-checker`. –û–Ω –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—á–∏—Å—Ç–∫–∏ —É–∑–ª–∞. –ï—Å–ª–∏ –æ—á–∏—Å—Ç–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (—Å–º. –ø—É–Ω–∫—Ç –≤—ã—à–µ), –Ω–æ–≤—ã–π CNI –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è. –í –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å DaemonSet —Å —Ü–µ–ª—å—é —É–¥–∞–ª–µ–Ω–∏—è init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `cni-migration-init-checker`.

### –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–ª–∞

–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –∏ –Ω–µ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç—Å—è –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `failedSummary` –≤ —Å—Ç–∞—Ç—É—Å–µ CNIMigration.
1. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —É–∑–ª—ã, —Ä–∞–±–æ—Ç—É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–∑–µ–ª –≤ —Å—Ç–∞—Ç—É—Å–µ NotReady), –º–æ–∂–µ—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —É–∑–µ–ª –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ–≥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å.
