---
title: Аппаратные требования к узлам кластера на bare metal
permalink: ru/guides/hardware-requirements.html
description: Аппаратные требования к узлам кластера под управлением Deckhouse Kubernetes Platform.
lang: ru
---

Перед развёртыванием кластера под управлением Deckhouse Kubernetes Platform необходимо определиться с конфигурацией будущего кластера и выбрать параметры для будущих узлов кластера, такие как количество RAM, CPU и так далее.

## Планирование установки

Прежде чем приступить к развёртыванию кластера, необходимо провести планирование ресурсов, которые могут потребоваться для его работы. Для этого следует ответить на несколько вопросов:

* Какая нагрузка планируется на кластер?
* Требуется ли кластеру режим повышенной нагрузки?
* Требуется ли кластеру режим высокой доступности?
* Какие модули DKP планируется использовать?

{% alert level="info" %}
Все описанное дальше применимо к установке Deckhouse Kubernetes Platform [с набором модулей Default](/products/kubernetes-platform/documentation/v1/#наборы-модулей).
{% endalert %}

Из ответов на эти вопросы следует выбор количества узлов, рекомендуемых для развёртывания кластера. См. подробнее [в разделе «Сценарии развёртывания»](#сценарии-развертывания).

## Сценарии развёртывания

{% alert level="warning" %}
В разделе приведён примерный расчёт ресурсов, необходимых для кластера, в зависимости от предполагаемой нагрузки.
{% endalert %}

В состав любого сценария могут входить следующие типы узлов:

* **master-узлы** — узлы, управляющие кластером;
* **frontend-узлы** — узлы, балансирующие входящий трафик, на них работают Ingress-контроллеры;
* **узлы мониторинга** — служат для запуска Grafana, Prometheus и других компонентов мониторинга;
* **системные узлы** — предназначены для запуска модулей Deckhouse;
* **worker-узлы** — предназначены для запуска пользовательских приложений.

Подробнее с этими типами узлов можно ознакомиться [в секции «Особенности конфигурации»](https://deckhouse.ru/products/kubernetes-platform/guides/production.html#%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%B8) раздела «Подготовка к production».

### Минимальная конфигурация кластера

Кластер в такой конфигурации подходит для небольших проектов с невысокой нагрузкой и надёжностью. В такой кластер входят:

* **master-узел** — 1 шт.;
* **worker-узлы** — от 1 шт.;.

Такая конфигурация потребует **от 8 CPU и 16 ГБ RAM**, плюс быстрые **диски с 400+ IOPS** и объёмом минимум 50 ГБ для master-узлов.

Характеристики worker-узла выбираются самостоятельно исходя из предполагаемой пользовательской нагрузки. Также следует учитывать, что в такой конфигурации некоторые из компонентов DKP также будут работать на worker-узле.

{% alert level="warning" %}
Использование такого кластера может быть небезопасно, так как в случае выхода из строя единственного master-узла пострадает весь кластер.
{% endalert %}

### Типовая конфигурация кластера

Рекомендуемая конфигурация. Устойчива к отказам до двух мастер-узлов. Значительно повышает доступность сервисов.
В типовой кластер входят:

* **master-узлы** — 3 шт.;
* **frontend-узлы** — 2 шт.;
* **системные узлы** — 2 шт.;
* **worker-узлы** — от 1 шт. в зависимости от предполагаемой нагрузки.

Такая конфигурация потребует **от 24 CPU и 48 ГБ RAM**, плюс быстрые **диски с 400+ IOPS** и объёмом минимум 50 ГБ для master-узлов.

{% alert level="info" %}
Для компонентов Deckhouse желательно выделить отдельный [StorageClass](https://deckhouse.ru/products/kubernetes-platform/documentation/v1/deckhouse-configure-global.html#parameters-storageclass) на быстрых дисках.
{% endalert %}

### Конфигурация для кластера с повышенной нагрузкой

Отличается от типовой конфигурации выделенными узлами мониторинга. Позволяет обеспечить высокий уровень наблюдаемости в кластере даже при высоких нагрузках.
В кластер с повышенной нагрузкой входят:

* **master-узлы** — 3 шт.;
* **frontend-узлы** — 2 шт.;
* **системные узлы** — 2 шт.;
* **узлы мониторинга** — 2 шт.;
* **worker-узлы** — от 1 шт. в зависимости от предполагаемой нагрузки.

Такая конфигурация потребует **от 28 CPU и 64 ГБ RAM**, плюс быстрые **диски с 400+ IOPS** и объёмом минимум 50 ГБ для master-узлов и узлов мониторинга.

Для компонентов Deckhouse желательно выделить отдельный [StorageClass](https://deckhouse.ru/products/kubernetes-platform/documentation/v1/deckhouse-configure-global.html#parameters-storageclass) на быстрых дисках.

## Требования к узлам кластера

Каждый из узлов кластера должен соответствовать следующим требованиям:

* [поддерживаемая ОС](https://deckhouse.ru/products/kubernetes-platform/documentation/v1/supported_versions.html) (для некоторых ОС могут быть особенности, см. «Примечания» в таблице поддерживаемых версий);
* ядро Linux версии 5.7 или новее;
* **уникальный hostname** в пределах серверов (виртуальных машин) кластера;
* HTTP(S)-доступ до хранилища образов контейнеров `registry.deckhouse.ru` или корпоративного registry в случае установки в закрытом окружении;
* доступ к стандартным для используемой ОС репозиториям пакетов;
* на узле не должно быть установлено пакетов container runtime, например containerd или Docker;
* на узле должны быть установлены пакеты `cloud-utils` и `cloud-init` **и запущены соответствующие им службы**;
* все узлы должны иметь доступ к серверам времени (NTP), чтобы модуль [chrony](../documentation/v1/modules/chrony/) мог выполнить синхронизацию времени.

### Минимальные требования к ресурсам узлов

Вне зависимости от условий эксплуатации будущего кластера и планируемых нагрузок рекомендуются следующие **минимальные ресурсы** для инфраструктурных узлов в зависимости от их роли в кластере:

* **Мастер-узел** — 4 CPU, 8 ГБ RAM, 60 ГБ дискового пространства на быстром диске (400+ IOPS).
* **Frontend-узел** — 2 CPU, 4 ГБ RAM, 50 ГБ дискового пространства.
* **Узел мониторинга** (для нагруженных кластеров) — 4 CPU, 8 ГБ RAM, 50 ГБ дискового пространства на быстром диске (400+ IOPS).
* **Системный узел**:
  * 2 CPU, 4 ГБ RAM, 50 ГБ дискового пространства — если в кластере есть выделенные узлы мониторинга;
  * 4 CPU, 8 ГБ RAM, 60 ГБ дискового пространства на быстром диске (400+ IOPS) — если в кластере нет выделенных узлов мониторинга.
* **Worker-узел** — требования аналогичны требованиям к master-узлу, но во многом зависят от характера запускаемой на узле (узлах) нагрузки.

{% alert level="warning" %}
Работа кластера на узлах с минимальными требованиями сильно зависит от набора включённых модулей DKP.

При большом количестве включённых модулей ресурсы узлов лучше увеличить.
{% endalert %}

### Требования к ресурсам для production

Чтобы в production-среде кластер не столкнулся с нехваткой ресурсов на узлах, а все модули в любых конфигурациях могли нормально работать, рекомендуются следующие системные требования для узлов:

* **Мастер-узел** — 8 CPU, 16 ГБ RAM, 60 ГБ дискового пространства на быстром диске (400+ IOPS).
* **Frontend-узел** — 2 CPU, 4 ГБ RAM, 50 ГБ дискового пространства.
* **Узел мониторинга** (для нагруженных кластеров) — 4 CPU, 8 ГБ RAM, 50 ГБ дискового пространства на быстром диске (400+ IOPS).
* **Системный узел**:
  * 6 CPU, 12 ГБ RAM, 50 ГБ дискового пространства — если в кластере есть выделенные узлы мониторинга;
  * 8 CPU, 16 ГБ RAM, 60 ГБ дискового пространства на быстром диске (400+ IOPS) — если в кластере нет выделенных узлов мониторинга.
* **Worker-узел** — 4 CPU, 12 ГБ RAM, 60 ГБ дискового пространства на быстром диске (400+ IOPS).

### Кластер с одним-единственным master-узлом

{% alert level="warning" %}
У такого кластера отсутствует отказоустойчивость. Его использование не рекомендуется в production-окружениях.
{% endalert %}

В некоторых случаях может быть достаточно всего одного-единственного узла, который будет выполнять все описанные выше роли узлов в одиночку. Например, это может быть полезно в ознакомительных целях или для каких-то совсем простых задач, не требовательных к ресурсам.

В [«Быстром старте»](../gs/bm/step5.html) есть инструкции по развёртыванию кластера на единственном master-узле. После снятия taint с узла на нём будут запущены все компоненты кластера, входящие в выбранный bundle модулей (по умолчанию [bundle: Default](../documentation/v1/modules/002-deckhouse/configuration.html#parameters-bundle)). Для успешной работы кластера в таком режиме потребуются 6 CPU, 12 ГБ RAM и 60 ГБ дискового пространства на быстром диске (400+ IOPS). Эта конфигурация позволит запускать некоторую полезную нагрузку, при этом Deckhouse будет занимать примерно ~25% CPU, ~9 ГБ RAM, ~20 ГБ дискового пространства.

В такой конфигурации при нагрузке в 2500 RPS на условное веб-приложение (статическая страница Nginx) из 30 подов и входящем трафике в 24 Мбит/с:

- нагрузка на CPU суммарно будет повышаться до ~60%;
- значения RAM и диска не возрастают, но в реальности будут зависеть от количества метрик, собираемых с приложений, и характера обработки полезной нагрузки.

{% alert level="info" %}
Рекомендуется провести нагрузочное тестирование вашего приложения и с учетом этого скорректировать мощности сервера.
{% endalert %}

## Требования к аппаратным характеристикам узлов

Машины, предназначенные стать узлами будущего кластера, должны соответствовать следующим требованиям:

* **Архитектура ЦП** — на всех узлах должна использоваться архитектура ЦП `x86_64`.
* **Однотипные узлы** — все узлы должны иметь одинаковую конфигурацию для каждого типа узлов. Узлы должны быть одной марки и модели с одинаковой конфигурацией ЦП, памяти и хранилища.
* **Сетевые интерфейсы** — каждый узел должен иметь по крайней мере один сетевой интерфейс для маршрутизируемой сети.

## Требования к сети между узлами

Узлы должны иметь сетевой доступ друг к другу. Между узлами должны соблюдаться [сетевые политики](../documentation/v1/network_security_setup.html).

### Требования к MTU внутри сети

Требований к MTU нет.

### Требования к IP-адресам узлов

У каждого узла должен быть постоянный IP-адрес.

{% alert level="warning" %}
В случае использования DHCP-сервера для распределения IP-адресов по узлам необходимо настроить в нём чёткое соответствие выдаваемых адресов каждому узлу. Смена IP-адреса узлов нежелательна.
{% endalert %}

## Сообщество

{% alert %}
Следите за новостями проекта [в Telegram](https://t.me/deckhouse_ru).
{% endalert %}

Вступите [в сообщество](https://deckhouse.ru/community/about.html), чтобы быть в курсе важных изменений и новостей. Вы сможете общаться с людьми, занятыми общим делом. Это позволит избежать многих типичных проблем.

Команда Deckhouse знает, каких усилий требует организация работы production-кластера в Kubernetes. Мы будем рады, если Deckhouse позволит вам реализовать задуманное. Поделитесь своим опытом и вдохновите других на переход в Kubernetes.
