---
title: "Планирование и подготовка"
permalink: ru/virtualization-platform/documentation/admin/install/steps/prepare.html
lang: ru
---

## Планирование параметров кластера

Перед установкой нужно спланировать параметры платформы виртуализации:

1. Выбрать редакцию платформы и канал обновлений:
   - [Редакции платформы](../../edtitions.html);
   - [Каналы обновлений](../../update-channels.html).
1. Определить **подсети** ip-адресов:
  - подсеть, используемая узлами для связи между собой;
  - подсеть для Pod-ов;
  - подсеть для Service-ов;
  - подсети адресов для виртуальных машин.
2. Определить узлы, где будет размещаться **ingress контроллер**;
3. Определить **публичный домен** для кластера:
  - Обычной практикой является использование wildcard-домена, который резолвится в адрес узла с ingress контроллером;
  - Шаблон доменов для приложений в этом случае имеет вид `%s.<публичный wildcard-домен кластера>`;
  - Для тестовых кластеров можно использовать универсальный wildcard-домен от сервиса `sslip.io`.
  - **Важно:** Домен, используемый в шаблоне, не должен совпадать с доменом, указанным в параметре `clusterDomain`. Например, если используется `clusterDomain: cluster.local` (значение по умолчанию), то `publicDomainTemplate` не может быть `%s.cluster.local`.
4. Определить, какое **хранилище** будет использоваться:
  - Хранилище можно выбрать из [списка поддерживаемых](../../platform-management/storage/supported-storage.html);
  - Настройка хранилища производится после установки базовой платформы.

## Подготовка узлов

1. **Проверка поддержки виртуализации:**
   - Убедитесь, что поддержка виртуализации Intel-VT (vmx) или AMD-V (svm) включена на уровне BIOS/UEFI на всех узлах кластера.

2. **Установка операционной системы:**
   - Установите одну из [поддерживаемых операционных систем](../requirements.html#поддерживаемые-ос) на каждом узле кластера. Обратите внимание на версию и архитектуру системы.

3. **Доступ к хранилищу образов контейнеров:**
   (TODO контейнерному репозиторию)
   - Убедитесь, что с каждого узла кластера доступно хранилище образов контейнеров. Установщик по умолчанию использует публичное хранилище `registry.deckhouse.ru`. Настройте сетевое подключение и необходимые политики безопасности для доступа к этому репозиторию.
   - Проверить доступ можно командой `curl https://registry.deckhouse.ru/v2/`. Ожидается ответ `401 Unauthorized`.

4. **Добавьте технического пользователя:**

  Для автоматизированной установки и настройки компонентов кластера на master-узле должен быть создан технический пользователь. Имя пользователя может быть любым, для простоты далее будет использоваться имя dvpinstall.

  - Создайте пользователя с правами администратора:
    ```shell
    sudo useradd -m -s /bin/bash -G sudo dvpinstall
    ```
  - Установите пароль (пароль нужно сохранить, он понадобится в дальнейшем):
    ```shell
    sudo passwd dvpinstall
    ```
  - (Опционально) Для удобства на время установки можно разрешить выполнять sudo без пароля:
    ```shell
    visudo
        
    # Добавить строку:
        
    dvpinstall ALL=(ALL:ALL) NOPASSWD: ALL
    ```

5. **Настройка SSH-доступа:**

  На master-узле должен быть настроен SSH-доступ от имени технического пользователя.

  - На **машине для установки**:
    - Сгенерируйте SSH-ключ, который будет использоваться для доступа к узлам:

      ```shell
      ssh-keygen -t rsa -b 4096 -f dvp-install-key -N "" -C "dvp-node" -v
      ```
    
    - Используя установленный пароль, разрешите вход по ключу:
      ```shell
      ssh-copy-id -i dvp-install-key dvpinstall@<адрес master-узла>
      ```

После выполнения всех шагов узлы кластера будут готовы к дальнейшей установке и настройке платформы. Убедитесь, что каждый шаг выполнен корректно, чтобы избежать проблем в процессе установки.
