---
title: "Планирование и подготовка"
permalink: ru/virtualization-platform/documentation/admin/install/steps/prepare.html
lang: ru
---

## Планирование параметров кластера

Перед установкой нужно спланировать параметры платформы виртуализации:

1. Выберите редакцию платформы и канал обновлений:
   - [Редакции платформы](../../../about/editions.html);
   - [Каналы обновлений](../../../about/release-channels.html).

1. Определите подсети IP-адресов:

   - Подсеть, используемая узлами для связи между собой.  
     Это единственная подсеть, которая фактически существует в сети организации и маршрутизируется в вашей инфраструктуре.

   - Подсеть для подов (podSubnetCIDR).
   - Подсеть для сервисов (serviceSubnetCIDR).
   - Подсети адресов для виртуальных машин (virtualMachineCIDRs).

   Подсеть узлов должна быть реальной сетью вашего датацентра. Остальные подсети являются виртуальными сетями внутри кластера, не должны маршрутизироваться вне кластера и не должны анонсироваться ни в публичную сеть, ни в сеть организации. Для них не требуется выделять отдельные VLAN или физические сегменты — достаточно выбрать свободные диапазоны частных адресов, которые не пересекаются с существующими сетями.

   Пример выбора таких подсетей:

   - `podSubnetCIDR: 10.88.0.0/16`
   - `serviceSubnetCIDR: 10.99.0.0/16`
   - `virtualMachineCIDRs: 10.66.10.0/24`

1. Определите узлы, где будет размещён Ingress-контроллер.

1. Определите публичный домен для кластера:
   - Распространённой практикой является использование Wildcard-домена, который разрешается в адрес узла с Ingress-контроллером;
   - Шаблон доменов для приложений в этом случае имеет вид `%s.<публичный wildcard-домен кластера>`;
   - Для тестовых кластеров можно использовать универсальный Wildcard-домен от сервиса [sslip.io](https://sslip.io/).

     > Домен, используемый в шаблоне, не должен совпадать с доменом, указанным в параметре `clusterDomain`. Например, если используется `clusterDomain: cluster.local` (значение по умолчанию), то `publicDomainTemplate` не может быть `%s.cluster.local`.

1. Определите, какое хранилище будет использоваться:
   - Хранилище можно выбрать из [списка поддерживаемых](../../../about/requirements.html#поддерживаемые-хранилища);
   - [Настройка хранилища](../../install/steps/storage.html) производится после установки базовой платформы.

## Подготовка узлов

1. Проверьте поддержку виртуализации:
   - Убедитесь, что поддержка виртуализации Intel-VT (VMX) или AMD-V (SVM) включена на уровне BIOS/UEFI на всех узлах кластера.

1. Установите операционную систему:
   - Установите одну из [поддерживаемых операционных систем](../../../about/requirements.html#поддерживаемые-ос-для-узлов-платформы) на каждом узле кластера. Обратите внимание на версию и архитектуру системы.

1. Проверьте доступ к container registry:
   - Убедитесь, что с каждого узла кластера доступно container registry. Установщик по умолчанию использует публичное хранилище `registry.deckhouse.ru`. Настройте сетевое подключение и необходимые политики безопасности для доступа к репозиторию.
   - Проверить доступ можно командой `curl https://registry.deckhouse.ru/v2/`. Ответ: `401 Unauthorized`.

1. Добавьте технического пользователя:

   Для автоматизированной установки и настройки компонентов кластера на master-узле должен быть создан технический пользователь. Имя пользователя может быть любым, далее будет использоваться имя `dvpinstall`.

   - Создайте пользователя с правами администратора:

     ```shell
     sudo useradd -m -s /bin/bash -G sudo dvpinstall
     ```
  
   - Установите пароль (пароль нужно сохранить, он понадобится в дальнейшем):

     ```shell
     sudo passwd dvpinstall
     ```

   - (Опционально) Для удобства на время установки можно разрешить выполнять `sudo` без пароля:

     ```shell
     visudo   
     # Добавить строку:    
     dvpinstall ALL=(ALL:ALL) NOPASSWD: ALL
     ```

1. Настройте SSH-доступ:

   На master-узле должен быть настроен SSH-доступ от имени технического пользователя.

   На **машине для установки**:

   - Сгенерируйте SSH-ключ, который будет использоваться для доступа к узлам:

     ```shell
     ssh-keygen -t rsa -b 4096 -f dvp-install-key -N "" -C "dvp-node" -v
     ```

   - Используя установленный пароль, разрешите подключение по ключу:

     ```shell
     ssh-copy-id -i dvp-install-key dvpinstall@<адрес master-узла>
     ```

После выполнения всех шагов узлы кластера будут готовы к дальнейшей установке и настройке платформы. Убедитесь, что каждый шаг выполнен корректно, чтобы избежать проблем в процессе установки.
