{% assign productCode = include.productCode -%}
{"documents":[
{%- assign searchedpages = site.pages | where: "searchable", true | where: "lang", page.lang %}
{%- for page in searchedpages %}
{%- if page.name == 'CR.md' or page.name == 'CR_RU.md' or page.name == 'CONFIGURATION.md' or page.name == 'CONFIGURATION_RU.md' or page.name == 'CLUSTER_CONFIGURATION.md' or page.name == 'CLUSTER_CONFIGURATION_RU.md' %}{% continue %}{% endif %}
{%- assign page_url_parts = page.url | split: '/' -%}
{%- assign max_ind = page_url_parts.size | minus: 1 -%}
{%- assign page_canonical_url = page.url | regex_replace_once: '^\/?(en|ru)/', '/' | regex_replace_once: '/index.html$', '/' %}
{%- assign pageBreadcrumbs = site.data['breadcrumbs'][page_canonical_url] %}
{%- assign bc_items = "" %}
{%- assign last_breadcrumb_title = "" %}
{%- if pageBreadcrumbs %}
  {%- for breadcrumb in pageBreadcrumbs %}
    {%- if breadcrumb.title[page.lang] %}
      {%- assign breadcrumb_title = breadcrumb.title[page.lang] -%}
    {%- else %}
      {%- assign breadcrumb_title = breadcrumb.title -%}
    {%- endif %}
    {%- if breadcrumb_title and breadcrumb_title != '' and breadcrumb_title != last_breadcrumb_title %}
      {%- if bc_items.size > 0 %}{%- assign bc_items = bc_items | append: "," %}{%- endif -%}
      {%- assign breadcrumb_title_json = breadcrumb_title | jsonify -%}
      {%- assign bc_items = bc_items | append: breadcrumb_title_json -%}
      {%- assign last_breadcrumb_title = breadcrumb_title -%}
    {%- endif %}
  {%- endfor %}
{%- else %}
  {%- assign next_prepender = '' %}
  {%- for i in (2..max_ind) %}
    {%- if forloop.last %}{% continue %}{%- endif -%}
    {%- unless page_url_parts[i].title %}{% continue %}{%- endunless -%}
    {%- assign breadcrumb_title = '' -%}
    {%- capture current_breadcrumb_url %}{{ next_prepender }}/{{ page_url_parts[i] }}{% endcapture -%}
    {%- capture next_prepender %}{{ next_prepender }}/{{ page_url_parts[i] }}{% endcapture -%}
    {%- assign breadcrumb = site.data.breadcrumbs[current_breadcrumb_url] %}
    {%- if breadcrumb %}
      {%- if breadcrumb.title[page.lang] %}
        {%- assign breadcrumb_title = breadcrumb.title[page.lang] -%}
      {%- else %}
        {%- assign breadcrumb_title = breadcrumb.title -%}
      {%- endif %}
    {%- endif %}
    {%- if breadcrumb_title and breadcrumb_title != '' and breadcrumb_title != last_breadcrumb_title %}
      {%- if bc_items.size > 0 %}{%- assign bc_items = bc_items | append: "," %}{%- endif -%}
      {%- assign breadcrumb_title_json = breadcrumb_title | jsonify -%}
      {%- assign bc_items = bc_items | append: breadcrumb_title_json -%}
      {%- assign last_breadcrumb_title = breadcrumb_title -%}
    {%- endif %}
  {%- endfor %}
{%- endif %}
{"title": "{{ page.title | escape }}",
"url": "{{ page.url | remove_first: "/" | regex_replace: '^(ru/|en/)', '' }}",
"keywords": {{ page.search | jsonify }},
"bc": [{{ bc_items }}],
"content": {{ page.content | normalizeSearchContent | jsonify -}}
}
{%- unless forloop.last %},{% endunless %}
{%- endfor -%}
{%- assign faqpages = site.pages | where: "faqIndexPage", true | where: "lang", page.lang %}
{%- for faqpage in faqpages %}
,{"title": "{{ faqpage.title | escape }}",
"url": "{{ faqpage.url | remove_first: "/" | regex_replace: '^(ru/|en/)', '' }}",
"keywords": {{ faqpage.search | jsonify }},
"content": {{ faqpage.description | jsonify }} }
{%- endfor -%}
{%- assign searchedpages = site.faq | where: "searchable", true | where: "lang", page.lang %}
{%- if faqpages.size > 0 and searchedpages.size > 0 %},{% endif %}
{%- for page in searchedpages %}
{"title": "{{ page.title | escape }}",
"url": "faq.html#{{ page.title | slugify }}",
"keywords": {{ page.search | jsonify }},
"bc": ["FAQ"],
"content": {{ page.content | normalizeSearchContent | jsonify -}}
}
{%- unless forloop.last %},{% endunless %}
{%- endfor -%}
],
"parameters":[
{%- for item in site.data.search.searchItems[page.lang] %}
{%- assign page_canonical_url = item.url | relative_url %}
{%- assign keywords = "" %}
{%- if item.search.size > 0 %}
  {%- if keywords.size > 0 %}
    {%- assign keywords = item.search | append: ", " | append: keywords %}
  {%- else %}
    {%- assign keywords = item.search %}
  {%- endif %}
{%- endif %}
{
"name": "{{ item.name }}",
"module": "{{ item.module | default: "global" }}",
"moduletype": "embedded",
"url": "{{ page_canonical_url }}",
"resName": "{{ item.resourceName | escape }}",
{%- if item.isResource %}
"isResource": "true",
{%- endif %}
{%- if item.deprecated %}
"deprecated": "true",
{%- endif %}
{%- if keywords.size > 0 %}
"keywords": {{ keywords | jsonify }},
{%- endif %}
"path": "{{ item.pathString | escape }}",
"content": {{ item.content | default: '' | normalizeSearchContent | jsonify -}}
}
{%- unless forloop.last %},{% endunless %}
{%- endfor -%}
]}
