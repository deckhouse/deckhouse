---
title: Проекты
permalink: ru/test/architecture/projects.html
lang: ru
---

> ФОКУС-РЕМАРКА: Надо больше технической информации (как сделано). Фокус на том, как это устроено, а не на "зачем это нужно".
>
> Уровень детализации: Детальный
> - Классы, функции, модули и их взаимодействие.
> - Алгоритмы, структуры данных, интерфейсы.
> - Детали реализации.

В данном разделе описаны детали реализации [проектов](../concepts/glossary.html#проект) в Deckhouse Kubernetes Platform (DKP).

## Механизмы изоляции

В [проектах](../concepts/glossary.html#проект), в отличие от [пространств имён](../concepts/glossary.html#пространство-имён) Kubernetes, применяется механизм изоляции ресурсов. Например, в рамках проекта можно использовать следующие возможности:

- Ресурсы контроля доступа (AuthorizationRule / RoleBinding) — обеспечивают управление взаимодействием объектов в проекте. С их помощью можно задавать правила и назначать роли.
- Ресурсы контроля использования нагрузки (ResourceQuota) — задают желаемую квоту CPU, RAM и максимальное число [дополнительных проектных пространств имён](../concepts/glossary.html#дополнительное-проектное-пространство-имён) внутри проекта. Дополнительные проектные пространства имён могут задавать свои собственные квоты внутри проекта, которые не могут превышать лимиты родителя.
- Ресурсы контроля сетевой связности (NetworkPolicy) — управляют входящим и исходящим сетевым трафиком в проекте. Таким образом, можно настроить разрешенные подключения между подами, улучшить безопасность и управляемость сетевого взаимодействия.

Эти инструменты можно комбинировать, чтобы настроить проект в соответствии с требованиями вашего приложения.

## Возможности проектов

[Проекты](../concepts/glossary.html#проект) добавляют разграничение доступа пользователей к различным **возможностям проекта (Project Features)** внутри экосистемы Deckhouse. Для каждого проекта можно задать определённый уровень доступа:

- Deckhouse Kubernetes Platform;
- Deckhouse Virtualization Platform;
- Deckhouse Kubernetes Platform + Deckhouse Virtualization Platform.

Таким образом, проекты определяют, кто и как может использовать возможности экосистемы Deckhouse, обеспечивая как безопасность, так и удобство при совместной работе над инфраструктурой.

## Управление пространствами имён проекта

Проект всегда создаёт основное пространство имён с именем, совпадающим с именем проекта. Дополнительные проектные пространства имён создаются с помощью ресурса `ProjectNamespace` и имеют имя вида `<project-name>-<project-namespace-name>`.

Правила и ограничения:

- Ресурс `ProjectNamespace` может создаваться только в основном пространстве имён проекта.
- Создание `ProjectNamespace` в дополнительных пространствах имён запрещено.
- Имя итогового namespace не должно превышать 63 символа, поэтому длина имени `ProjectNamespace` дополнительно валидируется.
- Нельзя создавать проекты с именами системных пространств имён (префиксы `d8-` и `kube-`).
- Нельзя создавать проект с именем, начинающимся на имя существующего проекта и символ `-` (например, `foo` → запрет `foo-bar`).

## Совместимость с Kubernetes и миграция существующих кластеров

Для совместимости с существующими кластерами доступен режим автоматического создания проектов для пользовательских namespaces, управляемый флагом `allowNamespacesWithoutProjects`.

Если `allowNamespacesWithoutProjects: true`:

- при создании namespace автоматически создаётся проект с тем же именем;
- для таких проектов ставится лейбл `multitenancy.deckhouse.io/project-managed-by-namespace`;
- если на namespace есть соответствующая аннотация, то:
  - разрешается изменение лейблов и аннотаций namespace с зеркалированием в `Project.spec.parameters.namespace`;
  - разрешается удаление namespace с автоматическим удалением проекта;
  - смена проекта запрещена, пока аннотация не снята.

В новых кластерах режим обычно выключен, но может быть включён для сценариев миграции.

## Переменные шаблонов проектов

В каждом `ProjectTemplate` поддерживается секция `spec.parameters.namespace`, в которой можно задавать лейблы и аннотации для создаваемого namespace. Для минимальных сценариев предусмотрен шаблон `simple`, который использует только `spec.parameters.namespace.*`.

Если шаблон проекта не указан, то шаблонизация не применяется, а создаётся только основное пространство имён проекта.
