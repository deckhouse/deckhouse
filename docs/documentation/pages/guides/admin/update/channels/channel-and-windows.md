---
title: Каналы и окна обновлений
permalink: ru/update/channels-and-windows/
lang: ru
---

## Каналы обновлений

Deckhouse Kubernetes Platform использует пять каналов обновлений. Между ними можно переключаться с помощью модуля [`deckhouse`](modules/002-deckhouse), достаточно указать желаемый канал обновлений в конфигурации модуля из следующего списка:

1. **Rock Solid**. Наиболее стабильный канал обновлений. Подойдет для кластеров, которым необходимо обеспечить повышенный уровень стабильности. Обновления функций до этого канала доходят не ранее чем через месяц после их появления в релизе, так как обновления тестируются на успешность и только после этого попадают в канал.
2. **Stable**. Стабильный канал обновлений для кластеров, в которых закончена активная работа и преимущественно осуществляется эксплуатация. Обновления функций до этого канала обновлений доходят не ранее чем через две недели после их появления в релизе.
3. **Early Access**. Рекомендуемый канал обновлений, если вы не уверены в выборе. Подойдет для кластеров, в которых идет активная работа, например, запускаются и дорабатываются новые приложения. Обновления функций до этого канала обновлений доходят не ранее чем через одну неделю после их появления в релизе.
4. **Beta**. Ориентирован на кластеры разработки, как и канал обновлений `Alpha`. Получает версии, предварительно опробованные на канале обновлений `Alpha`.
5. **Alpha**. Наименее стабильный канал обновлений с наиболее частым появлением новых версий. Ориентирован на кластеры разработки с небольшим количеством разработчиков.

> Выбирайте необходимый вам канал обновлений для кластеров:
* Для кластера разработки используйте менее стабильный канал обновлений, нежели для тестового или stage-кластера (pre-production-кластер). 
* Для production-кластеров рекомендуется использовать канал обновлений `Early Access` или `Stable`. 
* Если в production-окружении более одного кластера, предпочтительно использовать для них разные каналы обновлений. Например, `Early Access` для одного, а `Stable` — для другого. 
* Если использовать разные каналы обновлений по каким-либо причинам невозможно, рекомендуется устанавливать разные [окна обновлений](ссылка на раздел).

{% alert level="warning" %}
Рекомендуем устанавливать плановое обновление. Обычно предыдущие ошибки устранены в новых версиях. Не отключайте использование канала обновлений даже в нагруженных и критичных кластерах. В инсталляциях Deckhouse Kubernetes Platform, которые не обновлялись полгода или более, могут присутствовать неустраненные ошибки, поэтому если используются старые версии - оперативно решить возникшую проблему будет непросто.
{% endalert %}

**Установка выбранного канала обновлений**

Чтобы перейти на другой канал обновлений автоматически, в [конфигурации](modules/002-deckhouse/configuration.html) модуля `deckhouse` измените (установите) параметр [releaseChannel](modules/002-deckhouse/configuration.html#parameters-releasechannel).
Чтобы узнать информацию о том, какая версия Deckhouse Kubernetes Platform находится на определенном канале обновлений, перейдите на [сайт](https://flow.deckhouse.io).

В этом случае включится механизм [автоматической стабилизации релизного канала](#как-работает-автоматическое-обновление-deckhouse).

Пример конфигурации модуля `deckhouse` с установленным каналом обновлений `Stable`:

```yaml
apiVersion: deckhouse.io/v1alpha1
kind: ModuleConfig
metadata:
  name: deckhouse
spec:
  version: 1
  settings:
    releaseChannel: Stable
```


**Изменение канала обновлений**

* При изменении канала обновлений на более стабильный, например, с `Alpha` на `EarlyAccess`, Deckhouse Kubernetes Platform скачивает данные о релизе (в примере — из канала `EarlyAccess`) и сравнивает их с данными из существующих в кластере кастомных ресурсов `DeckhouseRelease`:
  * Новые релизы, которые еще не были применены и находятся в статусе `Pending`, удаляются.
  * Новые релизы уже применены и находятся в статусе `Deployed`, смены релиза не происходит. В этом случае Deckhouse Kubernetes Platform останется на таком релизе до тех пор, пока на канале обновлений `EarlyAccess` не появится более поздний релиз.
* При смене канала обновлений на менее стабильный, например, с `EarlyAcess` на `Alpha`, происходит следующее:
  * Deckhouse Kubernetes Platform скачивает данные о релизе (в примере — из канала `Alpha`) и сравнивает их с данными из существующих в кластере кастомных ресурсов `DeckhouseRelease`.
  * Deckhouse Kubernetes Platform выполняет обновление согласно установленным [параметрам обновления](modules/002-deckhouse/configuration.html#parameters-update).

## Окна обновлений

Управление [окнами обновлений](/documentation/v1/modules/002-deckhouse/configuration.html#parameters-update-windows) по определенному времени, чтобы избежать обновлений в периоды наибольшей нагрузки, планово обновляет релизы Deckhouse Kubernetes Platform в автоматическом режиме.

  В Deckhouse Kubernetes Platform используется механизм автоматического обновления. Этот механизм использует [5 каналов обновлений](ссылка на Раздел с Каналами и Окнами), различающиеся стабильностью и частотой выхода версий.

Временные настройки позволяют определить удобное время для обновления модулей в Deckhouse Kubernetes Platform. Это обеспечивает стабильность системы во время обновлений и минимизирует возможные негативные влияния на работающие приложения.
Установка обновлений в определенное время позволяет минимизировать проблемы, связанные с нагрузкой на систему во время установки обновлений, а также предотвращает конфликты между обновляемыми модулями и работающими приложениями.

Настройте время, когда Deckhouse Kubernetes Platform будет устанавливать обновления, в параметре [`update.windows`](configuration.html#parameters-update-windows) конфигурации модуля.

Пример настройки двух ежедневных окон обновлений, например, с 8:00 до 10:00 и c 20:00 до 22:00 (UTC):

```yaml
apiVersion: deckhouse.io/v1alpha1
kind: ModuleConfig
metadata:
  name: deckhouse
spec:
  version: 1
  settings:
    releaseChannel: EarlyAccess
    update:
      windows: 
        - from: "8:00"
          to: "10:00"
        - from: "20:00"
          to: "22:00"
```

Также можно настроить обновления в определенные дни, например по вторникам и субботам с 18:00 до 19:30 (UTC):

```yaml
apiVersion: deckhouse.io/v1alpha1
kind: ModuleConfig
metadata:
  name: deckhouse
spec:
  version: 1
  settings:
    releaseChannel: Stable
    update:
      windows: 
        - from: "18:00"
          to: "19:30"
          days:
            - Tue
            - Sat
```

## Обновление модуля без определенного времени

1. При необходимости, выполните обновление модуля без определенного времени.

   > Применение обновлений без соблюдения определенного для этого времени может вызвать проблемы стабильности системы или конфликты с работающими приложениями.

1. Установите в соответствующем ресурсе [*DeckhouseRelease*](modules/002-deckhouse/cr.html#deckhouserelease) аннотацию `release.deckhouse.io/apply-now: "true"`.

   Пример команды пропуска окон обновлений для версии `v1.56.2`:

   ```shell
   kubectl annotate deckhousereleases v1.56.2 release.deckhouse.io/apply-now="true"
   ```

   Пример ресурса с установленной аннотацией пропуска окон обновлений:

   ```yaml
   apiVersion: deckhouse.io/v1alpha1
   kind: DeckhouseRelease
   metadata:
     annotations:
       release.deckhouse.io/apply-now: "true"
   ...
   ```