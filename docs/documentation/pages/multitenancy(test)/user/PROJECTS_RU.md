---
title: Проекты
permalink: ru/test/user/multitenancy/projects.html
lang: ru
---

Проекты (Project) и проектные пространства имён (ProjectNamespace) расширяют функциональность стандартных пространств имён Kubernetes, сохраняя с ними обратную совместимость. Проекты позволяют изолировать команды и сервисы друг от друга, задавать лимиты ресурсов и управлять доступом.

После настройки шаблонов и ролей администратор или пользователь с соответствующими правами может создавать проекты и управлять ими через Web-интерфейс или CLI. В этом разделе описаны основные сценарии работы с проектами и проектными пространствами имён в Deckhouse: от создания до редактирования и удаления.

## Создание проекта

### Web UI

Процесс создания проекта в веб-интерфейсе Deckhouse выглядит следующим образом:

1. В веб-интерфейсе Deckhouse выберите раздел Система → Проекты.
1. Укажите название проекта в поле "Ключ проекта".
1. Перейдите на вкладку Конфигурация и укажите:
   - Полное название проекта;
   - Описание проекта (необязательно);
   - Лимиты проекта;
   - CPU и Память для всего проекта;
   - Хранилище (если поддерживается);
   - Максимальное число проектных пространств имен (ProjectNamespace);
1. В блоке "Проектный доступ" добавьте пользователей и/или группы, укажите для них необходимые роли.
1. Внизу выберите Шаблон проекта (ProjectTemplate) и заполните Параметры проекта согласно схеме выбранного шаблона.
1. Нажмите Сохранить.

   - Рабочий вариант, будет изменен позже.
   ![project-creation](../../../images/multitenancy(test)/project-creation.png)

После этого платформа создаст соответствующий Custom Resource, подхватит его контроллерами и автоматически развернёт:

- Проект `<project>` с ResourceQuota и RoleBinding;
- Все ресурсы из шаблона (если указан ProjectTemplate).

### CLI

1. Для создания проекта создайте Custom Resource [Project](cr.html#project) с указанием имени шаблона проекта в поле [.spec.projectTemplateName](cr.html#project-v1alpha2-spec-projecttemplatename).
1. В параметре [.spec.parameters](cr.html#project-v1alpha2-spec-parameters) укажите значения параметров для секции [.spec.parametersSchema.openAPIV3Schema](cr.html#projecttemplate-v1alpha1-spec-parametersschema-openapiv3schema) кастомного ресурса `ProjectTemplate`.

   Пример создания проекта с помощью [Project](cr.html#project) из `default` [ProjectTemplate](cr.html#projecttemplate) представлен ниже:

   ```yaml
   apiVersion: deckhouse.io/v1alpha2
   kind: Project
   metadata:
     name: my-project
   spec:
     description: This is an example from the Deckhouse documentation.
     projectTemplateName: default
     parameters:
       resourceQuota:
         requests:
           cpu: 5
           memory: 5Gi
           storage: 1Gi
         limits:
           cpu: 5
           memory: 5Gi
       networkPolicy: Isolated
       podSecurityProfile: Restricted
       extendedMonitoringEnabled: true
       administrators:
       - subject: Group
         name: k8s-admins
   ```

1. Для проверки статуса проекта выполните команду:

   ```shell
   d8 k get projects my-project
   ```

   Успешно созданный проект должен отображаться в статусе `Deployed` (синхронизирован). Если отображается статус `Error` (ошибка), добавьте аргумент `-o yaml` к команде (например, `kubectl get projects my-project -o yaml`) для получения более подробной информации о причине ошибки.

## Редактирование проекта

### Web UI

Процесс редактирования проекта в веб-интерфейсе Deckhouse выглядит следующим образом:

1. Откройте в боковом меню раздел Проект → Обзор и выберите нужный проект.
1. Перейдите на вкладку Конфигурация.
1. В секции «Сведения о проекте» измените поля Полное название проекта и Описание проекта.
1. В секции «Проектные лимиты» отредактируйте запросы и лимиты CPU, памяти и хранилища как для всего проекта, так и для основного пространства имён.
1. В секции «Проектный доступ» нажмите Добавить под таблицей пользователей или групп и укажите роли (admin, manager, user, viewer) для новых субъектов или удалите старые.
1. Внизу в блоке «Тип проекта» при необходимости выберите другой шаблон проекта из выпадающего списка и отредактируйте JSON в поле Параметры проекта в соответствии с требованиями схемы.
1. Чтобы добавить или удалить проектные пространства имён, перейдите на вкладку Пространства имён и используйте кнопку + Создать или значок корзины рядом с нужным пространством имён.
1. При необходимости откройте вкладку Meta для добавления меток и аннотаций или вкладку YAML для ручного редактирования всего манифеста.
1. После всех изменений нажмите кнопку Сохранить внизу экрана или значок дискеты в правом верхнем углу, чтобы применить обновлённые настройки проекта.
   
   - Рабочий вариант, будет изменен позже.
   ![project-editing](../../../images/multitenancy(test)/project-editing.png)

### CLI

Пример (#TODO):

## Создание проектного пространства имён

Создание проектных пространств имен позволяет изолировать ресурсы и разделить доступы в рамках одного проекта. Проектное пространство имён создаётся в рамках проекта и наследует его настройки.

### Web UI

Процесс создания проектного пространства имён в веб-интерфейсе Deckhouse выглядит следующим образом:

1. Откройте в боковом меню раздел Проект → Обзор и убедитесь, что выбран нужный проект.
1. В блоке Пространства имён нажмите кнопку "+ Создать пространство имён".

   - Рабочий вариант, будет изменен позже.
   ![project-namespace-sidebar](../../../images/multitenancy(test)/project-namespace-sidebar.png)
1. В диалоге Создание пространства имён:
- Имя: префикс `<project>-` выставляется автоматически, в поле справа введите суффикс (например, `dsp-root`).
- Перейдите на вкладку Конфигурация и задайте:
  - Запросы CPU и Лимит CPU;
  - Запросы Памяти и Лимит Памяти;
  - Запросы Хранилища и Лимит Хранилища (при необходимости).
1. Перейдите на вкладку Доступ и добавьте группы или пользователей в качестве Администраторов проекта — они получат manager-правa в этом пространстве имён.
   1. (Опционально) Во вкладке Meta можно задать метки и аннотации.
1. По необходимости переключитесь на вкладку YAML, чтобы вручную подправить манифест перед созданием.
1. Нажмите Сохранить.

   - Рабочий вариант, будет изменен позже.
   ![project-namespace-creation](../../../images/multitenancy(test)/project-namespace-creation.png)

После этого Deckhouse автоматически создаст ресурс `ProjectNamespace`, заведёт соответствующее пространство имён со всеми унаследованными квотами, ролями и сетевыми политиками.

### CLI

Пример (#TODO):

## Автоматическое создание проекта для пространства имён

{% alert level="warning" %}
Механизм работает только если системный флаг `AllowNamespacesWithoutProjects` установлен в `true`.
{% endalert %}

Платформа Deckhouse может автоматически создавать новые проекты из существующих пространств имён. Для этого пометьте необходимое пространство имён аннотацией `projects.deckhouse.io/adopt`. Например:

1. Создайте новое пространство имён:

   ```shell
   d8 k create ns test
   ```

1. Пометьте его аннотацией:

   ```shell
   d8 k annotate ns test projects.deckhouse.io/adopt=""
   ```

1. Убедитесь, что проект создался:

   ```shell
   d8 k get projects
   ```

   В списке проектов появится новый проект, соответствующий пространству имён:

   ```console
   NAME        STATE      PROJECT TEMPLATE   DESCRIPTION                                            AGE
   deckhouse   Deployed   virtual            This is a virtual project                              181d
   default     Deployed   virtual            This is a virtual project                              181d
   test        Deployed   empty                                                                     1m
   ```

Шаблон созданного проекта можно изменить на существующий.

{% alert level="warning" %}
Обратите внимание, что при смене шаблона может возникнуть конфликт ресурсов: если в чарте шаблона прописаны ресурсы, которые уже присутствуют в пространстве имён, то применить шаблон не получится.
{% endalert %}
