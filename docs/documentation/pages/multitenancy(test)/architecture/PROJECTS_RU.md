---
title: Проекты
permalink: ru/test/architecture/multitenancy/projects.html
lang: ru
---

**Проект (Project)** — основная единица изоляции и управления ресурсами в экосистеме Deckhouse, с которой работают пользователи. Они расширяют функциональность стандартных пространств имён Kubernetes, сохраняя с ними обратную совместимость.

## Преимущества

- Ограничение ресурсов — проекту задаётся желаемая квота CPU, RAM и максимальное число проектных пространств имён. Проектные пространства имён могут задавать свои собственные квоты внутри проекта, которые не могут превышать лимиты родителя.
- Обратная совместимость — проекты и проектные пространства имён полностью совместимы с обычными пространствами имён Kubernetes, что позволяет использовать стандартные возможности Kubernetes.
- [Шаблонизация](#шаблоны-проектов) — все проекты создаются по шаблону ProjectTemplate, что позволяет избежать ошибок и обеспечить единообразие. При изменении ресурса ProjectTemplate все проекты, созданные по этому шаблону, будут обновлены в соответствии с новым шаблоном. Администраторы платформы могут создавать собственные ProjectTemplate, либо воспользоваться шаблонами по умолчанию.
- [Изоляция](#механизмы-изоляции) — каждый проект обеспечивает изолированное окружение, где разработчики могут развернуть экземпляр приложения без влияния на другие проекты. Проектные пространства имён позволяют разделить приложение на логические части и назначать для каждого пространства отдельные политики доступа.
- [Управление доступом к платформам](#управление-доступом-к-платформам) — проекты и проектные пространства имён могут предоставлять доступ к определённым платформам (например, к Deckhouse Virtualization Platform в случае отдельного лицензирования). Проектное пространство имён не сможет запросить доступы, которых нет у родителя.

## Структура

Проект содержит как минимум одно **основное пространство имён (MainNamespace)**. Основное пространство имён используется как для управления самим проектом, так и для запуска полезной нагрузки.

В рамках проекта могут создаваться **проектные пространства имён (ProjectNamespace)**. Они позволяют логически разделить сервисы и ресурсы внутри проекта, а также применить к ним отдельные политики доступа и лимиты ресурсов.

```text
Рабочий вариант схемы, будет изменён позже.

Deckhouse Cluster
│
├─ System namespaces
│     ├─ Namespace <d8-*>          ← Системное пространство имён
│     └─ Namespace <kube-*>        ← Системное пространство имён
│
└─ Project
│     └─ Namespace <project-name>  ← Основное пространство имён
│           ├─ ResourceQuota       ← Лимиты проекта
│           ├─ NetworkPolicy       ← Лимиты проекта
│           └─ RoleBinding         ← Лимиты проекта
│ 
├─ ProjectNamespace 1
│     └─ Namespace <project-name>-<project-namespace-name-1>  ← Проектное пространство имён
│           ├─ ResourceQuota       ← Можно изменять в пределах лимитов проекта
│           ├─ NetworkPolicy       ← Можно изменять в пределах лимитов проекта
│           └─ RoleBinding         ← Можно изменять в пределах лимитов проекта
│
└─ ProjectNamespace 2
      └─ Namespace <project-name>-<project-namespace-name-1>  ← Проектное пространство имён
            ├─ ResourceQuota       ← Можно изменять в пределах лимитов проекта
            ├─ NetworkPolicy       ← Можно изменять в пределах лимитов проекта
            └─ RoleBinding         ← Можно изменять в пределах лимитов проекта
```

## Ограничения

- Имя проекта не должно превышать 61 символ.
- Имя проекта не может начинаться с `d8‑` или `kube‑`. Такие имена зарезервированы для системных проектов.
- Все права проектных пространств имён обязаны быть подмножеством родительского проекта.
- Если параметр `АllowNamespacesWithoutProjects` конфигурации модуля `multitenancy-manager` установлен в `false`, создание пространств имён напрямую в кластере запрещено.

## Шаблоны проектов

Шаблоны проектов в Deckhouse описывают конфигурацию, которая автоматически применяется ко всем создаваемым в рамках проекта ресурсам — пространствам имён, квотам, ролям, политикам и др. Платформа включает несколько встроенных шаблонов, которые охватывают типовые сценарии. Также можно создавать собственные шаблоны на основе встроенных шаблонов проекта.

### Встроенные шаблоны проектов

{% alert level="warning" %}
Встроенные шаблоны проектов являются недоступными для редактирования.
{% endalert %}

В Deckhouse по умолчанию доступны следующие шаблоны проектов:

- `default` — шаблон для базовых сценариев использования проектов. Особенности шаблона:
  - управление ограничением ресурсов;
  - настройка сетевой изоляции;
  - настройка оповещений и правил сбора логов;
  - установка профиля безопасности;
  - указание администраторов проекта.

    Описание шаблона [в GitHub](https://github.com/deckhouse/deckhouse/blob/main/modules/160-multitenancy-manager/images/multitenancy-manager/src/templates/default.yaml).

- `secure` — включает все возможности шаблона `default`, а также дополнительные функции:
  - настройка допустимых для проекта UID/GID;
  - настройка правил аудита обращения Linux-пользователей проекта к ядру;
  - включение сканирования запускаемых образов контейнеров на наличие известных уязвимостей (CVE).

  Описание шаблона [в GitHub](https://github.com/deckhouse/deckhouse/blob/main/modules/160-multitenancy-manager/images/multitenancy-manager/src/templates/secure.yaml).

- `secure-with-dedicated-nodes` — включает все возможности шаблона `secure`, а также дополнительные функции:
  - определение селектора узла для всех подов в проекте: если под создан, селектор узла пода будет автоматически **заменён** на селектор узла проекта;
  - определение стандартных tolerations для всех подов в проекте: если под создан, стандартные значения tolerations **добавляются** к нему автоматически.

  Описание шаблона [в GitHub](https://github.com/deckhouse/deckhouse/blob/main/modules/160-multitenancy-manager/images/multitenancy-manager/src/templates/secure-with-dedicated-nodes.yaml).

## Механизмы изоляции

В основе проекта используется механизм изоляции ресурсов в рамках пространства имён. Стандартные пространства имён в Kubernetes позволяют группировать поды, сервисы, секреты и другие объекты, но не обеспечивают полноценной изоляции.

Проекты в Deckhouse расширяют функциональность пространств имён, предлагая дополнительные инструменты для повышения уровня контроля и безопасности. Например, в рамках проекта можно использовать следующие возможности:

- Ресурсы контроля доступа (AuthorizationRule / RoleBinding) — обеспечивают управление взаимодействием объектов внутри пространства имён. С их помощью можно задавать правила и назначать роли, чтобы точно контролировать, кто и что может делать в проекте.
- Ресурсы контроля использования нагрузки (ResourceQuota) — задают желаемую квоту CPU, RAM и максимальное число проектных пространств имён. Проектные пространства имён могут задавать свои собственные квоты внутри проекта, которые не могут превышать лимиты родителя.
- Ресурсы контроля сетевой связности (NetworkPolicy) — управляют входящим и исходящим сетевым трафиком в пространстве имён. Таким образом, можно настроить разрешенные подключения между подами, улучшить безопасность и управляемость сетевого взаимодействия в рамках проекта.

Эти инструменты можно комбинировать, чтобы настроить проект в соответствии с требованиями вашего приложения.

## Управление доступом к платформам

Проекты позволяют настраивать доступ пользователей к различным **возможностям проекта (Project Features)** внутри экосистемы Deckhouse. Для каждого проекта можно задать определённый уровень доступа:

- Deckhouse Kubernetes Platform;
- Deckhouse Virtualization Platform;
- Deckhouse Kubernetes Platform + Deckhouse Virtualization Platform.

Таким образом, проекты и проектные пространства имён позволяют гибко разграничивать, кто и как может использовать возможности экосистемы Deckhouse, обеспечивая как безопасность, так и удобство при совместной работе над инфраструктурой.

## Создание проекта

Для создания проекта используются следующие ресурсы:

- [ProjectTemplate](TODO) — описывает шаблон проекта. Задает список ресурсов и уровни доступа, которые будут созданы в рамках проекта. Также он содержит схему параметров, которые можно передать при создании проекта;
- [Project](TODO) — описывает конкретный проект, связанный с шаблоном проекта.

При создании Project из определенного ProjectTemplate происходит следующее:

1. Переданные [параметры](cr.html#project-v1alpha2-spec-parameters) валидируются по OpenAPI-спецификации (параметр [openAPI](cr.html#projecttemplate-v1alpha1-spec-parametersschema) ресурса [ProjectTemplate](cr.html#projecttemplate));
1. Выполняется рендеринг [шаблона для ресурсов](cr.html#projecttemplate-v1alpha1-spec-resourcestemplate) с помощью [Helm](https://helm.sh/docs/). Значения для рендеринга берутся из параметра [parameters](cr.html#project-v1alpha2-spec-parameters) ресурса [Project](cr.html#project);
1. Создаётся пространство имён с именем, которое совпадает c именем [Project](cr.html#project);
1. По очереди создаются все ресурсы, описанные в шаблоне.

{% alert level="warning" %}
При изменении шаблона проекта, все созданные проекты будут обновлены в соответствии с новым шаблоном.
{% endalert %}

## Создание проектного пространства имён

Для создания проектного пространства имён используется ресурс [ProjectNamespace](TODO). Он описывает конкретное проектное пространство имён. В нём задается список ресурсов и уровни доступа, которые проектное пространство имён может использовать внутри проекта.

При создании [ProjectNamespace](TODO) происходит следующее:

1. Поле [spec.project](TODO) проверяется на наличие родительского Project;
1. Проверяется имя ресурса — значение `metadata.name` должно начинаться с <project>- и не превышать 61 символ;
1. Создаётся пространство имён Kubernetes с именем из `metadata.name`;
1. К созданному пространству имён применяются унаследованные из Project квоты (ResourceQuota), RoleBinding и LimitRange, если они не были заданы в [ProjectNamespace](TODO).

## Типичные сценарии применения

Типичный сценарий применения проектов и проектных пространств имён заключается в разделении существующего пространства имён на несколько связанных между собой, которые могут быть выделены для разных команд или сервисов. Рассмотрим пример разделения пользовательского приложения, развернутого в пространстве имен `delivery`. В этом приложении есть frontend и backend-часть, с набором соответствующих ресурсов:

```text
Рабочий вариант схемы, будет изменён позже.

Project: delivery
      └─ Namespace: delivery          ← Основное пространство имён
            ├─ Deployment: frontend
            └─ Deployment: backend
```

При помощи проектных пространств имён можно выделить в проекте две части, изолировав frontend и backend друг от друга. При этом на них будут распространяться квоты проекта, если они не заданы для каждого пространства имен проекта явно:

```text
Рабочий вариант схемы, будет изменён позже.

Project: delivery
│     └─ Namespace: delivery                                           ← Основное пространство имён
│           └─ ResourceQuota (4 CPU, 40 GiB RAM, 2 ProjectNamespaces)  ← Ограничение ресурсов проекта
│
├─ ProjectNamespace: delivery-front
│     └─ Namespace: delivery-front                ← Проектное пространство имён, изолированная часть приложения, относящаяся к frontend.
│           ├─ ResourceQuota (1 CPU, 10 GiB RAM)  ← Ограничение ресурсов проектного пространства имён (не превышает квоты проекта)
│           └─ Deployment: frontend
│
├─ ProjectNamespace: delivery-front
      └─ Namespace: delivery-front                ← Проектное пространство имён, изолированная часть приложения, относящаяся к backend.
            ├─ ResourceQuota (3 CPU, 30 GiB RAM)  ← Ограничение ресурсов проектного пространства имён (не превышает квоты проекта)
            └─ Deployment: backend
```

Данное разделение поможет распределить доступные проекту ресурсы, а также разграничить уровни доступа между пользователями внутри проекта. Если Администратор платформы ограничит доступ к ресурсам проектного пространства имён `delivery-front`, то Пользователи, имеющие доступ к проектному пространству имён `delivery-back`, не будут иметь доступ к ресурсам `delivery-front`.
