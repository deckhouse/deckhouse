---
title: Настройка уведомлений о новых релизах
permalink: ru/admin/configuration/update/notifications.html
lang: ru
---

Deckhouse Kubernetes Platform (DKP) генерирует [алерты](#алерты-в-системе-мониторинга) в систему мониторинга и может автоматически отправлять уведомления о будущих минорных обновлениях во внешние системы.
Это помогает заранее планировать обновления и подготовиться к ним.

Условия отправки уведомлений во внешние системы:

- Для DKP установлен [автоматический режим обновления](configuration.html#автоматическое-обновление).
- Планируется смена минорной версии (уведомления о патч-версиях не отправляются).
- Настроен вебхук для уведомлений.


## Алерты в системе мониторинга

Если обновление требует внесения изменений в кластер (например, обновление версии Kubernetes или ОС), DKP сгенерирует специальные предупреждения. Среди них:

- **D8NodeHasDeprecatedOSVersion** — в кластере обнаружены узлы с неподдерживаемой версией ОС.
- **HelmReleasesHasResourcesWithDeprecatedVersions** — в некоторых Helm-релизах используются устаревшие ресурсы.
- **KubernetesVersionEndOfLife** — установленная версия Kubernetes более не поддерживается.

При появлении данных предупреждений обязательно устраните их перед обновлением. Это поможет избежать сбоев в работе кластера и обеспечить его стабильность после обновления.

## Настройка уведомлений

Чтобы включить отправку уведомлений через настроенный вебхук,
укажите следующие параметры в разделе `update.notification` модуля `deckhouse`(#TODO).

- `update.notification.webhook` — URL-адрес для отправки уведомлений. POST-запрос с информацией об обновлении отправляется сразу после появления новой минорной версии на используемом канале обновлений, но до установки обновления в кластере.
- `update.notification.auth` — параметры аутентификации при вызове вебхука. Если параметр не указан, аутентификация не используется.
  - `update.notification.auth.basic` — базовый вариант аутентификации. Имя пользователя и пароль передаются в заголовке `Authorization` в формате `Basic <base64(username:password)>`.
    - `update.notification.auth.basic.username` — имя пользователя.
    - `update.notification.auth.basic.password` — пароль.
  - `update.notification.auth.bearerToken` — аутентификация с использованием токена. Токен передаётся в заголовке `Authorization` в формате `Bearer <token>`.
- `update.notification.minimalNotificationTime` — минимальный интервал между появлением новой минорной версии на используемом канале обновлений и началом обновления. Указывается в часах и минутах: `30m`, `1h`, `2h30m`, `24h`. Если настроено [окно обновлений](configuration.html#окна-обновлений), то сначала учитывается интервал `minimalNotificationTime`, после чего произойдёт установка обновления, но только в рамках заданного окна.
- `update.notification.tlsSkipVerify` — отключение проверки TLS-сертификата при вызове вебхука (например, если используется самоподписанный сертификат). По умолчанию `false`.

Пример настройки `update.notification` с базовой аутентификацией:

```yaml
update:
  notification:
    webhook: https://release-webhook.mydomain.com
    minimalNotificationTime: 4h
    auth:
      basic:
        username: myusername
        password: mypassword
    tlsSkipVerify: true
```

## Формат уведомлений

При выполнении условий отправки уведомления
DKP отправляет на указанный вебхук POST-запрос с заголовком `Content-Type: application/json`.

Пример тела запроса:

```json
{
  "version": "1.68",
  "requirements":  {"k8s": "1.29.0"},
  "changelogLink": "https://github.com/deckhouse/deckhouse/blob/main/CHANGELOG/CHANGELOG-v1.68.md",
  "applyTime": "2025-02-01T14:30:00Z00:00",
  "message": "New Deckhouse Release 1.68 is available. Release will be applied at: Wednesday, 05-Feb-25 14:30:00 UTC"
}
```

Описание полей:

- `version` — номер минорной версии (строка).
- `requirements` — объект с требованиями к новой версии (например, минимальная версия Kubernetes).
- `changelogLink` — ссылка на changelog с описанием изменений в новой минорной версии.
- `applyTime` — дата и время планируемого обновления в формате RFC3339. Учитывает заданные окна обновлений.
- `message` — короткое текстовое уведомление о доступной минорной версии и запланированном времени её установки.

