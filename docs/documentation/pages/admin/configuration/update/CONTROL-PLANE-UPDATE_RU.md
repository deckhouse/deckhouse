---
title: Обновление Control Plane
permalink: ru/admin/configuration/update/control-plane-update.html
---

# Обновление Control Plane Kubernetes

В Deckhouse Kubernetes Platform процесс обновления Control Plane максимально автоматизирован и безопасен — как для single-master-, так и для multi-master-кластеров. При этом могут возникать кратковременные перерывы в доступности API-сервера, однако на работу приложений внутри кластера обновление не влияет. Дополнительного окна для регламентных работ обычно не требуется.

## Поддерживаемые версии и режимы обновления

- Поддерживаются [последние пять минорных версий Kubernetes](link).
- **Patch-версии** (например, с `1.27.3` на `1.27.5`) обновляются автоматически вместе с версией Deckhouse. Управлять таким обновлением невозможно.
- **Минорные версии** (например, с `1.26.*` на `1.28.*`) можно обновлять вручную или в автоматическом режиме с помощью параметра [`kubernetesVersion`](link).
  - Если установить `kubernetesVersion: Automatic`, будет использоваться минорная версия по умолчанию (указана в [документации](link)).
  - Если же указать конкретную версию, Deckhouse обновит Control Plane именно до неё.

## Процесс обновления

### Этап обновления компонентов Control Plane

1. Control-plane-manager вносит изменения в манифесты основных компонентов (apiserver, controller-manager, scheduler и т. д.).
2. Обновлённые компоненты разворачиваются на всех мастер-узлах.

В случае **upgrade** (переход на более новую минорную версию):
- Если нужно поднять версию сразу на несколько минорных релизов (например, `1.26 -> 1.28`), обновление пройдёт поэтапно: `1.26 -> 1.27`, затем `1.27 -> 1.28`.
- На каждом этапе сначала обновляется Control Plane, а затем выполняется обновление kubelet на узлах.

В случае **downgrade** (понижение версии):
- Гарантируется успешный откат только на одну версию назад от максимальной минорной версии, когда-либо использовавшейся в кластере.
- Порядок действий при откате — обратный: сначала откатываются компоненты kubelet на узлах, затем — компоненты Control Plane.

### Этап обновления рабочих узлов (kubelet)

После завершения обновления Control Plane начинается обновление узлов кластера:
- Bashible API Server меняет версию kubelet в скриптах для всех групп узлов (NodeGroup).
- Обновление в разных NodeGroup идёт параллельно, однако внутри каждой NodeGroup узлы обновляются последовательно, по одному.
- Для каждой группы учитываются её настройки:
  - Ручной или автоматический режим обновления.
  - Наличие «окон» для обновлений.
  - Нужно ли удалять Pod-ы с узла перед обновлением и т. д.
- Выбирается один (или несколько) кандидатов, удовлетворя всем условиям обновления, после чего происходит обновление этого узла.
- Процесс повторяется, пока не будут обновлены все узлы во всех группах.

Когда все узлы всех групп обновлены, процесс обновления завершается.
