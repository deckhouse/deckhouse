---
title: Тестирование отказоустройчивости кластера
permalink: ru/admin/high-reliability-and-availability/chaos-testing.html
description: Тестирование отказоустройчивости кластера
lang: ru
---

Правильно настроенный кластер должен быть устойчив к различным ситуациям, возникающим в процессе работы: таким как внезапнвые отключения узлов или компонентов, потеря связности и так далее. Это приводит к ожиданию от кластера стабильности в любой ситуации — намеренно или случайно удалённые компоненты не должны приводить к выходу из строя всей системы, а работоспособность не должна нарушаться.

Для проверки кластера на устойчивость все важные компоненты DKP имеют инструменты хаос-инжиниринга, которые позволяют либо прогнозируемо, либо в случаеном порядке выводить из строя те или компоненты и смотреть, как реагирует на это инсфраструктура.

За этот режим отвечает компонент Chaos Monkey. Он входит в модуль управления узлами кластера и предназначен для верификации отказоустойчивости элементов кластера и запущенных приложений.

Чтобы включить этот режим укажите в параметры тестируемой группы узлов (NodeGroup) параметр `spec.chaos` с двумя параметрами:

```yaml
chaos:
  mode: DrainAndDelete
  period: 24h
```

Здесь:

* `mode` — режим работы, доступны два варианта:
  * `DrainAndDelete` — при срабатывании делает узлу drain, затем удаляет его.
  * `Disabled` — не трогает эту конкретную NodeGroup.
* `period` — интервал времени срабатывания Chaos Monkey, задается в виде строки с указанием часов и минут: `30m`, `1h`, `2h30m`, `24h`.

Пример настройки для группы узлов:

```yaml
# NodeGroup для облачных узлов в AWS.
apiVersion: deckhouse.io/v1
kind: NodeGroup
metadata:
  name: test
spec:
  nodeType: CloudEphemeral
  chaos:
    mode: DrainAndDelete
    period: 24h
...
```
