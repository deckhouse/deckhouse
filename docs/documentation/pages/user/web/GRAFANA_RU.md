---
title: "Grafana"
permalink: ru/user/web/grafana.html
lang: ru
---

## Веб-интерфейс системы мониторинга

В качестве веб-интерфейса системы мониторинга используется Grafana.

### Главный экран

На главном экране Grafana расположена основная информация о кластере и его основных компонентах.

В левой верхней части экрана указаны характеристики основных компонентов кластера: версия `containerd`, дистрибутив Linux, на базе которого работает кластер, а также версии Grafana, Prometheus и т.д.

В правой верхней части экрана расположены удобные графические обозначения для основных параметров — количества узлов кластере, количество запущенных в ней подов и других сущностей кластера.

Для получения более подробной информации можно навести на любой элемент курсор мыши, нужная информация отображается во всплывающей подсказке.

Ниже блоков с характеристиками расположены быстрые ссылки на дашборды некоторых компонентов кластера. Например, на мониторинг узлов кластера, потребления системных ресурсов его компонентами и статистику сетевого взаимодействия.

Левее расположен блок со ссылками на веб-интерфейсы кластера, доступные для пользователя, а также блок с информацией о способе обновления кластера и временных окнах, в которые это обновление должно произойти (если они настроены).

В левом верхнем углу главного экрана расположена кнопка открытия бокового меню, в котором расположены ссылки на основные элементы Grafana.

При переходе на вкладку «Dashboards» откроется список всех доступных дашбордов Deckhouse, сгруппированных по категориям.

Они имеют вложенную структуру и сгруппированы по назначению — приложения в кластере (Applications), сетевое взаимодействие (Ingress Nginx), параметры кластера (Kubernetes Cluster), основные (Main) и безопасность (Security).

![Главный экран Grafana](../../images/grafana/grafana-main.png)

### Работа с дашбордами

Дашборд представляет собой экран с расположенными на нем таблицами и графиками, содержащими информацию о выбранном компоненте кластера.

![Дашборд](../../images/grafana/dashboard.png)

### Фильтрация информации

В верхней части под названием и быстрой ссылкой на родительскую категорию располагается блок фильтров, позволяющий настроить отображение, исключив из выдачи несущественную информацию или сконцентрировав выбор на одном конкретном компоненте.

![Блок фильтров](../../images/grafana/filter.png)

На приведенном выше примере с дашбордом узлов кластера можно задать в фильтре отображение только одного из трех узлов, исключив из выдачи информацию об остальных двух узлах.

![Применение фильтров](../../images/grafana/filter1.png)

После выбора в фильтре параметров дашборд сразу же изменится, и содержимое будет заменено на соответствующее заданным параметрам фильтрации.

![Отображение информации](../../images/grafana/filter1.png)

### Работа с данными

Каждый из представленных на дашборде графиков можно открыть в более подробном виде. Для этого необходимо навести курсор на правый верхний угол блока с графиком, нажать на появившуюся кнопку с тремя точками и выбрать пункт «View».

![Вывод графика](../../images/grafana/graph.png)

Выбранный график откроется на весь экран.

![Пример графика](../../images/grafana/graph2.png)

Здесь можно просмотреть более подробно информацию на графике за определенный момент времени. Для этого нужно навести курсор мыши на график — он примет вид красной горизонтальной черты, а рядом с ним отобразится всплывающее окошко с временной меткой и значением графика на этот момент:

![График за определенный момент времени](../../images/grafana/graph3.png)

Для перехода обратно на предыдущий экран достаточно нажать «Esc».
Просмотреть подробно список записей из которых строится график, можно, выбрав в меню блока (по кнопке с тремя точками в правом верхнем углу блока) пункт «Inspect» и соответствующий запросу подпункт «Data».

![Настройка просмотра списка записей из которых строится график](../../images/grafana/graph4.png)

В правой части экрана откроется окно с подробным содержанием записей.

![Содержание записей из которых строится график](../../images/grafana/graph5.png)

В открывшемся окне отобразятся все данные, из которых построен график. Здесь их также можно скачать в формате CSV и просмотреть общую статистику (например, общее количество записей). Для этого необходимо перейти на вкладку «Stats» окна со с данными.

![Скачивание данных графика](../../images/grafana/graph6.png)

### Описание дашбордов

Дашборд «Applications – Log Shipper» — состояние модуля `log-shipper`. Здесь представлено количество агентов модуля на узлах и их нагрузка.

![Log Shipper](../../images/grafana/log_shipper.png)

Дашборд «Applications – Loki» — состояние модуля `loki`.

![Loki](../../images/grafana/loki.png)

Дашборд «Applications – Loki Logs» — логи модуля `loki`.

![Loki Logs](../../images/grafana/loki_logs.png)

Дашборды группы Ingress Nginx — дашборды, связанные с Ingress-контроллерами:

- Дашборд «Namespace Detail» — на этом дашборде отображается детализация компонентов в пространстве имен. В фильтрах возможно выбрать конкретное пространство имен, Ingress, Service и другие параметры для отображения.

  ![Namespace Detail](../../images/grafana/namespace_detail.png)

- Дашборд «Namespaces» — данные по Ingress-контроллеру в разрезе пространств имен кластера. В фильтрах можно выбрать конкретное пространство имен, виртуальные хосты и тип контента.

  ![Namespaces](../../images/grafana/namespaces.png)

- Дашборд «VHost Detail» — подробные данные по Ingress-контроллеру в разрезе виртуальных хостов.

  ![VHost Detail](../../images/grafana/vhost_details.png)

- Дашборд «VHost» — сводные данные по Ingress-контроллеру в разрезе виртуальных хостов кластера. В фильтрации можно выбрать конкретный виртуальный хост.

  ![VHost](../../images/grafana/vhost.png)

Дашборды группы «Kubernetes Cluster» — дашборды, связанные с кластером Kubernetes:

- Дашборд «Aggregating Proxy Cache» — сводная информация по потребляемым прокси-сервером ресурсам.

  ![Aggregating Proxy Cache](../../images/grafana/aggregating-proxy-cache.png)

- Дашборд «Cilium Metrics» — метрики модуля `cni-cilium`.

  ![Cilium Metrics](../../images/grafana/cilium-metrics.png)

- Дашборд «Control Plane Status» — состояние управляющего слоя кластера.

  ![Control Plane Status](../../images/grafana/control-plane-status.png)

- Дашборд «Deprecated APIs» — отображает состояния Kubernetes API, которое на текущий момент находится в состоянии прекращения поддержки. Также на нем расположены инструкции по миграции на актуальные версии и запросы к эндпойнтам этого API.

  ![Deprecated APIs](../../images/grafana/deprecated-apis.png)

- Дашборд «DNS (coredns)» — данные о работе компонента CoreDNS.

  ![DNS (coredns)](../../images/grafana/dns.png)

- Дашборд «etcd3» — состояние базы данных etcd.

  ![etcd3](../../images/grafana/etcd.png)

- Дашборд «External ping» — статистика внешних запросов.

  ![External ping](../../images/grafana/external-ping.png)

- Дашборд «Ingress Nginx Controller Detail» — параметры Ingress-контроллера.

  ![Ingress Nginx Controller Detail](../../images/grafana/ingress-nginx-controller-detail.png)

- Дашборд «Ingress Nginx Controllers» — подробные данные об Ingress-контроллерах кластера.

  ![Ingress Nginx Controllers](../../images/grafana/ingress-nginx-controllers.png)

- Дашборд «Node» — данные о работе узлов. В фильтрах можно выбрать целевой узел для отображения статистики.

  ![Node](../../images/grafana/node.png)

- Дашборд «Nodes» — сводные данные о работе узлов кластера. В фильтрах можно выбрать конкретный узел.

  ![Nodes](../../images/grafana/nodes.png)

- Дашборд «Nodes ping» — пинг до узлов кластера.

  ![Nodes ping](../../images/grafana/nodes-ping.png)

- Дашборд «NTP» — состояние сервера времени.

  ![NTP](../../images/grafana/ntp.png)

- Дашборд «Prometheus Benchmark» — статус модуля `prometheus`.

  ![Prometheus Benchmark](../../images/grafana/prometheus-benchmark.png)

- Дашборд «Prometheus-(self)» — сводная информация о состоянии модуля `prometheus`.

  ![Prometheus-(self)](../../images/grafana/prometheus-self.png)

Дашборды группы «Main» — дашборды с общими данными о состоянии кластера:

- Дашборд «Capacity Planning» — сводные данные о производительности кластера.

  ![Capacity Planning](../../images/grafana/capacity-planning.png)

- Дашборд «Deckhouse» — сводная информация о состоянии главного компонента `deckhouse`.

  ![Deckhouse](../../images/grafana/deckhouse.png)

- Дашборд «Namespace» — данные по конкретному пространству имен кластера.

  ![Namespace](../../images/grafana/namespace1.png)

- Дашборд «Namespace / Controller» — данные по контроллерам в пространствах имен. В фильтрах можно выбрать конкретные пространства имен и контроллеры.

  ![Namespace-controller](../../images/grafana/namespace-controller.png)

- Дашборд «Namespace / Controller / Pod» — данные по подам в пространствах имен. В фильтрах можно выбрать определенные пространства имен и поды в них.

  ![Namespace-controller-pod](../../images/grafana/namespace-controller-pod.png)

- Дашборд «Namespaces» — сводные данные в разрезе пространств имен в кластере.

  ![Namespaces](../../images/grafana/namespace2.png)

### Просмотр журналов событий безопасности

Просмотр журналов событий безопасности осуществляется в веб-интерфейсе Grafana. Необходимые дашборды сгруппированы в папке «Security»:

- Admission policy engine. Содержит информацию, связанную с работой политик безопасности. В том числе: количество событий запрета выполнения действий из-за нарушения политики безопасности; разбивку запретов выполнения действий по типу запрета; журнал событий.
  Журнал событий безопасности, связанных с политиками безопасности, находится в окне OPA Violations.

  Пример дашборда Admission policy engine.

- CIS Kubernetes Benchmark. Дашборд с информацией о результатах работы сканера проверок конфигурации кластера на соответствие принятым подходам (лучшим практикам). Содержит сводную информацию о результатах проверки, без возможности детализации. Дашборд доступен при включенном модуле `operator-trivy`.

  Пример дашборда CIS Kubernetes Benchmark.

- Kubernetes audit logs. Журнал регистрации обращений к API-серверу. Содержит записи о всех обращениях к API-серверу кластера в JSON-формате.

  Пример дашборда Kubernetes audit logs.

- Runtime audit engine logs. Журнал регистрации событий безопасности аудита работы ядра Linux и API-сервера кластера.

  Пример дашборда Runtime audit engine logs.

- Trivy Image Vulnerability Overview. Дашборд со сводной и детализированной информацией о сканировании образов контейнеров подов в пространствах имен, отмеченных аннотацией `security-scanning.deckhouse.io/enabled`.

  Пример дашборда Trivy Image Vulnerability Overview.
