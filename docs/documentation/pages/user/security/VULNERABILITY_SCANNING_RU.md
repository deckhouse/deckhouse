---
title: "Сканирование контейнерных образов на уязвимости"
permalink: ru/user/security/scanning.html
lang: ru
---

Deckhouse Kubernetes Platform (DKP) соответствует рекомендациям [CIS Kubernetes Benchmark](https://deckhouse.ru/security/), обеспечивая безопасность как на уровне отдельных компонентов, так и всей платформы в целом.

Для постоянного мониторинга соответствия требованиям CIS в каждом кластере DKP автоматически выполняются проверки.
Результаты этих проверок представлены в виде отчётов и доступны в Grafana на дашборде Security / CIS Kubernetes Benchmark.

DKP предоставляет встроенное средство для автоматического поиска уязвимостей в контейнерных образах на основе проекта [Trivy](https://github.com/aquasecurity/trivy).

Ниже приведены команды для просмотра и фильтрации отчётов о результатах сканирования уязвимостей и CIS compliance-проверок, выполненных в кластере.

## Просмотр результатов CIS compliance-проверки

- Чтобы вывести все ресурсы, которые не прошли проверку:

  ```shell
  d8 k get clustercompliancereports.aquasecurity.github.io cis -ojson |
    jq '.status.detailReport.results | map(select(.checks | map(.success) | all | not))'
  ```

- Чтобы выполнить поиск по идентификатору конкретной проверки:

  ```shell
  check_id="5.7.3"
  d8 k get clustercompliancereports.aquasecurity.github.io cis -ojson |
    jq --arg check_id "$check_id" '.status.detailReport.results | map(select(.id == $check_id))'
  ```

- Чтобы выполнить поиск по описанию проверки:

  ```shell
  check_desc="Apply Security Context to Your Pods and Containers"
  d8 k get clustercompliancereports.aquasecurity.github.io cis -ojson |
    jq --arg check_desc "$check_desc" '.status.detailReport.results | map(select(.description == $check_desc))'
  ```

## Доступ к результатам сканирования

Доступ к результатам сканирования (в том числе возможность просматривать [ресурсы с результатами](../../admin/configuration/security/scanning.html)) предоставляется пользователям, обладающим следующими [ролями доступа](../../admin/configuration/access/authorization/rbac-experimental.html):

- `d8:manage:networking:viewer` или выше;
- `d8:manage:permission:module:operator-trivy:view`.

## Ограничение списка сканируемых ресурсов в пространстве имён

В текущей версии функциональности ограничения перечня ресурсов для сканирования в пространстве имён не предусмотрено.  
Оператор сканирует **все ресурсы**, находящиеся в пространстве имён, помеченном меткой `security-scanning.deckhouse.io/enabled=""`.

## Просмотр отчёта сканирования своего приложения

Для просмотра результатов сканирования вашего приложения воспользуйтесь Grafana-дашбордом `Security / Trivy Image Vulnerability Overview`. 
Вы можете отфильтровать результаты по нужному пространству имён и ресурсу.

![Пример дашборда в Grafana](../../images/operator-trivy/trivy-image-vulnerability-dashboard.png)

Также вы можете напрямую просматривать [ресурсы](../../admin/configuration/security/scanning.html) с результатами сканирования, которые создаются для каждого сканируемого объекта.  
