image: {{ .ModuleName }}/{{ .ImageName }}
{{ if eq .ModuleName "docs" }}
fromImage: builder/alpine-3.20
shell:
  beforeSetup:
  - apk add --no-cache nginx
  setup:
  - |
      cat <<"EOD" > /etc/nginx/nginx.conf
      {{- .Files.Get ".werf/nginx.conf" | nindent 6 }}
      EOD
import:
- image: {{ .ModuleName }}/{{ .ImageName }}/static
  add: /app/_site
  to: /app
  before: setup
imageSpec:
  config:
    entrypoint: [ "nginx", "-e", "/dev/stderr", "-g", "daemon off;" ]
{{ else }}
fromImage: common/nginx-static
git:
{{- include "image mount points" . }}
import:
- image: {{ .ModuleName }}/{{ .ImageName }}/static
  add: /app/_site/documentation
  to: /app/platform
  before: setup
  excludePaths:
  - '*/gs/'
  - '*/guides/'
  - search-index.json
  - '*/sitemap*.xml'
  - '*/robots.txt'
imageSpec:
  config:
    entrypoint: [ "/opt/nginx-static/sbin/nginx", "-e", "/dev/stderr", "-g", "daemon off;" ]
{{ end }}
---
{{ tpl (.Files.Get (printf "%sdocs/documentation/werf-web-modules-static.inc.yaml" .ModulePath)) . }}
