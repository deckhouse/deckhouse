---
image: install-standalone-builder
final: false
from: {{ .Images.BASE_ALPINE }}
git:
- add: /
  to: /image/deckhouse
  includePaths:
  - candi
  {{ .Files.Get (printf "tools/build_includes/candi-%s.yaml" .Env) }}
import:
{{ include "installer_and_installer_standalone_generic_imports" (dict "Env" $.Env) }}
{{ include "installer_and_installer_standalone_terraform_imports" (dict "Env" $.Env "TF" $.TF "Editions" $.Editions) }}
shell:
  setup:
  - echo '{{- env "CI_COMMIT_TAG" | default "dev" }}' > /image/deckhouse/version
  - cd /image
  - tar -czf /dhctl-{{- env "CI_COMMIT_TAG" | default "dev" }}.x86_64.tar.gz *

---
image: dev/install-standalone
from: {{ .Images.BASE_SCRATCH }}
import:
- image: install-standalone-builder
  add: /dhctl-{{- env "CI_COMMIT_TAG" | default "dev" }}.x86_64.tar.gz
  to: /
  before: setup
