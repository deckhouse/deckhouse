# Вебхуки миграции

Вебхуки в поддиректории `migrate` предназначены для выполнения задач по миграции данных и конфигураций при обновлении версий Deckhouse. Они обеспечивают обратную совместимость, удаляют устаревшие ресурсы и обновляют конфигурации для соответствия новым требованиям системы. Эти вебхуки обычно выполняются однократно при обновлении и больше не запускаются.

## Список вебхуков

- вебхук 1
    - название: grafana_v8_cleanup.go
    - назначение: Удаляет устаревшие ресурсы Grafana v8 (Deployment, Service, Ingress), которые были заменены новой версией.
    - пример использования: Запускается после обновления с версии, где использовался Grafana v8, и очищает кластер от старых компонентов.
- вебхук 2
    - название: migrate_cluster_configuration_label.go
    - назначение: Добавляет метку `name: d8-cluster-configuration` к секрету `d8-cluster-configuration` для обеспечения совместимости с новыми версиями.
    - пример использования: Выполняется однократно при обновлении, чтобы новая логика могла корректно находить этот секрет.
- вебхук 3
    - название: migrate_descheduler.go
    - назначение: Мигрирует конфигурацию модуля `descheduler` из старого формата (ModuleConfig) в новый (ConfigMap `descheduler-config-migration`).
    - пример использования: При обновлении с версии, где `descheduler` настраивался через ModuleConfig, этот вебхук создает ConfigMap с теми же настройками.
- вебхук 4
    - название: migrate_k8s_upgrade.go
    - назначение: Создает ClusterRoleBinding `kubeadm:cluster-admins` после обновления кластера до Kubernetes 1.29 для обеспечения совместимости.
    - пример использования: Запускается при обновлении кластера, если обнаруживается, что версия Kubernetes >= 1.29, и создает необходимую привязку ролей.