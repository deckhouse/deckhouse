// Code generated by go generate; DO NOT EDIT.
// This file is generated from feature_gates_map.yml

package hooks

import (
	"fmt"
)

type ComponentFeatures struct {
	Deprecated            []string
	Forbidden             []string
	Kubelet               []string
	APIServer             []string
	KubeControllerManager []string
	KubeScheduler         []string
}

type FeatureGateInfo struct {
	Exists bool
	IsDeprecated bool
	IsForbidden bool
}

var FeatureGatesMap = map[string]ComponentFeatures{
	"1.29": {
		Kubelet: []string{
			"CPUManager",
			"MemoryManager",
		},
		APIServer: []string{
			"APIServerIdentity",
			"StorageVersionAPI",
		},
		KubeControllerManager: []string{
			"CronJobsScheduledAnnotation",
		},
		KubeScheduler: []string{
			"SchedulerQueueingHints",
		},
	},
	"1.30": {
		Kubelet: []string{
			"CPUManager",
			"MemoryManager",
		},
		APIServer: []string{
			"APIServerIdentity",
			"StorageVersionAPI",
		},
		KubeControllerManager: []string{
			"CronJobsScheduledAnnotation",
		},
		KubeScheduler: []string{
			"SchedulerQueueingHints",
		},
	},
	"1.31": {
		Kubelet: []string{
			"CPUManager",
			"MemoryManager",
		},
		APIServer: []string{
			"APIServerIdentity",
			"StorageVersionAPI",
		},
		KubeControllerManager: []string{
			"CronJobsScheduledAnnotation",
		},
		KubeScheduler: []string{
			"SchedulerQueueingHints",
		},
	},
	"1.32": {
		Kubelet: []string{
			"CPUManager",
			"MemoryManager",
		},
		APIServer: []string{
			"APIServerIdentity",
			"StorageVersionAPI",
		},
		KubeControllerManager: []string{
			"CronJobsScheduledAnnotation",
		},
		KubeScheduler: []string{
			"SchedulerQueueingHints",
		},
	},
	"1.33": {
		Deprecated: []string{
			"DynamicResourceAllocation",
		},
		Forbidden: []string{
			"SomeProblematicFeature",
		},
		Kubelet: []string{
			"CPUManager",
			"MemoryManager",
		},
		APIServer: []string{
			"APIServerIdentity",
			"StorageVersionAPI",
		},
		KubeControllerManager: []string{
			"CronJobsScheduledAnnotation",
		},
		KubeScheduler: []string{
			"SchedulerQueueingHints",
		},
	},
}

func (cf *ComponentFeatures) GetFeatureGateInfo(component, featureName string) FeatureGateInfo {
	info := FeatureGateInfo{}
	for _, name := range cf.Deprecated {
		if name == featureName {
			info.IsDeprecated = true
			break
		}
	}

	for _, name := range cf.Forbidden {
		if name == featureName {
			info.IsForbidden = true
			break
		}
	}

	var featureList []string
	switch component {
	case "kubelet":
		featureList = cf.Kubelet
	case "apiserver":
		featureList = cf.APIServer
	case "kube-controller-manager":
		featureList = cf.KubeControllerManager
	case "kube-scheduler":
		featureList = cf.KubeScheduler
	default:
		return info
	}

	for _, name := range featureList {
		if name == featureName {
			info.Exists = true
			return info
		}
	}

	return info
}

func (cf *ComponentFeatures) IsForbidden(feature string) bool {
	for _, f := range cf.Forbidden {
		if f == feature {
			return true
		}
	}
	return false
}

func (cf *ComponentFeatures) IsDeprecated(feature string) bool {
	for _, f := range cf.Deprecated {
		if f == feature {
			return true
		}
	}
	return false
}

func (cf *ComponentFeatures) ValidateFeature(feature string) error {
	if cf.IsForbidden(feature) {
		return fmt.Errorf("feature gate %s is forbidden", feature)
	}
	if cf.IsDeprecated(feature) {
		return fmt.Errorf("feature gate %s is deprecated", feature)
	}
	return nil
}
