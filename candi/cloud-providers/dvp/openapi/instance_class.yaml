apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: dvpinstanceclasses.deckhouse.io
  labels:
    heritage: deckhouse
    module: cloud-provider-dvp
spec:
  group: deckhouse.io
  preserveUnknownFields: false
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          required:
            - spec
          properties:
            spec:
              type: object
              required: [virtualMachine, rootDisk]
              properties:
                virtualMachine:
                  type: object
                  description: |
                    VM settings for the created master node.
                  required: [cpu, memory]
                  properties:
                    cpu:
                      description: |
                        CPU setting for VM.
                      type: object
                      additionalProperties: false
                      required: [cores]
                      properties:
                        cores:
                          description: |
                            Amount of CPU cores for VM.
                          minumum: 1
                          format: int32
                          type: integer
                        coreFraction:
                          type: string
                          default: "100%"
                          enum: ["5%", "10%", "25%", "50%", "100%"]
                          description: |
                            Guaranteed share of CPU that will be allocated to the VM. Specified as a percentage.
                            Supported values: `5%`, `10%`, `25%`, `50%`, `100%`.
                          example: "100%"
                    memory:
                      type: object
                      description: |
                        Specifies the memory settings for the VM.
                      required:
                        - size
                      properties:
                        size:
                          type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          description: |
                            Amount of memory resources allowed for VM.
                          example: 4Gi
                    bootloader:
                      type: string
                      enum:
                        - BIOS
                        - EFI
                        - EFIWithSecureBoot
                      default: EFI
                      description: >
                        Defines a bootloader for a VM.


                        * `BIOS`: Use BIOS.

                        * `EFI`: Use Unified Extensible Firmware (EFI/UEFI).

                        * `EFIWithSecureBoot`: Use UEFI/EFI with the Secure Boot
                        support.
                rootDisk:
                  type: object
                  description: |
                    Specifies settings for the root disk of VM.
                  required:
                    - size
                    - image
                  properties:
                    size:
                      type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      description: |
                        Root disk size.
                      example: 10Gi
                    storageClass:
                      type: string
                      description: |
                        The name of the existing StorageClass will be used to create the VM's root disk.
                    image:
                      type: object
                      description: |
                        Image parameters that will be used to create the VM's root disk.
                      required:
                        - kind
                        - name
                      properties:
                        kind:
                          type: string
                          description: |
                            The kind of the image source.
                          enum:
                            - "ClusterVirtualImage"
                            - "VirtualImage"
                            - "VirtualDisk"
                        name:
                          type: string
                          description: |
                            The name of the image that will be used to create the root disk.
                            > The installation requires linux OS images with cloud-init pre-installed
  scope: Cluster
  names:
    plural: dvpinstanceclasses
    singular: dvpinstanceclass
    kind: DVPInstanceClass
    categories:
      - cloudinstanceclasses
