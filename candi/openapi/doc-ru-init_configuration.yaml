apiVersions:
- apiVersion: deckhouse.io/v1
  openAPISpec:
    description: |
      Конфигурация Deckhouse, с которой он запустится после установки.
    properties:
      apiVersion:
        type: string
        description: Используемая версия API Deckhouse.
      deckhouse:
        description: Параметры, необходимые для установки Deckhouse.
        properties:
          imagesRepo:
            description: |
              Адрес container registry с образами Deckhouse.

              Укажите, если используется редакция Enterprise Edition Deckhouse или сторонний container registry (например, прокси-сервер в закрытом окружении).

              Адрес учитывает используемую редакцию Deckhouse. Публичный адрес container registry для Deckhouse Enterprise Edition — `registry.deckhouse.io/deckhouse/ee`.
          registryDockerCfg:
            description: |
              Строка авторизации из файла конфигурации Docker-клиента (в Linux обычно это `$HOME/.docker/config.json`) для доступа к стороннему container registry, закодированная в Base64.

              Например, для доступа к container registry `registry.company.my` под пользователем `user` с паролем `P@ssw0rd` это будет `eyJhdXRocyI6eyJyZWdpc3RyeS5jb21wYW55Lm15Ijp7ImF1dGgiOiJkWE5sY2pwUVFITnpkekJ5WkFvPSJ9fX0K` (строка `{"auths":{"registry.company.my":{"auth":"dXNlcjpQQHNzdzByZAo="}}}` в Base64).
          registryCA:
            description: |
              Корневой сертификат, которым можно проверить сертификат container registry при работе по HTTPS (если registry использует самоподписанные SSL-сертификаты).
          registryScheme:
            description: Протокол доступа к container registry (HTTP или HTTPS).
          releaseChannel:
            description: |
              Используйте параметр [releaseChannel](../modules/deckhouse/configuration.html#parameters-releasechannel) ModuleConfig 'deckhouse' вместо этого параметра.

              Устанавливаемый в кластере канал обновлений Deckhouse.
          devBranch:
            description: |
              Параметр используется для нужд разработки. Будет заменен на аргумент CLI-команды.
          bundle:
            description: |
              Используйте параметр [bundle](../modules/deckhouse/configuration.html#parameters-bundle) ModuleConfig 'deckhouse' вместо этого параметра.

              Устанавливаемый в кластере вариант поставки Deckhouse.
          logLevel:
            description: |
              Используйте параметр [logLevel](../modules/deckhouse/configuration.html#parameters-loglevel) ModuleConfig 'deckhouse' вместо этого параметра.

              Уровень логирования Deckhouse.

- apiVersion: deckhouse.io/v2alpha1
  openAPISpec:
    description: |
      Конфигурация Deckhouse, с которой он запустится после установки.
    additionalProperties: false
    x-examples:
      - apiVersion: deckhouse.io/v2alpha1
        kind: InitConfiguration
        deckhouse:
        registry:
          mode: Direct
          direct:
            imagesRepo: nexus.company.my/deckhouse/ee
            username: "nexus-user"
            password: "nexus-p@ssw0rd"
            scheme: HTTPS
            ca: |
              -----BEGIN CERTIFICATE-----
              ...
              -----END CERTIFICATE-----
      - apiVersion: deckhouse.io/v2alpha1
        kind: InitConfiguration
        deckhouse:
        registry:
          mode: Proxy
          proxy:
            imagesRepo: nexus.company.my/deckhouse/ee
            username: "nexus-user"
            password: "nexus-p@ssw0rd"
            scheme: HTTPS
            ca: |
              -----BEGIN CERTIFICATE-----
              ...
              -----END CERTIFICATE-----
      - apiVersion: deckhouse.io/v2alpha1
        kind: InitConfiguration
        deckhouse:
        registry:
          mode: Detached
          detached:
            imagesBundlePath: ~/deckhouse/bundle.tar
    properties:
      apiVersion:
        type: string
        description: Используемая версия API Deckhouse.
      registry:
        description: Параметры, необходимые для установки Registry.
        properties:
          mode:
            description: |
              Определяет режим доступа к реестру контейнеров для Deckhouse. Этот параметр влияет на то, как будут выбираться и сохраняться образы контейнеров в процессе развертывания:

              - `Direct` — Deckhouse будет напрямую обращаться к указанному docker registry.
              - `Proxy` — Deckhouse настроит модуль system-registry, который будет выполнять функцию кэширующего прокси для указанного docker registry. Данный режим помогает сократить сетевой трафик и повысить скорость загрузки docker образов за счет локального кэширования.
              - `Detached` — Deckhouse создаст автономный docker registry с помощью модуля system-registry, загрузив docker образы из imagesBundle. Необходимо вручную обновить system-registry новыми образами. Подробные инструкции по настройке и обслуживанию приведены в документации.
          direct:
            description: Параметры `Direct` режима.
            properties: &directProperties
              imagesRepo:
                description: |
                  Адрес container registry с образами Deckhouse.

                  Укажите его, если используется Deckhouse Enterprise Edition или сторонний container registry (например, registry в закрытой среде).

                  Адрес должен соответствовать используемой редакции Deckhouse. Публичный адрес container registry для Deckhouse Enterprise Edition — `registry.deckhouse.io/deckhouse/ee`.
              username:
                description: Имя пользователя для доступа к container registry с образами Deckhouse.
              password:
                description: Пароль для доступа к container registry с образами Deckhouse.
              ca:
                description: |
                  Корневой сертификат, которым можно проверить сертификат container registry при работе по HTTPS (если registry использует самоподписанные SSL-сертификаты).
              scheme:
                description: Протокол доступа к container registry (HTTP или HTTPS).
          detached:
            description: Параметры `Detached` режима.
            properties:
              imagesBundlePath:
                description: |
                  Путь к imagesBundle для дистрибутива платформы Deckhouse Kubernetes. Путь можно указать как к папке, так и к .tar архиву.

                  Для получения дополнительной информации о том, как получить imagesBundle, обратитесь к документации по адресу https://deckhouse.io/documentation/v1/deckhouse-faq.html#manually-uploading-images-to-an-air-gapped-registry
          proxy:
            description: Параметры `Proxy` режима.
            properties:
              <<: *directProperties
              ttl:
                description: |
                  TTL определяет время жизни кэшированного контента, по истечении которого он будет автоматически очищен.
                  Значение по умолчанию: Если не указано, TTL по умолчанию составляет 7 дней (168 часов).
                  Постоянный кэш: Если установить значение 0, у кэша не будет срока действия, и данные из него удаляться не будут.
      deckhouse:
        description: Параметры, необходимые для установки Deckhouse.
        properties:
          releaseChannel:
            description: |
              Используйте параметр [releaseChannel](../modules/002-deckhouse/configuration.html#parameters-releasechannel) ModuleConfig 'deckhouse' вместо этого параметра.

              Устанавливаемый в кластере канал обновлений Deckhouse.
          devBranch:
            description: |
              Параметр используется для нужд разработки. Будет заменен на аргумент CLI-команды.
          bundle:
            description: |
              Используйте параметр [bundle](../modules/002-deckhouse/configuration.html#parameters-bundle) ModuleConfig 'deckhouse' вместо этого параметра.

              Устанавливаемый в кластере вариант поставки Deckhouse.
          logLevel:
            description: |
              Используйте параметр [logLevel](../modules/002-deckhouse/configuration.html#parameters-loglevel) ModuleConfig 'deckhouse' вместо этого параметра.

              Уровень логирования Deckhouse.
