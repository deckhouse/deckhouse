{{- $context := . }}
{{- $controllers := .Values.ingressNginx.internal.ingressControllers | default (list) -}}
{{- $licenseMap := include "geoip_collect_license_editions" (dict "controllers" $controllers) | fromJson -}}

{{- if gt (len $licenseMap) 0 }}
apiVersion: v1
kind: Secret
metadata:
  name: geoip-license-editions
  namespace: d8-{{ .Chart.Name }}
type: Opaque
data:
  license_editions.json: {{ toJson $licenseMap | b64enc }}
{{- end }}
