{{- $context := . }}
{{- $controllers := .Values.ingressNginx.internal.ingressControllers | default (list) -}}
{{- $licenseMap := include "geoip_collect_license_editions" (dict "controllers" $controllers) | fromJson -}}

{{- if gt (len $licenseMap) 0 }}
---
apiVersion: v1
kind: Service
metadata:
  name: geoproxy
  namespace: d8-{{.Chart.Name }}
  {{- include "helm_lib_module_labels" (list . (dict "app" "geoproxy")) | nindent 2 }}
spec:
  ports:
    - name: https
      port: 4250
      targetPort: https
  selector:
    app: geoproxy
---
apiVersion: v1
kind: Service
metadata:
  name: geoproxy-headless
  namespace: d8-{{ .Chart.Name }}
  {{- include "helm_lib_module_labels" (list $ (dict "app" "geoproxy")) | nindent 2 }}
spec:
  clusterIP: None
  selector:
    app: geoproxy
  ports:
    - name: https
      port: 7475
      targetPort: https
{{- end }}
