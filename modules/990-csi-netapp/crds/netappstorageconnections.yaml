---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.3
  name: netappstorageconnections.storage.deckhouse.io
  labels:
    heritage: deckhouse
    module: csi-netapp
    backup.deckhouse.io/cluster-config: "true"
spec:
  group: storage.deckhouse.io
  names:
    kind: NetappStorageConnection
    listKind: NetappStorageConnectionList
    plural: netappstorageconnections
    shortNames:
      - nsconn
    singular: netappstorageconnection
  scope: Cluster
  versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: Required spec section
              properties:
                controlPlane:
                  description: 'Required: control plane connectivity (ONTAP API access)'
                  properties:
                    address:
                      description: 'Required: IP or DNS of the ONTAP management LIF'
                      type: string
                      x-kubernetes-validations:
                        - message: Value is immutable.
                          rule: self == oldSelf
                    password:
                      description: 'Required: Password for API access'
                      type: string
                    protocol:
                      default: ontapi
                      description: 'Optional: ONTAP API protocol'
                      enum:
                        - ontapi
                        - rest
                      type: string
                    svm:
                      description: 'Required: Name of the SVM'
                      type: string
                      x-kubernetes-validations:
                        - message: Value is immutable.
                          rule: self == oldSelf
                    username:
                      description: 'Required: Username for API access'
                      type: string
                  required:
                    - address
                    - password
                    - svm
                    - username
                  type: object
                dataPlane:
                  description: |-
                    Optional: data plane configuration for storage protocols
                    (iscsi, nfs, fcp)
                  properties:
                    iSCSI:
                      description: 'Optional: iSCSI configuration'
                      properties:
                        chap:
                          description: 'Optional: CHAP configuration'
                          properties:
                            chapInitiatorSecret:
                              description: 'Optional: CHAP initiator secret'
                              type: string
                            chapTargetInitiatorSecret:
                              description: 'Optional: CHAP target-to-initiator secret'
                              type: string
                            chapTargetUsername:
                              description: 'Optional: CHAP target username'
                              type: string
                            chapUsername:
                              description: 'Optional: CHAP username'
                              type: string
                            useChap:
                              default: false
                              description: 'Optional: Whether to use CHAP auth'
                              type: boolean
                          type: object
                          x-kubernetes-validations:
                            - message: When 'useChap' is true, all CHAP-related fields
                                must be provided.
                              rule: '!self.useChap || (has(self.chapInitiatorSecret) &&
                            has(self.chapTargetInitiatorSecret) && has(self.chapUsername)
                            && has(self.chapTargetUsername))'
                      type: object
                    nfs:
                      description: 'Optional: NFS configuration'
                      properties:
                        address:
                          description: 'Required: IP address of NFS server'
                          type: string
                        version:
                          description: 'Optional: NFS version string (e.g., "3", "4.1")'
                          type: string
                      required:
                        - address
                      type: object
                    protocol:
                      default: iscsi
                      description: 'Optional: storage protocol to use'
                      enum:
                        - iscsi
                        - fcp
                        - nfs
                      type: string
                  type: object
                  x-kubernetes-validations:
                    - message: '"dataPlane.nfs.address" is required when "dataPlane.protocol"
                    is "nfs".'
                      rule: self.protocol != 'nfs' || has(self.nfs.address)
              required:
                - controlPlane
              type: object
          required:
            - spec
          type: object
      served: true
      storage: true
