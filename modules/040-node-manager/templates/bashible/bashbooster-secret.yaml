{{ define "bashible_bashbooster_render" }}
  {{- $context := . -}}
  {{- $bb_files := list -}}
  {{- range $path, $_ := $context.Files.Glob "candi/bashible/bashbooster/*.sh" -}}
    {{- $bb_files = append $bb_files $path -}}
  {{- end -}}
{{ range $path := ( $bb_files | sortAlpha ) }}{{ $context.Files.Get $path }}{{ end }}

bb-set-proxy() {
  {{- if $.Values.global.clusterConfiguration.proxy }}
    {{- if $.Values.global.clusterConfiguration.proxy.httpProxy }}
    export HTTP_PROXY={{ $.Values.global.clusterConfiguration.proxy.httpProxy | quote }}
    export http_proxy=${HTTP_PROXY}
    {{- end }}
    {{- if $.Values.global.clusterConfiguration.proxy.httpsProxy }}
    export HTTPS_PROXY={{ $.Values.global.clusterConfiguration.proxy.httpsProxy | quote }}
    export https_proxy=${HTTPS_PROXY}
    {{- end }}
    {{- if $.Values.global.clusterConfiguration.proxy.noProxy }}
    export NO_PROXY={{ $.Values.global.clusterConfiguration.proxy.noProxy | join "," | quote }}
    export no_proxy=${NO_PROXY}
    {{- end }}
  {{- else }}
    unset HTTP_PROXY http_proxy HTTPS_PROXY https_proxy NO_PROXY no_proxy
  {{- end }}
}

bb-unset-proxy() {
  unset HTTP_PROXY http_proxy HTTPS_PROXY https_proxy NO_PROXY no_proxy
}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: bashible-bashbooster
  namespace: d8-cloud-instance-manager
  {{- include "helm_lib_module_labels" (list $) | nindent 2 }}
type: Opaque
data:
  bashbooster.sh: {{ include "bashible_bashbooster_render" . | b64enc }}
