kind: Suite
apiVersion: test.gatekeeper.sh/v1alpha1
metadata:
  name: d8-allowed-volume-types
tests:
- name: pss-restricted
  template: ../../templates/security/allowed-volume-types.yaml
  constraint: constraint_pss_restricted.yaml
  cases:
  - name: 009-allowed-no-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/009-allowed-no-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 001-allowed-configmap-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/001-allowed-configmap-volume.yaml
    assertions:
    - violations: 'no'
  - name: 012-allowed-secret-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/012-allowed-secret-volume.yaml
    assertions:
    - violations: 'no'
  - name: 006-allowed-emptyDir-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/006-allowed-emptyDir-volume.yaml
    assertions:
    - violations: 'no'
  - name: 010-allowed-persistentVolumeClaim-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/010-allowed-persistentVolumeClaim-volume.yaml
    assertions:
    - violations: 'no'
  - name: 005-allowed-downwardAPI-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/005-allowed-downwardAPI-volume.yaml
    assertions:
    - violations: 'no'
  - name: 011-allowed-projected-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/011-allowed-projected-volume.yaml
    assertions:
    - violations: 'no'
  - name: 002-allowed-csi-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/002-allowed-csi-volume.yaml
    assertions:
    - violations: 'no'
  - name: 007-allowed-ephemeral-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/007-allowed-ephemeral-volume.yaml
    assertions:
    - violations: 'no'
  - name: 008-allowed-multiple-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/008-allowed-multiple-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 015-disallowed-hostPath-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/015-disallowed-hostPath-volume.yaml
    assertions:
    - violations: 'yes'
  - name: 017-disallowed-nfs-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/017-disallowed-nfs-volume.yaml
    assertions:
    - violations: 'yes'
  - name: 016-disallowed-multiple-volumes-one-disallowed
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/016-disallowed-multiple-volumes-one-disallowed.yaml
    assertions:
    - violations: 'yes'
  - name: 004-allowed-deployment-no-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/004-allowed-deployment-no-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 014-disallowed-deployment-hostPath-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/014-disallowed-deployment-hostPath-volume.yaml
    assertions:
    - violations: 'no'
  - name: 003-allowed-daemonset-no-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/003-allowed-daemonset-no-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 013-disallowed-daemonset-hostPath-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/013-disallowed-daemonset-hostPath-volume.yaml
    assertions:
    - violations: 'no'
- name: security-policy
  template: ../../templates/security/allowed-volume-types.yaml
  constraint: constraint_security_policy.yaml
  cases:
  - name: 026-allowed-no-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/026-allowed-no-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 023-allowed-hostPath-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/023-allowed-hostPath-volume.yaml
    assertions:
    - violations: 'no'
  - name: 025-allowed-nfs-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/025-allowed-nfs-volume.yaml
    assertions:
    - violations: 'no'
  - name: 018-allowed-configmap-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/018-allowed-configmap-volume.yaml
    assertions:
    - violations: 'no'
  - name: 024-allowed-multiple-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/024-allowed-multiple-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 022-allowed-deployment-no-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/022-allowed-deployment-no-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 021-allowed-deployment-hostPath-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/021-allowed-deployment-hostPath-volume.yaml
    assertions:
    - violations: 'no'
  - name: 020-allowed-daemonset-no-volumes
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/020-allowed-daemonset-no-volumes.yaml
    assertions:
    - violations: 'no'
  - name: 019-allowed-daemonset-hostPath-volume
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/019-allowed-daemonset-hostPath-volume.yaml
    assertions:
    - violations: 'no'
- name: pss-restricted-with-exception
  template: ../../templates/security/allowed-volume-types.yaml
  constraint: constraint_pss_restricted.yaml
  cases:
  - name: 028-031-allowed-by-exception-hostPath-volume
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/028-allow-hostPath-volume.yaml
    object: test_samples/security_policy_exceptions/pods/031-allowed-by-exception-hostPath-volume.yaml
    assertions:
    - violations: 'no'
  - name: 029-033-allowed-by-exception-multiple-volume-types
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/029-allow-multiple-volume-types.yaml
    object: test_samples/security_policy_exceptions/pods/033-allowed-by-exception-multiple-volume-types.yaml
    assertions:
    - violations: 'no'
  - name: 028-035-disallowed-by-exception-volume-type-mismatch
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/028-allow-hostPath-volume.yaml
    object: test_samples/security_policy_exceptions/pods/035-disallowed-by-exception-volume-type-mismatch.yaml
    assertions:
    - violations: 'yes'
  - name: 036-disallowed-no-exception-label
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/security_policy_exceptions/pods/036-disallowed-no-exception-label.yaml
    assertions:
    - violations: 'yes'
  - name: 028-032-allowed-by-exception-mismatch-but-constraint-allows
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/028-allow-hostPath-volume.yaml
    object: test_samples/security_policy_exceptions/pods/032-allowed-by-exception-mismatch-but-constraint-allows.yaml
    assertions:
    - violations: 'no'
  - name: 028-034-disallowed-by-exception-multiple-volumes-one-mismatch
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/028-allow-hostPath-volume.yaml
    object: test_samples/security_policy_exceptions/pods/034-disallowed-by-exception-multiple-volumes-one-mismatch.yaml
    assertions:
    - violations: 'yes'
  - name: 030-037-disallowed-by-exception-empty-spec
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/030-empty-spec.yaml
    object: test_samples/security_policy_exceptions/pods/037-disallowed-by-exception-empty-spec.yaml
    assertions:
    - violations: 'yes'
