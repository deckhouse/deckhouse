kind: Suite
apiVersion: test.gatekeeper.sh/v1alpha1
metadata:
  name: d8-allowed-users
tests:
- name: pss-restricted
  template: ../../templates/security/allowed-users.yaml
  constraint: constraint_pss_restricted.yaml
  cases:
  - name: 11-disallowed-no-securityContext
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/011-disallowed-no-securityContext.yaml
    assertions:
    - violations: yes
  - name: 4-allowed-runAsNonRoot-true-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/004-allowed-runAsNonRoot-true-container.yaml
    assertions:
    - violations: no
  - name: 5-allowed-runAsNonRoot-true-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/005-allowed-runAsNonRoot-true-pod.yaml
    assertions:
    - violations: no
  - name: 6-allowed-runAsUser-non-zero-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/006-allowed-runAsUser-non-zero-container.yaml
    assertions:
    - violations: no
  - name: 7-allowed-runAsUser-non-zero-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/007-allowed-runAsUser-non-zero-pod.yaml
    assertions:
    - violations: no
  - name: 13-disallowed-runAsUser-zero-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/013-disallowed-runAsUser-zero-container.yaml
    assertions:
    - violations: yes
  - name: 14-disallowed-runAsUser-zero-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/014-disallowed-runAsUser-zero-pod.yaml
    assertions:
    - violations: yes
  - name: 12-disallowed-runAsNonRoot-false-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/012-disallowed-runAsNonRoot-false-container.yaml
    assertions:
    - violations: yes
  - name: 10-disallowed-multiple-containers-one-root
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/010-disallowed-multiple-containers-one-root.yaml
    assertions:
    - violations: yes
  - name: 2-allowed-deployment-runAsNonRoot-true-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/002-allowed-deployment-runAsNonRoot-true-container.yaml
    assertions:
    - violations: no
  - name: 9-disallowed-deployment-runAsUser-zero-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/009-disallowed-deployment-runAsUser-zero-container.yaml
    assertions:
    - violations: no
  - name: 1-allowed-daemonset-runAsNonRoot-true-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/001-allowed-daemonset-runAsNonRoot-true-container.yaml
    assertions:
    - violations: no
  - name: 8-disallowed-daemonset-runAsUser-zero-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_restricted/008-disallowed-daemonset-runAsUser-zero-container.yaml
    assertions:
    - violations: no
- name: security-policy
  template: ../../templates/security/allowed-users.yaml
  constraint: constraint_security_policy.yaml
  cases:
  - name: 31-disallowed-no-securityContext
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/031-disallowed-no-securityContext.yaml
    assertions:
    - violations: yes
  - name: 22-allowed-runAsUser-in-range-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/022-allowed-runAsUser-in-range-container.yaml
    assertions:
    - violations: no
  - name: 23-allowed-runAsUser-in-range-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/023-allowed-runAsUser-in-range-pod.yaml
    assertions:
    - violations: no
  - name: 25-allowed-runAsUser-on-edge-min-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/025-allowed-runAsUser-on-edge-min-container.yaml
    assertions:
    - violations: no
  - name: 24-allowed-runAsUser-on-edge-max-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/024-allowed-runAsUser-on-edge-max-container.yaml
    assertions:
    - violations: no
  - name: 21-allowed-runAsGroup-in-range-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/021-allowed-runAsGroup-in-range-container.yaml
    assertions:
    - violations: no
  - name: 19-allowed-fsGroup-in-range-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/019-allowed-fsGroup-in-range-pod.yaml
    assertions:
    - violations: no
  - name: 26-allowed-supplementalGroups-in-range-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/026-allowed-supplementalGroups-in-range-pod.yaml
    assertions:
    - violations: no
  - name: 16-allowed-all-fields-in-range
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/016-allowed-all-fields-in-range.yaml
    assertions:
    - violations: no
  - name: 15-allowed-all-fields-in-range-with-pod-level
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/015-allowed-all-fields-in-range-with-pod-level.yaml
    assertions:
    - violations: no
  - name: 34-disallowed-runAsUser-out-of-range-low-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/034-disallowed-runAsUser-out-of-range-low-container.yaml
    assertions:
    - violations: yes
  - name: 33-disallowed-runAsUser-out-of-range-high-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/033-disallowed-runAsUser-out-of-range-high-container.yaml
    assertions:
    - violations: yes
  - name: 32-disallowed-runAsGroup-out-of-range-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/032-disallowed-runAsGroup-out-of-range-container.yaml
    assertions:
    - violations: yes
  - name: 29-disallowed-fsGroup-out-of-range-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/029-disallowed-fsGroup-out-of-range-pod.yaml
    assertions:
    - violations: yes
  - name: 35-disallowed-supplementalGroups-out-of-range-pod
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/035-disallowed-supplementalGroups-out-of-range-pod.yaml
    assertions:
    - violations: yes
  - name: 30-disallowed-multiple-containers-one-out-of-range
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/030-disallowed-multiple-containers-one-out-of-range.yaml
    assertions:
    - violations: yes
  - name: 18-allowed-deployment-runAsUser-in-range-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/018-allowed-deployment-runAsUser-in-range-container.yaml
    assertions:
    - violations: no
  - name: 28-disallowed-deployment-runAsUser-out-of-range-low-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/028-disallowed-deployment-runAsUser-out-of-range-low-container.yaml
    assertions:
    - violations: no
  - name: 17-allowed-daemonset-runAsUser-in-range-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/017-allowed-daemonset-runAsUser-in-range-container.yaml
    assertions:
    - violations: no
  - name: 27-disallowed-daemonset-runAsUser-out-of-range-low-container
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/security_policy/027-disallowed-daemonset-runAsUser-out-of-range-low-container.yaml
    assertions:
    - violations: no
- name: pss-restricted-with-exception
  template: ../../templates/security/allowed-users.yaml
  constraint: constraint_pss_restricted.yaml
  cases:
  - name: 46-50-allowed-by-exception-root-user
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/046-allow-root-user.yaml
    object: test_samples/security_policy_exceptions/pods/050-allowed-by-exception-root-user.yaml
    assertions:
    - violations: no
  - name: 45-47-allowed-by-exception-custom-user-range
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/045-allow-custom-user-range.yaml
    object: test_samples/security_policy_exceptions/pods/047-allowed-by-exception-custom-user-range.yaml
    assertions:
    - violations: no
  - name: 46-51-allowed-by-exception-user-mismatch-but-constraint-allows
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/046-allow-root-user.yaml
    object: test_samples/security_policy_exceptions/pods/051-allowed-by-exception-user-mismatch-but-constraint-allows.yaml
    assertions:
    - violations: no
  - name: 46-53-disallowed-by-exception-runAsNonRoot-mismatch
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/046-allow-root-user.yaml
    object: test_samples/security_policy_exceptions/pods/053-disallowed-by-exception-runAsNonRoot-mismatch.yaml
    assertions:
    - violations: yes
  - name: 55-disallowed-no-exception-label
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/security_policy_exceptions/pods/055-disallowed-no-exception-label.yaml
    assertions:
    - violations: yes
  - name: 46-48-allowed-by-exception-mismatch-but-constraint-allows
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/046-allow-root-user.yaml
    object: test_samples/security_policy_exceptions/pods/048-allowed-by-exception-mismatch-but-constraint-allows.yaml
    assertions:
    - violations: no
  - name: 46-49-allowed-by-exception-multiple-containers-all-allowed
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/046-allow-root-user.yaml
    object: test_samples/security_policy_exceptions/pods/049-allowed-by-exception-multiple-containers-all-allowed.yaml
    assertions:
    - violations: no
