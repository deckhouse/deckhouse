kind: Suite
apiVersion: test.gatekeeper.sh/v1alpha1
metadata:
  name: d8-apparmor-profiles
tests:
- name: pss-baseline
  template: ../../templates/security/allowed-apparmor-profiles.yaml
  constraint: constraint_pss_baseline.yaml
  cases:
  - name: 4-allowed-no-apparmor-profile
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/004-allowed-no-apparmor-profile.yaml
    assertions:
    - violations: no
  - name: 7-allowed-runtime-default-securityContext
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/007-allowed-runtime-default-securityContext.yaml
    assertions:
    - violations: no
  - name: 2-allowed-localhost-profile-securityContext
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/002-allowed-localhost-profile-securityContext.yaml
    assertions:
    - violations: no
  - name: 6-allowed-runtime-default-annotation
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/006-allowed-runtime-default-annotation.yaml
    assertions:
    - violations: no
  - name: 1-allowed-localhost-profile-annotation
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/001-allowed-localhost-profile-annotation.yaml
    assertions:
    - violations: no
  - name: 5-allowed-pod-securityContext-runtime-default
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/005-allowed-pod-securityContext-runtime-default.yaml
    assertions:
    - violations: no
  - name: 3-allowed-multiple-containers-all-allowed
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/003-allowed-multiple-containers-all-allowed.yaml
    assertions:
    - violations: no
  - name: 11-disallowed-unconfined-securityContext
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/011-disallowed-unconfined-securityContext.yaml
    assertions:
    - violations: yes
  - name: 10-disallowed-unconfined-annotation
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/010-disallowed-unconfined-annotation.yaml
    assertions:
    - violations: yes
  - name: 9-disallowed-multiple-containers-one-unconfined
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/009-disallowed-multiple-containers-one-unconfined.yaml
    assertions:
    - violations: yes
  - name: 8-disallowed-initContainer-unconfined
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/constraint_templates/pss_baseline/008-disallowed-initContainer-unconfined.yaml
    assertions:
    - violations: yes
- name: pss-baseline-with-exception
  template: ../../templates/security/allowed-apparmor-profiles.yaml
  constraint: constraint_pss_baseline.yaml
  cases:
  - name: 28-33-allowed-by-exception-unconfined
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/028-allow-unconfined.yaml
    object: test_samples/security_policy_exceptions/pods/033-allowed-by-exception-unconfined.yaml
    assertions:
    - violations: no
  - name: 27-32-allowed-by-exception-runtime-default
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/027-allow-runtime-default.yaml
    object: test_samples/security_policy_exceptions/pods/032-allowed-by-exception-runtime-default.yaml
    assertions:
    - violations: no
  - name: 25-29-allowed-by-exception-localhost-profile
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/025-allow-localhost-profile.yaml
    object: test_samples/security_policy_exceptions/pods/029-allowed-by-exception-localhost-profile.yaml
    assertions:
    - violations: no
  - name: 26-31-allowed-by-exception-multiple-containers-all-allowed
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/026-allow-multiple-profiles.yaml
    object: test_samples/security_policy_exceptions/pods/031-allowed-by-exception-multiple-containers-all-allowed.yaml
    assertions:
    - violations: no
  - name: 27-36-disallowed-by-exception-profile-mismatch
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/027-allow-runtime-default.yaml
    object: test_samples/security_policy_exceptions/pods/036-disallowed-by-exception-profile-mismatch.yaml
    assertions:
    - violations: yes
- name: pss-baseline-restrictive-with-exception
  template: ../../templates/security/allowed-apparmor-profiles.yaml
  constraint: constraint_pss_deny_all.yaml
  cases:
  - name: 25-34-disallowed-by-exception-localhost-profile-mismatch
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/025-allow-localhost-profile.yaml
    object: test_samples/security_policy_exceptions/pods/034-disallowed-by-exception-localhost-profile-mismatch.yaml
    assertions:
    - violations: yes
  - name: 25-29-allowed-by-exception-localhost-profile-restrictive
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/025-allow-localhost-profile.yaml
    object: test_samples/security_policy_exceptions/pods/029-allowed-by-exception-localhost-profile.yaml
    assertions:
    - violations: no
  - name: 28-33-allowed-by-exception-unconfined-restrictive
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/028-allow-unconfined.yaml
    object: test_samples/security_policy_exceptions/pods/033-allowed-by-exception-unconfined.yaml
    assertions:
    - violations: no
  - name: 27-36-disallowed-by-exception-profile-mismatch-restrictive
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/027-allow-runtime-default.yaml
    object: test_samples/security_policy_exceptions/pods/036-disallowed-by-exception-profile-mismatch.yaml
    assertions:
    - violations: yes
  - name: 27-35-disallowed-by-exception-multiple-containers-one-mismatch
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/027-allow-runtime-default.yaml
    object: test_samples/security_policy_exceptions/pods/035-disallowed-by-exception-multiple-containers-one-mismatch.yaml
    assertions:
    - violations: yes
  - name: 37-disallowed-no-exception-label
    inventory:
    - ../common/test_samples/ns.yaml
    object: test_samples/security_policy_exceptions/pods/037-disallowed-no-exception-label.yaml
    assertions:
    - violations: yes
  - name: 28-30-allowed-by-exception-mismatch-but-constraint-allows
    inventory:
    - ../common/test_samples/ns.yaml
    - test_samples/security_policy_exceptions/exceptions/028-allow-unconfined.yaml
    object: test_samples/security_policy_exceptions/pods/030-allowed-by-exception-mismatch-but-constraint-allows.yaml
    assertions:
    - violations: no
