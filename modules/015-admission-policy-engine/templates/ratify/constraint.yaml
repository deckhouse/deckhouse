{{- if and (.Values.admissionPolicyEngine.internal.bootstrapped) }}
---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: D8VerifyImageSignature
metadata:
  name: verify-image-signature
  {{- include "helm_lib_module_labels" (list . (dict "app" "ratify" "app.kubernetes.io/part-of" "gatekeeper")) | nindent 2 }}
spec:
  enforcementAction: deny
  match:
    scope: Namespaced
    namespaceSelector:
      matchLabels:
        security.deckhouse.io/trivy-provider: ""
  enforcementAction: deny
  match:
    kinds:
    - apiGroups:
      - ""
      kinds:
      - Pod
    namespaces:
    - default
{{- end }}
