image: {{ .ModuleName }}/{{ .ImageName }}
fromImage: common/shell-operator
import:
- artifact: {{ .ModuleName }}/{{ .ImageName }}-binaries-artifact
  add: /usr/bin
  to: /usr/bin
  before: setup
  includePaths:
  - python3
  - python3.12
- artifact: {{ .ModuleName }}/{{ .ImageName }}-binaries-artifact
  add: /usr/lib/python3
  to: /usr/lib/python3
  before: setup
- artifact: {{ .ModuleName }}/{{ .ImageName }}-binaries-artifact
  add: /usr/lib64/python3
  to: /usr/lib64/python3
  before: setup
- artifact: {{ .ModuleName }}/{{ .ImageName }}-binaries-artifact
  add: /usr/lib64/python3.12
  to: /usr/lib64/python3.12
  before: setup
- artifact: {{ .ModuleName }}/{{ .ImageName }}-src-artifact
  add: /src/hooks
  to: /hooks
  before: install
---
artifact: {{ .ModuleName }}/{{ .ImageName }}-src-artifact
fromArtifact: src-artifact
git:
- add: /{{ .ModulePath }}modules/{{ .ModulePriority }}-{{ .ModuleName }}/images/{{ .ImageName }}/hooks
  to: /src/hooks
  stageDependencies:
    install:
    - '**/*'
- add: /{{ .ModulePath }}modules/{{ .ModulePriority }}-{{ .ModuleName }}/images/{{ .ImageName }}/requirements.txt
  to: /src/requirements.txt
  stageDependencies:
    install:
    - '**/*'
shell:
  install:
  - cd /src
---
artifact: {{ .ModuleName }}/{{ .ImageName }}-binaries-artifact
from: {{ .Images.BASE_ALT_P11 }}
import:
- artifact: {{ .ModuleName }}/{{ .ImageName }}-src-artifact
  add: /src/requirements.txt
  to: /requirements.txt
  before: install
shell:
  beforeInstall:
  {{- include "alt packages proxy" . | nindent 2 }}
  - apt-get install -y python3 python3-module-pip-run
  install:
  - pip3 install -r /requirements.txt
