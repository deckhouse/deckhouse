---
title: "Модуль registry"
description: ""
---

## Описание

Модуль registry - компонент, реализующий внутренний реестр container образов Deckhouse.

Внутренний реестр container образов позволяет оптимизировать загрузку и хранение образов, а также обеспечивает высокую доступность и отказоустойчивость Deckhouse.

Модуль реализует несколько режимов работы `Direct`, `Proxy`, `Local` и `Unmanaged` (на данный момент поддерживается режимы `Direct` и `Unmanaged`).

`Direct`, `Proxy` и `Local` (`Managed` режимы) - реализуют работу внутреннего реестра container образов. Данные режимы позволяют адаптировать реестр под различные сценарии использования. Обращение к внутреннему реестру в заданных режимах выполняется по фиксированному адресу `registry.d8-system.svc:5001/system/deckhouse`. Фиксированный адрес позволяет избежать повторное скачивание образов и перезапуск компонентов, при изменение параметров реестра и смене режима.

`Unmanaged` - реализует работу без использования внутреннего реестра. Обращение внутри кластера выполняется по адресу заданному при bootstrap кластера, или через `helper change-registry`.

{% alert level="info" %}
Для работы в режимах `Direct`, `Proxy` и `Local` необходимо использовать CRI `Containerd` или `Containerd V2` на всех узлах кластера.
Для настройки CRI ознакомьтесь с конфигурацией [ClusterConfiguration](/products/kubernetes-platform/documentation/v1/installing/configuration.html#clusterconfiguration)
{% endalert %}

### Direct режим

В режиме Direct, запросы к реестру обрабатываются напрямую, без промежуточного кэширования.

Перенаправление запросов к registry от CRI осуществляется при помощи его настроек, которые прописываются в конфигурации `containerd`.

В случае компонентов, обращающихся к реестру напрямую, таких как `operator-trivy`, `image-availability-exporter`, `deckhouse-controller` и ряда других, обращения будут идти через In-Cluster Proxy, расположенный на узлах control plane.

<!--- Source: mermaid code from docs/internal/DIRECT.md --->
![direct](../../images/registry-module/direct.png)

<!-- ### Proxy режим
Данный режим позволяет registry выступать в качестве промежуточного прокси-сервера между клиентом и удалённым реестром, оптимизируя доступ к часто используемым образам и уменьшая нагрузку на сеть.
Запуск кеширующего Proxy реестра осуществляется виде статических подов на узлах control plane. Для обеспечения высокой доступности к кеширующему Proxy, используется балансировщик установленный на каждый узел кластера.
Обращение к Proxy registry от CRI осуществляется через балансировщик. Настройки для обращения к балансировщику прописываются в конфигурации `containerd`.
В случае компонентов, обращающихся к реестру напрямую, таких как `operator-trivy`, `image-availability-exporter`, `deckhouse-controller` и ряда других, обращения будут идти также через кеширующий Proxy реестр. -->

<!-- ### Local режим
Данный режим позволяет создавать локальную копию registry внутри кластера. Образы из удалённого реестра полностью скопированы в локальное хранилище.
Работа локального registry идентична работы кеширующего proxy. Запуск локального registry осуществляется в виде статических подов на узлах control plane. Для обеспечения высокой доступности к локальному registry, используется балансировщик установленный на каждый узел кластера.
Обращение к локальному registry от CRI осуществляется через балансировщик. Настройки для обращения к балансировщику прописываются в конфигурации `containerd`.
В случае компонентов, обращающихся к реестру напрямую, таких как `operator-trivy`, `image-availability-exporter`, `deckhouse-controller` и ряда других, обращения будут идти также в локальный реестр.
Для наполнения локального registry образами используется инструмент d8.
-->
