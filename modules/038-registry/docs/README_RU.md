---
title: "Модуль registry"
description: ""
---

## Описание

Модуль обеспечивает работу с внутренним хранилищем образов контейнеров (container registry, registry) и управление параметрами registry.

Внутренний registry позволяет оптимизировать загрузку и хранение образов, а также помогает обеспечивать высокую доступность и отказоустойчивость Deckhouse Kubernetes Platform.

Модуль работает в следующих режимах:

- `Direct` — работа с использованием внутреннего registry. Обращение к внутреннему registry выполняется по фиксированному адресу `registry.d8-system.svc:5001/system/deckhouse`. Фиксированный адрес, при изменении параметров registry, позволяет избежать повторного скачивания образов и перезапуска компонентов. Переключение между режимами и registry выполняется через ModuleConfig `deckhouse`. Переключение выполняется автоматически (ознакомьтесь с [примерами использования](examples.html)).
- `Unmanaged` — работа без использования внутреннего registry. Обращение внутри кластера выполняется по адресу, который можно [задать при установке кластера](../../installing/configuration.html#initconfiguration-deckhouse-imagesrepo), или [изменить в развернутом кластере](../../deckhouse-faq.html#как-переключить-работающий-кластер-deckhouse-на-использование-стороннего-registry).

## Ограничения и особенности использования модуля

Модуль `registry` имеет ряд ограничений и особенностей, касающихся установки, условий работы и переключения режимов.

### Ограничения при установке кластера

Bootstrap кластера DKP с включенным режимом `Direct` не поддерживается. Кластер разворачивается с настройками для режима `Unmanaged`.

### Ограничения по условиям работы

Модуль работает при соблюдении следующих условий:

- Если на узлах кластера используется CRI containerd или containerd v2. Для настройки CRI ознакомьтесь с конфигурацией [`ClusterConfiguration`](../../installing/configuration.html##clusterconfiguration-defaultcri).
- Кластер полностью управляются DKP. В Managed Kubernetes кластерах он работать не будет.

### Ограничения по переключению режимов

Ограничения по переключению режимов следующие:

- Переключение на режим `Direct` возможно, если на узлах отсутствуют пользовательские конфигурации реестра. Подробнее — в разделе [«Модуль registry: FAQ»](./faq.html).
- Переключение в режим `Unmanaged` доступно только из режима `Direct`.
- В режиме `Unmanaged` изменение параметров registry не поддерживается. Для изменения параметров нужно переключиться на режим `Direct`, внести необходимые изменения и снова включить режим `Unmanaged`.

## Архитектура режима Direct

В режиме `Direct` запросы к registry обрабатываются напрямую, без промежуточного кэширования.

Перенаправление запросов к registry от CRI осуществляется при помощи его настроек, которые указываются в конфигурации `containerd`.

В случае таких компонентов, как `operator-trivy`, `image-availability-exporter`, `deckhouse-controller` и ряда других, обращающихся к registry напрямую, запросы будут идти через in-cluster proxy, расположенный на master-узлах.

<!--- Source: mermaid code from docs/internal/DIRECT.md --->
![direct](../../images/registry-module/direct-ru.png)

<!-- ### Proxy режим
Данный режим позволяет registry выступать в качестве промежуточного прокси-сервера между клиентом и удалённым реестром, оптимизируя доступ к часто используемым образам и уменьшая нагрузку на сеть.
Запуск кеширующего Proxy реестра осуществляется виде статических подов на узлах control plane. Для обеспечения высокой доступности к кеширующему Proxy, используется балансировщик установленный на каждый узел кластера.
Обращение к Proxy registry от CRI осуществляется через балансировщик. Настройки для обращения к балансировщику прописываются в конфигурации `containerd`.
В случае компонентов, обращающихся к реестру напрямую, таких как `operator-trivy`, `image-availability-exporter`, `deckhouse-controller` и ряда других, обращения будут идти также через кеширующий Proxy реестр. -->

<!-- ### Local режим
Данный режим позволяет создавать локальную копию registry внутри кластера. Образы из удалённого реестра полностью скопированы в локальное хранилище.
Работа локального registry идентична работы кеширующего proxy. Запуск локального registry осуществляется в виде статических подов на узлах control plane. Для обеспечения высокой доступности к локальному registry, используется балансировщик установленный на каждый узел кластера.
Обращение к локальному registry от CRI осуществляется через балансировщик. Настройки для обращения к балансировщику прописываются в конфигурации `containerd`.
В случае компонентов, обращающихся к реестру напрямую, таких как `operator-trivy`, `image-availability-exporter`, `deckhouse-controller` и ряда других, обращения будут идти также в локальный реестр.
Для наполнения локального registry образами используется инструмент d8.
-->
