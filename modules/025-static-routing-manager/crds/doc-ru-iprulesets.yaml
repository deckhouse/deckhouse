spec:
  versions:
    - name: v1alpha1
      schema: &schema
        openAPIV3Schema:
          description: |
            Данный ресурс описывает набор правил (`ip rule`), которые будут созданы на нодах с соответствующими лейблами.
          properties:
            spec:
              properties:
                rules:
                  description: |
                    Желаемый набор правил (`ip rule`).
                  items:
                    properties:
                      priority:
                        description: |
                          Приоритет правила (от него зависит очередность применения).
                          При выборе стоит учитывать несколько нюансов:
                          - Все правила перебираются в порядке приоритета (от меньшего к большему) пока не будет найдено совпадение.
                          - В случае если пакет подпал под какое то правило, и соответствующее действие было успешно выполнено, то перебор правил прекращается.
                          - Правило для поиска в таблице маршрутизации `main` по-умолчанию имеет значение 32766. При указании большего значения - правило ни когда не будет обработано.
                      selectors:
                        description: |
                          Набор признаков пакета.
                          Если пакет имеет признаки описанные в секции `selectors`, то к нему будут применены действия из секции `actions`.
                        properties:
                          not:
                            description: |
                              Если указан данный флаг, то правило будет инвертировано, то есть под него будут попадать все пакеты не имеющие указанных признаков.
                          from:
                            description: |
                              Массив подсетей источника.
                            items:
                              description: |
                                Подсеть источника.
                          to:
                            description: |
                              Массив подсетей назначения.
                            items:
                              description: |
                                Подсеть назначения.
                          tos:
                            description: |
                              QOS метка трафика (TOS/diffserv/dscp) передаваемая по сети в IP-заголовках пакета.
                          fwMark:
                            description: |
                              Метка трафика существующая только внутри сетевой подсистемы linux на ноде.
                          iif:
                            description: |
                              Имя интерфейса, через который пакет "вошел" на ноду.
                          oif:
                            description: |
                              Имя интерфейса, через который пакет должен был бы "выйти" с ноды.
                          ipProto:
                            description: |
                              Номер L4 протокола, который инкапсулирован в IP в данном пакете.
                              Номера наиболее популярных протоколов:
                              - `ICMP` - 1
                              - `TCP` - 6
                              - `UDP` - 17
                              Все доступные значения можно найти [по ссылке](https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml), или в файле /etc/protocols на ноде.
                          sportRange:
                            description: |
                              Диапазон портов источника.
                              Если порт только один, то можно заполнить либо только поле `start`, либо в полях `start` и `end` указать одно и то же значение.
                            properties:
                              start:
                                description: |
                                  Начало диапазона.
                              end:
                                description: |
                                  Конец диапазона.
                          dportRange:
                            description: |
                              Диапазон портов назначения.
                              Если порт только один, то можно заполнить либо только поле `start`, либо в полях `start` и `end` указать одно и то же значение.
                            properties:
                              start:
                                description: |
                                  Начало диапазона.
                              end:
                                description: |
                                  Конец диапазона.
                          uidRange:
                            description: |
                              Диапазон UID(UserID) пользователей, под которыми запускались приложения передающие трафик.
                              Если UID только один, то можно заполнить либо только поле `start`, либо в полях `start` и `end` указать одно и то же значение.
                            properties:
                              start:
                                description: |
                                  Начало диапазона.
                              end:
                                description: |
                                  Конец диапазона.
                      actions:
                        description: |
                          Набор действий, которые необходимо совершить с пакетом, имеющим признаки описанные в секции `selectors`.
                        properties:
                          lookup:
                            description: |
                              Определить таблицу маршрутизации, в какой необходимо искать адрес шлюза.
                            properties:
                              ipRoutingTableID:
                                description: |
                                  ID таблицы маршрутизации на ноде.
                              routingTableName:
                                description: |
                                  Имя kubernetes-ресурса RoutingTable, в котором необходимо искать ID таблицы маршрутизации.
                nodeSelector:
                  description: |
                    Набор лейблов, которые определяют ноды, на которых необходимо применить данные правила.
