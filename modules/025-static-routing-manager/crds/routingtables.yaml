apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: routingtables.network.deckhouse.io
  labels:
    heritage: deckhouse
    module: static-routing-manager
spec:
  group: network.deckhouse.io
  scope: Cluster
  names:
    plural: routingtables
    singular: routingtable
    kind: RoutingTable
  preserveUnknownFields: false
  versions:
  - name: v1alpha1
    served: true
    storage: true
    subresources:
      status: {}
    additionalPrinterColumns:
    - jsonPath: .status.ipRouteTableID
      name: ipRouteTableID
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    schema: &schema
      openAPIV3Schema:
        type: object
        description: |
          A resource describing the desired routing table and the routes it contains.
        required:
        - spec
        properties:
          spec:
            type: object
            required:
            - routes
            - nodeSelector
            x-kubernetes-validations:
            - message: ipRouteTableID is required once set
              rule: '!has(oldSelf.ipRouteTableID) || has(self.ipRouteTableID)'
            properties:
              ipRouteTableID:
                type: integer
                x-kubernetes-validations:
                - message: ipRouteTableID is immutable field
                  rule: self == oldSelf
                minimum: 1
                maximum: 4294967295
                description: |
                  ID of the desired routing table.
                  If the value is not explicitly specified, it will be generated automatically.
                  This field cannot be changed after the resource is created.
                  If necessary, you need to recreate the resource.
              routes:
                type: array
                items:
                  type: object
                  description: |
                    Desired routes.
                  required:
                  - destination
                  - gateway
                  properties:
                    destination:
                      type: string
                      format: cidr
                      description: |
                        Description network.
                    gateway:
                      type: string
                      format: ipv4
                      description: |
                        Nexthop.
              nodeSelector:
                type: object
                description: |
                  A set of labels that determine the nodes on which the desired routes should be created.
                additionalProperties:
                  type: string
          status:
            type: object
            properties:
              ipRouteTableID:
                type: integer
                minimum: 1
                maximum: 4294967295

