---
artifact: {{ $.ModuleName }}/{{ $.ImageName }}-builder
from: {{ $.Images.BASE_GOLANG_21_BULLSEYE_DEV }}
mount:
  - fromPath: ~/go-pkg-cache
    to: /go/pkg
git:
  - url: {{ $.OBSERVABILITY_SOURCE_REPO }}/observability.git
    to: /src
    commit: 0cfa94570c39756166230c7d2a4e0ce1e37309ba
    stageDependencies:
      install:
        - go.mod
        - go.sum
      beforeSetup:
        - '**/*.go'
shell:
  install:
    - cd /src/images/label-proxy
    - go mod download
  beforeSetup:
    - cd /src/images/label-proxy
    - CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o label-proxy ./cmd/label-proxy
---
image: {{ $.ModuleName }}/{{ $.ImageName }}
fromImage: common/distroless
import:
  - artifact: {{ $.ModuleName }}/{{ $.ImageName }}-builder
    add: /src/images/label-proxy/label-proxy
    to: /usr/bin/label-proxy
    before: install
docker:
  ENTRYPOINT:
    - /usr/bin/label-proxy
