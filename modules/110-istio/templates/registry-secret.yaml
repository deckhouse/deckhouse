---
apiVersion: v1
kind: Secret
metadata:
  name: deckhouse-registry
  namespace: d8-{{ .Chart.Name }}
  {{- include "helm_lib_module_labels" (list .) | nindent 2 }}
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ .Values.global.modulesImages.registry.dockercfg }}

{{- $namespaces := .Values.istio.internal.applicationNamespaces }}
{{- $istioNamespace := printf "d8-%s" .Chart.Name }}
{{- $namespaceMap := dict }}
{{- range $ns := $namespaces }}
  {{- $_ := set $namespaceMap $ns true }}
{{- end }}
{{- $_ := set $namespaceMap $istioNamespace true }}
{{- $uniqueNamespaces := keys $namespaceMap }}
{{- range $namespace := $uniqueNamespaces }}
---
apiVersion: v1
kind: Secret
metadata:
  name: d8-istio-sidecar-registry
  namespace: {{ $namespace }}
  {{- include "helm_lib_module_labels" (list $) | nindent 2 }}
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ $.Values.global.modulesImages.registry.dockercfg }}
{{- end }}

