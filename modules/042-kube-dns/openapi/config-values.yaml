type: object
properties:
  upstreamNameservers:
    type: array
    description: |
      A list of IP addresses of recursive DNS servers that CoreDNS will use to resolve external domains.

      By default, the `/etc/resolv.conf` list is used.
    items:
      type: string
      pattern: '^[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}(:[0-9]{1,})?$'
  l4ProtocolMode:
    type: string
    description: |
      The mode defines the L4 protocol for communicating with the upstream DNS server:
      - `PreferUDP` - Uses UDP, even if the original request came over TCP. However, if the dns-response was truncated, because it exceeded 512 bytes(**and only in this case**), the request will be retried over TCP.
      - `ForceTCP` - Always uses TCP, even if the original request comes in over UDP.
      - `Standard` - Uses the same protocol (TCP or UDP) as the original request.

      {% alert %}
        Based on RFC 1035, DNS messages carried by UDP are restricted to 512 bytes (not counting the IP or UDP headers). Longer messages are truncated and the TC bit is set in the header.
        And based on RFC 5966, when the dns-client receives truncated response, it takes the TC flag as an indication that it should retry over TCP instead.
      {% endalert %}
    enum: [PreferUDP, ForceTCP, Standard]
    default: PreferUDP
  hosts:
    description: |
      A static list of hosts similar to that of `/etc/hosts`.
    x-doc-required: false
    type: array
    items:
      type: object
      properties:
        domain:
          type: string
          pattern: '^[0-9a-zA-Z\.-]+$'
        ip:
          type: string
          pattern: '^[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}$'
  stubZones:
    x-examples:
    -
      - zone: example.com
        upstreamNameservers: ['8.8.8.8']
        cacheTTLSeconds: 3600
    description: |
      A list of additional zones CoreDNS should be authoritative for.
    type: array
    default: []
    items:
      type: object
      required: ['zone', 'upstreamNameservers']
      properties:
        zone:
          description: |
            The CoreDNS zone.
          type: string
          pattern: '^[0-9a-zA-Z\.-]+$'
          x-doc-example: consul.local
        upstreamNameservers:
          mixLength: 1
          description: |
            A list of IP addresses of recursive DNS servers that CoreDNS will use to resolve domains in this zone.
          type: array
          items:
            type: string
            pattern: '^[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}(:[0-9]{1,})?$'
        cacheTTLSeconds:
          type: integer
          default: 30
          minimum: 1
          maximum: 3600
          description: |
            Max TTL in seconds for NOERROR responses.
        l4ProtocolMode:
          type: string
          description: |
            The mode defines the L4 protocol for communicating with the upstream DNS server:
            - `PreferUDP` - Uses UDP, even if the original request came over TCP. However, if the dns-response was truncated, because it exceeded 512 bytes(**and only in this case**), the request will be retried over TCP.
            - `ForceTCP` - Always uses TCP, even if the original request comes in over UDP.
            - `Standard` - Uses the same protocol (TCP or UDP) as the original request.
          enum: [PreferUDP, ForceTCP, Standard]
          default: PreferUDP
  enableLogs:
    description: |
      Enable CoreDNS logging.
    type: boolean
    default: false
  clusterDomainAliases:
    description: |
      A list of cluster domain aliases; these are resolved on par with `global.discovery.clusterDomain`.
    type: array
    items:
      type: string
      pattern: '^[0-9a-zA-Z\.-]+$'
