type: object
properties:
  upstreamNameservers:
    type: array
    description: |
      A list of IP addresses of recursive DNS servers that CoreDNS will use to resolve external domains.

      By default, the `/etc/resolv.conf` list is used.
    items:
      type: string
      pattern: '^[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}(:[0-9]{1,})?$'
  transportProtocolMode:
    type: string
    description: |
      The mode defines the transport protocol for communicating with the upstream DNS server:
      - `PreferUDP` - Uses UDP, even if the original request came over TCP. However, if the DNS response exceeded 512 bytes, it will be truncated and marked with the TC bit by upstream, as specified in [RFC 1035](https://datatracker.ietf.org/doc/html/rfc1035.html#section-4.2.1). Then based on [RFC 5966](https://datatracker.ietf.org/doc/html/rfc5966), the request will be resent over TCP. If there are any other UDP issues, the request will not be resent over TCP.
      - `ForceTCP` - Always uses TCP, even if the original request comes in over UDP.
      - `Standard` - Uses the same protocol (TCP or UDP) as the original request.
    enum: [PreferUDP, ForceTCP, Standard]
    default: PreferUDP
  hosts:
    description: |
      A static list of hosts similar to that of `/etc/hosts`.
    x-doc-required: false
    type: array
    items:
      type: object
      properties:
        domain:
          type: string
          pattern: '^[0-9a-zA-Z\.-]+$'
        ip:
          type: string
          pattern: '^[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}$'
  stubZones:
    x-examples:
    -
      - zone: example.com
        upstreamNameservers: ['8.8.8.8']
        cacheTTLSeconds: 3600
        transportProtocolMode: PreferUDP
    description: |
      A list of additional zones CoreDNS should be authoritative for.
    type: array
    default: []
    items:
      type: object
      required: ['zone', 'upstreamNameservers']
      properties:
        zone:
          description: |
            The CoreDNS zone.
          type: string
          pattern: '^[0-9a-zA-Z\.-]+$'
          x-doc-example: consul.local
        upstreamNameservers:
          mixLength: 1
          description: |
            A list of IP addresses of recursive DNS servers that CoreDNS will use to resolve domains in this zone.
          type: array
          items:
            type: string
            pattern: '^[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}(:[0-9]{1,})?$'
        cacheTTLSeconds:
          type: integer
          default: 30
          minimum: 1
          maximum: 3600
          description: |
            Max TTL in seconds for NOERROR responses.
        transportProtocolMode:
          type: string
          description: |
            The mode defines the transport protocol for communicating with the upstream DNS server:
            - `PreferUDP` - Uses UDP, even if the original request came over TCP. However, if the DNS response exceeded 512 bytes, it will be truncated and marked with the TC bit by upstream, as specified in [RFC 1035](https://datatracker.ietf.org/doc/html/rfc1035.html#section-4.2.1). Then based on [RFC 5966](https://datatracker.ietf.org/doc/html/rfc5966), the request will be resent over TCP. If there are any other UDP issues, the request will not be resent over TCP.
            - `ForceTCP` - Always uses TCP, even if the original request comes in over UDP.
            - `Standard` - Uses the same protocol (TCP or UDP) as the original request.
          enum: [PreferUDP, ForceTCP, Standard]
          default: PreferUDP
  enableLogs:
    description: |
      Enable CoreDNS logging.
    type: boolean
    default: false
  clusterDomainAliases:
    description: |
      A list of cluster domain aliases; these are resolved on par with `global.discovery.clusterDomain`.
    type: array
    items:
      type: string
      pattern: '^[0-9a-zA-Z\.-]+$'
