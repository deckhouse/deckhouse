title-en: Transport protocol mode
title-ru: Режим транспортного протокола
description-en: |
  Ability to configure the transport protocol mode for communicating with upstream DNS servers:
  - `PreferUDP` - UDP is used, even if the original request came over TCP. If DNS response exceeds 512 bytes and is truncated, it will be resent over TCP.
  - `ForceTCP` - Always uses TCP, even if the original request is over UDP.
  - `KeepOriginal` - Uses the same protocol (TCP or UDP) as the original request.
  Can be configured globally and per stub zone.
description-ru: |
  Возможность настроить режим транспортного протокола для общения с upstream DNS серверами:
  - `PreferUDP` - используется UDP, даже если исходный запрос пришел по TCP. Если DNS ответ превышает 512 байт и обрезан, он будет переотправлен по TCP.
  - `ForceTCP` - всегда использует TCP, даже если исходный запрос был по UDP.
  - `KeepOriginal` - использует тот же протокол (TCP или UDP), что и исходный запрос.
  Может быть настроен глобально и для каждой stub зоны.
user-notes-ru: |
  **Важно для пользователей:**
  - По умолчанию используется `PreferUDP` для оптимизации производительности
  - `ForceTCP` требуется для корпоративных DNS серверов с политиками безопасности
  - `KeepOriginal` сохраняет протокол исходного запроса (редко используется)
  - Для stub зон можно настроить отдельный режим, отличный от глобального
  - TCP медленнее UDP, но надежнее для больших DNS ответов
user-notes-en: |
  **Important for users:**
  - Default is `PreferUDP` for performance optimization
  - `ForceTCP` is required for corporate DNS servers with security policies
  - `KeepOriginal` preserves the original request protocol (rarely used)
  - For stub zones, you can configure a separate mode different from global
  - TCP is slower than UDP but more reliable for large DNS responses
configuration-example: |
  ```yaml
  apiVersion: deckhouse.io/v1alpha1
  kind: ModuleConfig
  metadata:
    name: kube-dns
  spec:
    settings:
      # Global setting
      transportProtocolMode: ForceTCP
      # Per-stub-zone setting
      stubZones:
      - zone: internal.local
        upstreamNameservers: ['192.168.1.10']
        transportProtocolMode: PreferUDP
  ```
related-features:
  - FEATURE-STUB-ZONES
troubleshooting-ru: |
  - **Проблема:** DNS запросы не проходят через корпоративный firewall
    - **Решение:** Используйте ForceTCP для соответствия политикам безопасности
  - **Проблема:** Медленные DNS запросы при ForceTCP
    - **Решение:** Используйте PreferUDP, если это допустимо политиками безопасности
troubleshooting-en: |
  - **Issue:** DNS queries blocked by corporate firewall
    - **Solution:** Use ForceTCP to comply with security policies
  - **Issue:** Slow DNS queries with ForceTCP
    - **Solution:** Use PreferUDP if allowed by security policies
user-stories:
  - en: Our corporate firewall blocks UDP DNS traffic, causing resolution failures. By forcing TCP for all DNS queries, we comply with security policies while maintaining full DNS functionality across the cluster.
    ru: Наш корпоративный firewall блокирует UDP DNS трафик, вызывая сбои разрешения. Принудительно используя TCP для всех DNS запросов, мы соответствуем политикам безопасности, сохраняя полную функциональность DNS в кластере.
    scope: System
  - en: Internal DNS servers support UDP and respond quickly, but we need TCP fallback for large responses. PreferUDP mode gives us the best of both worlds: fast UDP queries for most requests, with automatic TCP retry when responses exceed 512 bytes.
    ru: Внутренние DNS серверы поддерживают UDP и отвечают быстро, но нам нужен TCP fallback для больших ответов. Режим PreferUDP дает нам лучшее из обоих миров: быстрые UDP запросы для большинства запросов, с автоматической TCP повторной попыткой, когда ответы превышают 512 байт.
    scope: System

