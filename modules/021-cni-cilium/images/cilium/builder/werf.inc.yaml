---
artifact: {{ $.ModuleName }}/{{ $.ImageName }}-builder
from: {{ $.Images.BASE_GOLANG_19_ALPINE }}
import:
- image: quay.io/cilium/cilium-llvm:3408daa17f6490a464dfc746961e28ae31964c66@sha256:ff13a1a9f973d102c6ac907d2bc38a524c8e1d26c6c1b16ed809a98925206a79
  add: /usr/local/bin/llvm-objcopy
  to: /bin
mount:
- fromPath: ~/go-pkg-cache
  to: /go/pkg
git:
- add: /modules/021-{{ $.ModuleName }}/images/{{ $.ImageName }}/builder/scripts/*
  to: /go/src/github.com/cilium/cilium/images/builder
  stageDependencies:
    install:
    - '**/*'
shell:
  beforeInstall:
  - apt-get update
  - apt-get upgrade -y --no-install-recommends
  - apt-get install -y --no-install-recommends \
    # Install cross tools for both arm64 on amd64
    gcc-aarch64-linux-gnu \
    g++-aarch64-linux-gnu \
    libc6-dev-arm64-cross \
    binutils-aarch64-linux-gnu \
    gcc-x86-64-linux-gnu \
    g++-x86-64-linux-gnu \
    libc6-dev-amd64-cross \
    binutils-x86-64-linux-gnu \
    # Dependencies to unzip protoc
    unzip \
    # Base Cilium-build dependencies
    binutils \
    coreutils \
    curl \
    gcc \
    git \
    libc6-dev \
    make
  - apt-get purge --auto-remove
  - apt-get clean
  - rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
  install:
  - bash install-protoc.sh
  - bash install-protoplugins.sh
docker:
  WORKDIR: /go/src/github.com/cilium/cilium
