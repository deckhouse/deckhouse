---
artifact: {{ $.ModuleName }}/iptables-artifact
from: quay.io/cilium/iptables:67f517af50e18f64cd12625021f1c39246bb4f92@sha256:d075f03e89aacf51908346ec8ed5d251b8d3ad528ce30a710fcd074cdf91f11d
---
# #####################################################################
# IPTABLES
# Original IMAGE_TAG is 67f517af50e18f64cd12625021f1c39246bb4f92
# Corresponding commit 3e6b0f588d788ac0e69f4d126cfb3c55b1513948 (https://github.com/cilium/image-tools/tree/3e6b0f588d788ac0e69f4d126cfb3c55b1513948)
# Based on https://github.com/cilium/cilium/blob/v1.14.5/images/runtime/Dockerfile
# and https://github.com/cilium/image-tools/blob/3e6b0f588d788ac0e69f4d126cfb3c55b1513948/images/iptables/Dockerfile
# and https://github.com/cilium/image-tools/blob/aee704bc3cf922acc4a2a02b0b76f524d4796a14/images/iptables/Dockerfile
# #####################################################################
{{- $iptablesVersion := "1.8.8-1" }}
{{- $gitTag := "debian/1.8.8-1" }}
{{- $_ := set . "SOURCE_REPO" "https://salsa.debian.org" }}
---
image: {{ $.ModuleName }}/iptables-git-artifact
fromImage: {{ $.ModuleName }}/base-cilium-dev
shell:
  install:
  - mkdir /iptables
  - gbp clone {{ $.SOURCE_REPO }}/pkg-netfilter-team/pkg-iptables.git /iptables/iptables-1.8.8
  - cd /iptables/iptables-1.8.8
  - git checkout {{ $gitTag }}
  - gbp buildpackage --git-ignore-branch --git-ignore-new --git-no-pristine-tar
---
# #####################################################################
# ---
# {{- $iptablesVersion := "1.8.8-1" }}
# {{- $snapshotDate := "20230116T212610Z" }}
# # repo based
# ---
# artifact: {{ $.ModuleName }}/iptables-artifact
# fromImage: {{ $.ModuleName }}/base-cilium-dev
# shell:
#   beforeInstall:
#   - echo "deb-src [check-valid-until=no signed-by=/usr/share/keyrings/debian-archive-bullseye-automatic.gpg] https://snapshot.debian.org/archive/debian/{{ $snapshotDate }}/ bookworm main" >> /etc/apt/sources.list.d/iptables-snapshot.list
#   - apt-get update && apt-src update
#   install:
#   - mkdir -p /iptables && cd /iptables
#   - apt-src -b -t install iptables={{ $iptablesVersion }}
#   - apt-get clean && rm -rf /var/lib/apt/lists/*
# ---
# {{- $gitTag := "debian/1.8.8-1" }}
# # git based
# ---
# artifact: {{ $.ModuleName }}/iptables-git-artifact
# from: {{ $.Images.BASE_UBUNTU }}
# shell:
#   beforeInstall:
#   - apt-get update
#   - apt-get install -y --no-install-recommends ca-certificates git apt-src build-essential
#   - apt-get install -y --no-install-recommends build-essential autoconf automake bison  flex libmnl-dev libnetfilter-conntrack-dev libnetfilter-conntrack3 libnfnetlink-dev libtool
#   - apt-get satisfy -y --no-install-recommends "debhelper-compat (= 13), libnftnl-dev (>= 1.1.6)"
#   install:
#   - mkdir /iptables
#   - git clone --depth 1 --branch "{{ $gitTag }}" {{ $.SOURCE_REPO }}/pkg-netfilter-team/pkg-iptables.git /iptables/iptables-1.8.8
#   - apt-src import iptables --location=/iptables/iptables-1.8.8 --version={{ $iptablesVersion }}
#   - cd /iptables
#   - dpkg-checkbuilddeps ./iptables-1.8.8/debian/control
#   - cd /iptables/iptables-1.8.8
#   - dpkg-buildpackage -b -us -uc
# ---
# artifact: {{ $.ModuleName }}/iptables-git2-artifact
# from: {{ $.Images.BASE_UBUNTU }}
# shell:
#   beforeInstall:
#   - apt-get update
#   - apt-get install -y --no-install-recommends ca-certificates git build-essential binutils
#   - apt-get install -y --no-install-recommends lintian debhelper dh-make devscripts
#   install:
#   - mkdir /iptables
#   - git clone --depth 1 --branch "{{ $gitTag }}" {{ $.SOURCE_REPO }}/pkg-netfilter-team/pkg-iptables.git /iptables/iptables-1.8.8
#   - cd /iptables/iptables-1.8.8
#   - apt-get build-dep -y .
#   - dpkg-checkbuilddeps /iptables/iptables-1.8.8/debian/control
#   - debuild -i -us -uc -b
# ---
# artifact: {{ $.ModuleName }}/iptables-git3-artifact
# from: {{ $.Images.BASE_UBUNTU }}
# shell:
#   beforeInstall:
#   - export DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC
#   - apt-get update
#   - apt-get install -y --no-install-recommends git-buildpackage ca-certificates build-essential
#   - apt-get install -y --no-install-recommends build-essential autoconf automake bison  flex libmnl-dev libnetfilter-conntrack-dev libnetfilter-conntrack3 libnfnetlink-dev libtool
#   - apt-get satisfy -y --no-install-recommends "debhelper-compat (= 13), libnftnl-dev (>= 1.1.6)"
#   install:
#   - mkdir /iptables
#   - gbp clone {{ $.SOURCE_REPO }}/pkg-netfilter-team/pkg-iptables.git /iptables/iptables-1.8.8
#   - cd /iptables/iptables-1.8.8
#   - git checkout {{ $gitTag }}
#   - gbp buildpackage --git-ignore-branch --git-ignore-new --git-no-pristine-tar
