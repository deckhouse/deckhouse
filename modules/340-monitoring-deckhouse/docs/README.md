---
title: "The monitoring-deckhouse module"
description: "Monitoring of Deckhouse Kubernetes Platform components and services."
---

## Description

The `monitoring-deckhouse` module provides comprehensive monitoring, alerting, and observability for the Deckhouse Kubernetes Platform itself. It monitors the health, performance, and proper operation of Deckhouse core components to ensure platform stability and reliability.

This module is a critical observability component that works in conjunction with the [prometheus](/modules/prometheus/) module to provide insights into Deckhouse's operational state.

## How it works

The module deploys monitoring resources that:

- **Collect Deckhouse metrics** - Scrapes metrics from the Deckhouse pod using PodMonitor resources, including:
  - Self metrics on port `4222` via `/metrics` endpoint
  - Custom hook-generated metrics via `/metrics/hooks` endpoint
  - Module execution metrics, hook performance, and system health indicators

- **Define alerting rules** - Provides comprehensive Prometheus alerting rules organized into several categories:
  - **Deckhouse availability** - Monitors pod health, readiness, and uptime
  - **Deckhouse malfunctioning** - Detects excessive restarts, registry access issues, hung processes
  - **Release management** - Tracks release channel subscriptions, pending updates, and manual approvals
  - **Module management** - Monitors module state, validation errors, and deprecated configurations
  - **CNI checks** - Detects multiple CNI configurations and misconfigurations
  - **OS requirements** - Identifies nodes running deprecated operating system versions

- **Provide Grafana dashboards** - Includes pre-built Grafana dashboards for visualizing:
  - Deckhouse performance metrics
  - Module execution statistics
  - Hook run times and resource usage
  - Queue processing and convergence status

### Metrics collection

The module configures a PodMonitor that scrapes two endpoints from the Deckhouse pod:

1. **Self metrics** (`/metrics`) - Core Deckhouse operational metrics:
   - `deckhouse_live_ticks` - Health indicator incrementing every 10 seconds
   - `deckhouse_registry_errors` - Registry connectivity issues
   - `deckhouse_module_hook_run_seconds` - Module hook execution duration
   - `deckhouse_tasks_queue_action_duration_seconds` - Task queue processing times
   - And many more operational metrics

2. **Hook metrics** (`/metrics/hooks`) - Custom metrics generated by Deckhouse hooks with `honorLabels: true` to preserve hook-specific labels

### Alert categories

#### Availability alerts
- **D8DeckhousePodIsNotReady** - Deckhouse pod is not in Ready state for 10 minutes
- **D8DeckhousePodIsNotRunning** - Deckhouse pod is not in Running phase for 2 minutes
- **D8DeckhouseIsHung** - Deckhouse process appears hung (live ticks stopped)
- **D8DeckhouseSelfTargetDown/Absent** - Prometheus cannot scrape Deckhouse metrics
- **D8DeckhouseCustomTargetDown** - Prometheus cannot scrape custom hook metrics

#### Malfunction alerts
- **D8DeckhousePodIsRestartingTooOften** - More than 3 restarts in the last hour
- **D8DeckhouseHasNoAccessToRegistry** - Cannot connect to container registry for 1 hour
- **D8DeckhouseQueueIsHung** - Task queue processing is stuck
- **D8DeckhouseCouldNotRunModuleHook** - Module hooks failing to execute
- **D8DeckhouseCouldNotDeleteModule/DiscoverModules** - Module management issues

#### Release management alerts
- **D8DeckhouseIsNotOnReleaseChannel** - Not subscribed to any regular release channel
- **DeckhouseReleaseIsWaitingManualApproval** - New release requires manual approval
- **DeckhouseReleaseIsBlocked** - Release blocked due to unmet requirements
- **DeckhouseReleaseIsOutdated** - Installed version is outdated

#### CNI and OS alerts
- **D8CNIEnabledMoreThanOne** - Multiple CNI plugins enabled simultaneously
- **D8CNIMisconfigured** - CNI ModuleConfig doesn't match actual cluster configuration
- **D8NodeHasDeprecatedOSVersion** - Nodes running unsupported OS versions (Ubuntu 18.04, Debian 10, CentOS 7)

### Integration with Observability module

When the [observability](/modules/observability/stable/) module is enabled, this module automatically creates:
- `ClusterObservabilityMetricsRulesGroup` resources for Prometheus rules
- `ClusterObservabilityDashboard` resources for Grafana dashboards

This enables centralized management and multi-tenancy support for monitoring resources.

## Requirements

- **prometheus** module must be enabled (automatic dependency)
- **operator-prometheus** module should be enabled for PodMonitor support

## Limitations

- No configuration parameters are available - the module works out of the box
- All alerts are defined with preset severity levels and thresholds
- Grafana dashboards are read-only and managed by the module