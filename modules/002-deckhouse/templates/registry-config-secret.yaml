---
apiVersion: v1
kind: Secret
metadata:
  name: registry-deckhouse-config
  namespace: d8-system
  annotations:
    helm.sh/resource-policy: keep
    version: 1
  {{- include "helm_lib_module_labels" (list . (dict "app" "registry" "name" "deckhouse-registry")) | nindent 2 }}
  labels:
    app.kubernetes.io/managed-by: system-registry
    heritage: deckhouse
    module: system-registry
    type: system-registry-config
type: system-registry/config
data:
  mode: {{ .Values.deckhouse.registry.mode | b64enc }}
  {{- if eq .Values.deckhouse.registry.mode "Direct" }}
    {{- with .Values.deckhouse.registry.direct }}
  imagesRepo: {{ .imagesRepo | b64enc }}
  scheme: {{ .scheme | b64enc }}
      {{- if .license }}
  username: {{ "license-token" | b64enc }}
  password: {{ .license | b64enc }}
      {{- else if and .username .password }}
  username: {{ .username | b64enc }}
  password: {{ .password | b64enc }}
      {{- end }}
    {{- end }}
  {{- else if eq .Values.deckhouse.registry.mode "Proxy" }}
    {{- with .Values.deckhouse.registry.proxy }}
  imagesRepo: {{ .imagesRepo | b64enc }}
  scheme: {{ .scheme | b64enc }}
      {{- if .ttl }}
  ttl: {{ .ttl | b64enc }}
      {{- end }}
      {{- if .license }}
  username: {{ "license-token" | b64enc }}
  password: {{ .license | b64enc }}
      {{- else if and .username .password }}
  username: {{ .username | b64enc }}
  password: {{ .password | b64enc }}
      {{- end }}
    {{- end }}
  {{- end }}
  raw_config: {{ .Values.deckhouse.registry | toYaml | b64enc }}
