---
apiVersion: v1
kind: Secret
metadata:
  name: registry-config
  namespace: d8-system
  annotations:
    version: "1"
  {{- include "helm_lib_module_labels" (list . (dict "app" "registry" "name" "registry-deckhouse-config" "type" "registry-config" )) | nindent 2 }}
type: registry/config
data:
  mode: {{ .Values.deckhouse.registry.mode | b64enc }}
  {{- if eq .Values.deckhouse.registry.mode "Direct" }}
    {{- with .Values.deckhouse.registry.direct }}
  imagesRepo: {{ .imagesRepo | b64enc }}
  scheme: {{ .scheme | b64enc }}
      {{- with .ca }}
  ca: {{ . | b64enc }}
      {{- end }}
      {{- if .license }}
  username: {{ "license-token" | b64enc }}
  password: {{ .license | b64enc }}
      {{- else if and .username .password }}
  username: {{ .username | b64enc }}
  password: {{ .password | b64enc }}
      {{- end }}
  checkMode: {{ .checkMode | b64enc }}
    {{- end }}
  {{- else if eq .Values.deckhouse.registry.mode "Unmanaged" }}
    {{- with .Values.deckhouse.registry.unmanaged }}
  imagesRepo: {{ .imagesRepo | b64enc }}
  scheme: {{ .scheme | b64enc }}
      {{- with .ca }}
  ca: {{ . | b64enc }}
      {{- end }}
      {{- if .license }}
  username: {{ "license-token" | b64enc }}
  password: {{ .license | b64enc }}
      {{- else if and .username .password }}
  username: {{ .username | b64enc }}
  password: {{ .password | b64enc }}
      {{- end }}
  checkMode: {{ .checkMode | b64enc }}
    {{- end }}
  {{- else if eq .Values.deckhouse.registry.mode "Proxy" }}
    {{- with .Values.deckhouse.registry.proxy }}
  imagesRepo: {{ .imagesRepo | b64enc }}
  scheme: {{ .scheme | b64enc }}
      {{- with .ca }}
  ca: {{ . | b64enc }}
      {{- end }}
      {{- if .license }}
  username: {{ "license-token" | b64enc }}
  password: {{ .license | b64enc }}
      {{- else if and .username .password }}
  username: {{ .username | b64enc }}
  password: {{ .password | b64enc }}
      {{- end }}
  checkMode: {{ .checkMode | b64enc }}
      {{- with .ttl }}
  ttl: {{ . | b64enc }}
      {{- end }}
    {{- end }}
  {{- end }}
  raw_config: {{ .Values.deckhouse.registry | toYaml | b64enc }}
