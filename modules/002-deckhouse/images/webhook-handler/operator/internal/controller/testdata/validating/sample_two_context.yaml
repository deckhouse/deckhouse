apiVersion: deckhouse.io/v1alpha1
kind: ValidationWebhook
metadata:
  labels:
    app.kubernetes.io/name: operator
    app.kubernetes.io/managed-by: kustomize
  name: validationwebhook-sample
validationObject: # as-is as validationwebhookconfiguration
  name: validationwebhook.deployments.apps
  rules:
    - apiGroups: ["apps"]
      apiVersions: ["v1", "v1beta1"]
      operations: ["CREATE", "UPDATE"]
      resources: ["deployments", "replicasets"]
      scope: "Namespaced"
  namespace:
    labelSelector:
      matchExpressions:
        - key: runlevel
          operator: NotIn
          values: ["0","1"]
  matchConditions:
    - name: yyyy
      expression: 'request.resource.group != "rbac.authorization.k8s.io"'
context:
  - name: some_node
    kubernetes:
      apiVersion: v1
      kind: Node
      nameSelector: # As in labelSelector
        matchNames: ["global"]
      labelSelector:
        matchLabels:
          foo: bar
      namespace:
        labelSelector:
          matchLabels: # matchExpressions, matchNames
            bar: foo
      jqFilter: |
        { "nodeName": .metadata.name }
  - name: some_node
    kubernetes:
      apiVersion: v1
      kind: Node
      nameSelector: # As in labelSelector
        matchNames: ["global"]
      labelSelector:
        matchLabels:
          foo: bar
      namespace:
        labelSelector:
          matchLabels: # matchExpressions, matchNames
            bar: foo
      jqFilter: |
        { "nodeName": .metadata.name }
handler:
  cel: |
    TODO: not need now
  python: |
    def validate(ctx: DotMap) -> tuple[Optional[str], bool]:
      # logic here
      return None, True