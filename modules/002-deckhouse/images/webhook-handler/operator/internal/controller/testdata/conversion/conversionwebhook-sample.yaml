apiVersion: deckhouse.io/v1alpha1
kind: ConversionWebhook
metadata:
  labels:
    app.kubernetes.io/name: operator
    app.kubernetes.io/managed-by: kustomize
  name: conversionwebhook-sample
kubernetesCustomResourceConversion:
  - name: v1beta1_to_v1
    crdName: crontabs.stable.example.com
    conversions:
    - fromVersion: stable.example.com/v1beta1
      toVersion: stable.example.com/v1
  - name: v1_to_v1beta1
    crdName: crontabs.stable.example.com
    conversions:
    - fromVersion: stable.example.com/v1
      toVersion: stable.example.com/v1beta1
conversions:
  - from: v1alpha1
    to: v1alpha2
    handler:
      python: |
        def v1beta1_to_v1(self, o: dict) -> typing.Tuple[None, dict]:
            obj = DotMap(o)

            obj.apiVersion = "stable.example.com/v1"
            
            obj.spec.host=obj.spec.hostPort
            obj.spec.port=obj.spec.hostPort
            del obj.spec.hostPort

            return None, obj.toDict()


        def v1_to_v1beta1(self, o: dict) -> typing.Tuple[None, dict]:
            obj = DotMap(o)

            obj.apiVersion = "stable.example.com/v1beta1"

            hostPort = obj.spec.host+":"+obj.spec.port
            obj.spec.hostPort=hostPort
            del obj.spec.host
            del obj.spec.port

            return None, obj.toDict()