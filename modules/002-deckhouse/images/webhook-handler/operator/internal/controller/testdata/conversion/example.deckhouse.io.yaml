apiVersion: deckhouse.io/v1alpha1
kind: ConversionWebhook
metadata:
  labels:
    app.kubernetes.io/name: operator
    app.kubernetes.io/managed-by: kustomize
  name: example.deckhouse.io
conversions:
  - from: v1alpha1
    to: v1
    handler:
      python: |
        def v1alpha1_to_v1(self, o: dict) -> typing.Tuple[None, dict]:
            obj = DotMap(o)

            obj.apiVersion = "deckhouse.io/v1"
            
            obj.spec.host=obj.spec.hostPort
            obj.spec.port=obj.spec.hostPort
            del obj.spec.hostPort

            return None, obj.toDict()

  - from: v1
    to: v1alpha1
    handler:
      python: |
        def v1_to_v1alpha1(self, o: dict) -> typing.Tuple[None, dict]:
            obj = DotMap(o)

            obj.apiVersion = "deckhouse.io/v1alpha1"
            if not obj.spec.host:
              return None, obj.toDict()

            hostPort = obj.spec.host+":"+obj.spec.port
            del obj.spec
            if hostPort:
              obj.spec.hostPort=hostPort

            return None, obj.toDict()