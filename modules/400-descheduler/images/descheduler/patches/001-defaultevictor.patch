Subject: [PATCH] Default evictor patch
---
Index: pkg/framework/plugins/defaultevictor/defaultevictor.go
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/pkg/framework/plugins/defaultevictor/defaultevictor.go b/pkg/framework/plugins/defaultevictor/defaultevictor.go
--- a/pkg/framework/plugins/defaultevictor/defaultevictor.go	(revision 4e4c5f79fb8580f6817ff378cdad27c410546e0c)
+++ b/pkg/framework/plugins/defaultevictor/defaultevictor.go	(date 1724230735243)
@@ -18,6 +18,7 @@
 	"context"
 	"errors"
 	"fmt"
+	"strings"
 	"time"

 	v1 "k8s.io/api/core/v1"
@@ -27,6 +28,7 @@
 	utilerrors "k8s.io/apimachinery/pkg/util/errors"
 	"k8s.io/client-go/tools/cache"
 	"k8s.io/klog/v2"
+
 	nodeutil "sigs.k8s.io/descheduler/pkg/descheduler/node"
 	podutil "sigs.k8s.io/descheduler/pkg/descheduler/pod"
 	frameworktypes "sigs.k8s.io/descheduler/pkg/framework/types"
@@ -77,6 +79,14 @@
 		args:   defaultEvictorArgs,
 	}

+	// don't use pods from d8-* and kube-system namespaces
+	ev.constraints = append(ev.constraints, func(pod *v1.Pod) error {
+		if strings.HasPrefix(pod.Namespace, "d8-") || pod.Namespace == "kube-system" {
+			return fmt.Errorf("pod in the deckhouse namespace(%s)", pod.Namespace)
+		}
+		return nil
+	})
+
 	if defaultEvictorArgs.EvictFailedBarePods {
 		klog.V(1).InfoS("Warning: EvictFailedBarePods is set to True. This could cause eviction of pods without ownerReferences.")
 		ev.constraints = append(ev.constraints, func(pod *v1.Pod) error {
@@ -195,6 +205,7 @@
 			return nil
 		})
 	}
+
 	return ev, nil
 }

