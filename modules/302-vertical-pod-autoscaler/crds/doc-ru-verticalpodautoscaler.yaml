spec:
  versions:
  - additionalPrinterColumns:
    name: v1
    schema:
      openAPIV3Schema: &schema
        description: |-
          Описывает конфигурацию работы механизма Vertical Pod Autoscaler для указанного контроллера.

          Vertical Pod Autoscaler автоматически управляет ресурсами подов контроллера на основании исторических и текущих данных по утилизации ресурсов.
        properties:
          apiVersion:
            description: |-
              Определяет версионированную схему этого представления объекта. Серверы должны преобразовывать распознанные схемы в последнее внутреннее значение и могут отклонять нераспознанные значения.

              Больше информации [в документации](https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources).
            type: string
          kind:
            description: |-
              Значение, представляющее REST-ресурс, который описывает данный объект. Серверы могут определить его из конечной точки, к которой клиент отправляет запросы. Не может быть изменено. Используется в CamelCase.

              Больше информации [в документации](https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds).
            type: string
          spec:
            description: |-
              Описание поведения автоскейлера.

              Больше информации [в документации](https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status).
            properties:
              recommenders:
                description: |-
                  Механизм рекомендаций, отвечающий за создание рекомендаций для данного объекта. Список должен быть пустым (тогда рекомендации создаст механизм по умолчанию) или содержать ровно один элемент.
                items:
                  description: |-
                    `VerticalPodAutoscalerRecommenderSelector` указывает на конкретный механизм рекомендаций для Vertical Pod Autoscaler. В будущем он может передавать параметры этому механизму.
                  properties:
                    name:
                      description: Имя компонента, отвечающего за создание рекомендаций для данного объекта.
              resourcePolicy:
                description: |-
                  Управляет тем, как автоскейлер вычисляет рекомендуемые ресурсы. Политика ресурсов может использоваться для установки ограничений на рекомендации для отдельных контейнеров.

                  Если какие-либо контейнеры необходимо исключить из получения рекомендаций VPA, это следует явно указать, установив режим в значение `Off` в параметре `containerPolicies`.

                  Если параметр не задан, автоскейлер будет вычислять рекомендуемые ресурсы для всех контейнеров в поде без дополнительных ограничений.
                properties:
                  containerPolicies:
                    description: Политики ресурсов для каждого контейнера.
                    items:
                      description: Политика ресурсов контейнера контролирует, как автоскейлер вычисляет рекомендуемые ресурсы для конкретного контейнера.
                      properties:
                        containerName:
                          description: |-
                            Имя контейнера или `DefaultContainerResourcePolicy`, в этом случае политика применяется к контейнерам, для которых не указана собственная политика.
                        controlledResources:
                          description: |-
                            Указывает тип рекомендаций, которые будут вычисляться (и, возможно, применяться) VPA. Если не указано, используется значение по умолчанию: `ResourceCPU`, `ResourceMemory`.
                          items:
                            description: |-
                              Имя, которое идентифицирует различные ресурсы в списке ресурсов (ResourceList).
                        controlledValues:
                          description: |-
                            Указывает, какие значения ресурсов должны контролироваться.
                        maxAllowed:
                          additionalProperties:
                          description: |-
                            Указывает максимальное количество ресурсов, которое будет рекомендовано для контейнера. По умолчанию максимальное значение не установлено.
                        minAllowed:
                          additionalProperties:
                          description: |-
                            Указывает минимальное количество ресурсов, которое будет рекомендовано для контейнера. По умолчанию минимальное значение не установлено.
                        mode:
                          description: Указывает, включен ли автоскейлер для контейнера.
              targetRef:
                description: |-
                  Указывает на контроллер, управляющий набором подов, которые должен контролировать автоскейлер, например, Deployment или StatefulSet.

                  VerticalPodAutoscaler может быть нацелен на контроллер, который реализует подресурс масштабирования (набор подов извлекается из `ScaleStatus` контроллера) или на другие известные контроллеры (например, для DaemonSet набор подов читается из спецификации контроллера).

                  Если VerticalPodAutoscaler не может использовать указанный  объект, он сообщит о состоянии `ConfigUnsupported`. Обратите внимание, что VerticalPodAutoscaler не требует полной реализации подресурса масштабирования — он не будет использовать его для изменения количества реплик. Единственное, что используется — это селектор меток, соответствующих подам, сгруппированным по целевому ресурсу.
                properties:
                  apiVersion:
                    description: Версия API связанного объекта.
                  kind:
                    description: |-
                      Тип связанного объекта.

                      Больше информации [в документации](https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds).
                  name:
                    description: |-
                      Имя связанного объекта.

                      Больше информации [в документации](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names).
                type: object
              updatePolicy:
                description: |-
                  Описывает правила применения изменений к подам. Если не указано, все поля в `PodUpdatePolicy` устанавливаются в значения по умолчанию.
                properties:
                  evictionRequirements:
                    description: |-
                      Список требований для завершения работы пода (`EvictionRequirements`), которые должны быть выполнены, чтобы под завершил работу (Eviction). Если указано несколько требований, все они должны быть выполнены для разрешения завершения работы.
                    items:
                      description: |-
                        Определяет одно условие, которое должно быть истинным для того, чтобы под завершил работу.
                      properties:
                        changeRequirement:
                          description: |-
                            Описывает зависимость между новым целевым рекомендуемым значением для пода и его текущими запросами, а также тип изменения, необходимого для того, чтобы под завершил работу.
                        resources:
                          description: |-
                            Это список одного или нескольких ресурсов, к которым применяется условие. Если указано несколько ресурсов, условие для завершения работы считается выполненным, если хотя бы один из ресурсов удовлетворяет `changeRequirement`.
                          items:
                            description: |-
                              Это имя, идентифицирующее различные ресурсы в списке ресурсов (ResourceList).
                  minReplicas:
                    description: |-
                      Минимальное количество реплик, которые должны быть в живом состоянии, чтобы обновляющий процесс (Updater) попытался удалить под (с учётом других проверок, таких как PDB). Разрешены только положительные значения. Перезаписывает глобальный флаг `--min-replicas`.
                  updateMode:
                    description: |-
                      Режим работы контроллера VPA.

                      - `Auto` — режимы `Auto` и `Recreate` выполняют одинаковую функцию. Этот режим зарезервирован для [обновления ресурсов пода](https://github.com/kubernetes/design-proposals-archive/blob/main/autoscaling/vertical-pod-autoscaler.md#in-place-updates) в Kubernetes.
                      - `Recreate` — позволяет VPA изменять требования к ресурсам работающих подов (т.е. перезапускать их в процессе работы). Этот режим может привести к временной недоступности сервиса (из-за перезапуска), если у вас только одна реплика (replicas: 1). В этом режиме VPA не пересоздаёт поды, которые не были созданы контроллером.
                      - `Initial` — VPA изменяет ресурсы подов только при их запуске (но не во время работы подов).
                      - `Off` — VPA не предпринимает никаких действий для обновления запросов ресурсов для работающих контейнеров. Автоскейлер рассчитывает рекомендации и сохраняет их в поле статуса объекта VPA. Вы можете просмотреть рекомендации VPA с помощью следующей команды: `d8 k describe vpa <vpa-name>`.
                      - `InPlaceOrRecreate` - (beta). Работает только в kubernetes 1.33. VPA сначала попытается изменить ресурсы пода без перезагрузки, при невозможности пересоздаст его.
          status:
            description: Текущая информация об автоскейлере.
            properties:
              conditions:
                description: Набор условий, необходимых для того, чтобы автоскейлер мог масштабировать свою цель, и указывает, выполнены ли эти условия.
                items:
                  description: Описывает состояние VerticalPodAutoscaler в определённый момент времени.
                  properties:
                    lastTransitionTime:
                      description: Время последнего изменения состояния условия с одного статуса на другой.
                    message:
                      description: Сообщение, которое содержит объяснение и детали о переходе.
                    reason:
                      description: Причина последнего перехода состояния.
                    status:
                      description: |-
                        Состояние условия (`True`, `False`, `Unknown`).
                    type:
                      description: Описывает текущее состояние условия.
              recommendation:
                description: Последнее вычисленное количество ресурсов, рекомендованных автоскейлером для контролируемых подов.
                properties:
                  containerRecommendations:
                    description: Ресурсы, рекомендованные автоскейлером для каждого контейнера.
                    items:
                      description: |-
                        Рекомендации по ресурсам, вычисленные автоскейлером для конкретного контейнера. Учитывает политику ресурсов контейнера, если она указана в спецификации. В частности, рекомендация не генерируется для контейнеров, у которых установлен режим `ContainerScalingMode` равный 'Off'.
                      properties:
                        containerName:
                          description: Имя контейнера.
                        lowerBound:
                          additionalProperties:
                          description: |-
                            Минимальное рекомендованное количество ресурсов. Учитывает `ContainerResourcePolicy`. Это количество ресурсов не гарантирует, что приложение будет работать стабильно, однако использование меньшего количества ресурсов, скорее всего, окажет значительное влияние на производительность и доступность.
                        target:
                          additionalProperties:
                          description: |-
                            Рекомендованное количество ресурсов. Учитывает `ContainerResourcePolicy`.
                        uncappedTarget:
                          additionalProperties:
                          description: |-
                            Наиболее ранняя рекомендованная цель ресурсов, вычисленная автоскейлером для контролируемых подов, основанная только на фактическом использовании ресурсов, без учета `ContainerResourcePolicy`. Может отличаться от рекомендации, если фактическое использование ресурсов приводит к нарушению `ContainerResourcePolicy` (меньше чем MinAllowed или больше чем MaxAllowed). Используется только как индикатор состояния, не влияет на фактическое назначение ресурсов.
                        upperBound:
                          additionalProperties:
                          description: |-
                            Максимально рекомендованное количество ресурсов. Учитывает `ContainerResourcePolicy`. Ресурсы, выделенные сверх этого значения, скорее всего, будут потрачены впустую. Это значение может быть больше, чем максимальное количество ресурсов, которое приложение фактически способно потреблять.
  - name: v1beta2
    schema:
      openAPIV3Schema: *schema
    served: true
    storage: false
    deprecated: true
