---
image: {{ .ModuleName }}/{{ .ImageName }}-src-artifact
fromImage: common/src-artifact
final: false
git:
- add: /{{ .ModulePath }}modules/{{ .ModulePriority }}-{{ .ModuleName }}/images/{{ .ImageName }}/src
  to: /src/vxlan-offloading-fixer
  stageDependencies:
    install:
    - '**/*'
---
image: {{ .ModuleName }}/{{ .ImageName }}-artifact
fromImage: builder/golang-alpine
final: false
import:
- image: {{ .ModuleName }}/{{ .ImageName }}-src-artifact
  add: /src/vxlan-offloading-fixer
  to: /src
  before: install
shell:
  install:
  - export "CGO_ENABLED=0"
  - export "GOOS=linux"
  - export "GOARCH=amd64"
  - cd /src
  - go build -o /tmp/vxlan-offloading-fixer main.go
  - chown 64535:64535 /tmp/vxlan-offloading-fixer
  - chmod 0755 /tmp/vxlan-offloading-fixer
---
image: {{ .ModuleName }}/{{ .ImageName }}
fromImage: common/distroless
import:
- image: common/ethtool
  add: /ethtool
  to: /ethtool
  before: setup
- image: {{ .ModuleName }}/{{ .ImageName }}-artifact
  add: /tmp/vxlan-offloading-fixer
  to: /vxlan-offloading-fixer
  before: setup
- image: common/pause
  add: /pause
  to: /pause
  before: install
imageSpec:
  config:
    entrypoint: ["/vxlan-offloading-fixer"]
